!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.ManhattanContent=e():t.ManhattanContent=e()}(this,function(){return function(t){function __webpack_require__(n){if(e[n])return e[n].exports;var i=e[n]={i:n,l:!1,exports:{}};return t[n].call(i.exports,i,i.exports,__webpack_require__),i.l=!0,i.exports}var e={};return __webpack_require__.m=t,__webpack_require__.c=e,__webpack_require__.i=function(t){return t},__webpack_require__.d=function(t,e,n){__webpack_require__.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:n})},__webpack_require__.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return __webpack_require__.d(e,"a",e),e},__webpack_require__.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},__webpack_require__.p="",__webpack_require__(__webpack_require__.s=6)}([function(t,e){(function(){var e;e={},e.Machine=function(){function Machine(t){this.context=t,this._stateTransitions={},this._stateTransitionsAny={},this._defaultTransition=null,this._initialState=null,this._currentState=null}return Machine.prototype.addTransition=function(t,e,n,i){return n||(n=e),this._stateTransitions[[t,e]]=[n,i]},Machine.prototype.addTransitions=function(t,e,n,i){var o,r,s,a;for(n||(n=e),a=[],r=0,s=t.length;r<s;r++)o=t[r],a.push(this.addTransition(o,e,n,i));return a},Machine.prototype.addTransitionAny=function(t,e,n){return e||(e=t),this._stateTransitionsAny[t]=[e,n]},Machine.prototype.setDefaultTransition=function(t,e){return this._defaultTransition=[t,e]},Machine.prototype.getTransition=function(t,e){if(this._stateTransitions[[t,e]])return this._stateTransitions[[t,e]];if(this._stateTransitionsAny[e])return this._stateTransitionsAny[e];if(this._defaultTransition)return this._defaultTransition;throw new Error("Transition is undefined: ("+t+", "+e+")")},Machine.prototype.getCurrentState=function(){return this._currentState},Machine.prototype.setInitialState=function(t){if(this._initialState=t,!this._currentState)return this.reset()},Machine.prototype.reset=function(){return this._currentState=this._initialState},Machine.prototype.process=function(t){var e;return e=this.getTransition(t,this._currentState),e[1]&&e[1].call(this.context||(this.context=this),t),this._currentState=e[0]},Machine}(),"undefined"!=typeof window&&(window.FSM=e),void 0!==t&&t.exports&&(t.exports=e)}).call(this),function(){var e,n,i,o,r,s,a,l,u,h,c,d,p,_,m,g,f,v,y,E,C,T,I,b,S,w,L=[].slice,M=[].indexOf||function(t){for(var e=0,n=this.length;e<n;e++)if(e in this&&this[e]===t)return e;return-1};v={},"undefined"!=typeof window&&(window.HTMLString=v),void 0!==t&&t.exports&&(t.exports=v),v.String=function(){function String(t,e){null==e&&(e=!1),this._preserveWhitespace=e,t?(null===v.String._parser&&(v.String._parser=new w),this.characters=v.String._parser.parse(t,this._preserveWhitespace).characters):this.characters=[]}return String._parser=null,String.prototype.isWhitespace=function(){var t,e,n,i;for(i=this.characters,e=0,n=i.length;e<n;e++)if(t=i[e],!t.isWhitespace())return!1;return!0},String.prototype.length=function(){return this.characters.length},String.prototype.preserveWhitespace=function(){return this._preserveWhitespace},String.prototype.capitalize=function(){var t,e;return e=this.copy(),e.length()&&(t=e.characters[0]._c.toUpperCase(),e.characters[0]._c=t),e},String.prototype.charAt=function(t){return this.characters[t].copy()},String.prototype.concat=function(){var t,e,n,i,o,r,s,a,l,u,h,c,d,p,_,m,g;for(s=2<=arguments.length?L.call(arguments,0,l=arguments.length-1):(l=0,[]),n=arguments[l++],void 0!==n&&"boolean"!=typeof n&&(s.push(n),n=!0),o=this.copy(),u=0,d=s.length;u<d;u++)if(r=s[u],0!==r.length){if(a=r,"string"==typeof r&&(a=new v.String(r,this._preserveWhitespace)),n&&o.length())for(e=o.charAt(o.length()-1),i=e.tags(),e.isTag()&&i.shift(),"string"!=typeof r&&(a=a.copy()),m=a.characters,h=0,p=m.length;h<p;h++)t=m[h],t.addTags.apply(t,i);for(g=a.characters,c=0,_=g.length;c<_;c++)t=g[c],o.characters.push(t)}return o},String.prototype.contains=function(t){var e,n,i,o,r,s,a;if("string"==typeof t)return this.text().indexOf(t)>-1;for(i=0;i<=this.length()-t.length();){for(n=!0,a=t.characters,o=r=0,s=a.length;r<s;o=++r)if(e=a[o],!e.eq(this.characters[o+i])){n=!1;break}if(n)return!0;i++}return!1},String.prototype.endsWith=function(t){var e,n,i,o,r,s;if("string"==typeof t)return""===t||this.text().slice(-t.length)===t;for(n=this.characters.slice().reverse(),s=t.characters.slice().reverse(),i=o=0,r=s.length;o<r;i=++o)if(e=s[i],!e.eq(n[i]))return!1;return!0},String.prototype.format=function(){var t,e,n,i,o,r,s;for(e=arguments[0],r=arguments[1],o=3<=arguments.length?L.call(arguments,2):[],r<0&&(r=this.length()+r+1),e<0&&(e=this.length()+e),i=this.copy(),n=s=e;e<=r?s<r:s>r;n=e<=r?++s:--s)t=i.characters[n],t.addTags.apply(t,o);return i},String.prototype.hasTags=function(){var t,e,n,i,o,r,s,a;for(i=2<=arguments.length?L.call(arguments,0,o=arguments.length-1):(o=0,[]),n=arguments[o++],void 0!==n&&"boolean"!=typeof n&&(i.push(n),n=!1),e=!1,a=this.characters,r=0,s=a.length;r<s;r++)if(t=a[r],t.hasTags.apply(t,i))e=!0;else if(n)return!1;return e},String.prototype.html=function(){var t,e,n,i,o,r,s,a,l,u,h,c,d,p,_,m,g,f,v,y,E,C,T;for(o="",a=[],r=[],n=[],y=this.characters,u=0,p=y.length;u<p;u++){for(t=y[u],n=[],E=a.slice().reverse(),h=0,_=E.length;h<_;h++)if(s=E[h],n.push(s),!t.hasTags(s)){for(c=0,m=n.length;c<m;c++)e=n[c],o+=e.tail(),a.pop(),r.pop();n=[]}for(C=t._tags,d=0,g=C.length;d<g;d++)l=C[d],-1===r.indexOf(l.head())&&(l.selfClosing()||(i=l.head(),o+=i,a.push(l),r.push(i)));t._tags.length>0&&t._tags[0].selfClosing()&&(o+=t._tags[0].head()),o+=t.c()}for(T=a.reverse(),v=0,f=T.length;v<f;v++)l=T[v],o+=l.tail();return o},String.prototype.indexOf=function(t,e){var n,i,o,r,s,a;if(null==e&&(e=0),e<0&&(e=0),"string"==typeof t)return this.text().indexOf(t,e);for(;e<=this.length()-t.length();){for(i=!0,a=t.characters,o=r=0,s=a.length;r<s;o=++r)if(n=a[o],!n.eq(this.characters[o+e])){i=!1;break}if(i)return e;e++}return-1},String.prototype.insert=function(t,e,n){var i,o,r,s,a,l,u,h,c,d,p,_,m,g,f,y;if(null==n&&(n=!0),o=this.slice(0,t),u=this.slice(t),t<0&&(t=this.length()+t),a=e,"string"==typeof e&&(a=new v.String(e,this._preserveWhitespace)),n&&t>0)for(r=this.charAt(t-1),s=r.tags(),r.isTag()&&s.shift(),"string"!=typeof e&&(a=a.copy()),g=a.characters,h=0,p=g.length;h<p;h++)i=g[h],i.addTags.apply(i,s);for(l=o,f=a.characters,c=0,_=f.length;c<_;c++)i=f[c],l.characters.push(i);for(y=u.characters,d=0,m=y.length;d<m;d++)i=y[d],l.characters.push(i);return l},String.prototype.lastIndexOf=function(t,e){var n,i,o,r,s,a,l,u,h;if(null==e&&(e=0),e<0&&(e=0),i=this.characters.slice(e).reverse(),e=0,"string"==typeof t){if(!this.contains(t))return-1;for(t=t.split("").reverse();e<=i.length-t.length;){for(o=!0,s=0,r=a=0,u=t.length;a<u;r=++a)if(n=t[r],i[r+e].isTag()&&(s+=1),n!==i[s+r+e].c()){o=!1;break}if(o)return e;e++}return-1}for(t=t.characters.slice().reverse();e<=i.length-t.length;){for(o=!0,r=l=0,h=t.length;l<h;r=++l)if(n=t[r],!n.eq(i[r+e])){o=!1;break}if(o)return e;e++}return-1},String.prototype.optimize=function(){var t,e,n,i,o,r,s,a,l,u,h,c,d,p,_,m,g,f,v,y,E,C,T,I,b,S,w,L,M,U,x,D,A,R,N;for(a=[],r=[],i=null,M=this.characters.slice().reverse(),_=0,v=M.length;_<v;_++){for(t=M[_],t._runLengthMap={},t._runLengthMapSize=0,e=[],U=a.slice().reverse(),m=0,y=U.length;m<y;m++)if(s=U[m],e.push(s),!t.hasTags(s)){for(g=0,E=e.length;g<E;g++)e[g],a.pop(),r.pop();e=[]}for(x=t._tags,f=0,C=x.length;f<C;f++)p=x[f],-1===r.indexOf(p.head())&&(p.selfClosing()||(a.push(p),r.push(p.head())));for(S=0,T=a.length;S<T;S++)p=a[S],n=p.head(),i?(t._runLengthMap[n]||(t._runLengthMap[n]=[p,0]),c=0,i._runLengthMap[n]&&(c=i._runLengthMap[n][1]),t._runLengthMap[n][1]=c+1):t._runLengthMap[n]=[p,1];i=t}for(u=function(t,e){return e[1]-t[1]},D=this.characters,N=[],w=0,I=D.length;w<I;w++)if(t=D[w],!((o=t._tags.length)>0&&t._tags[0].selfClosing()&&o<3||o<2)){h=[],A=t._runLengthMap;for(p in A)l=A[p],h.push(l);for(h.sort(u),R=t._tags.slice(),L=0,b=R.length;L<b;L++)p=R[L],p.selfClosing()||t.removeTags(p);N.push(t.addTags.apply(t,function(){var t,e,n;for(n=[],e=0,t=h.length;e<t;e++)d=h[e],n.push(d[0]);return n}()))}return N},String.prototype.slice=function(t,e){var n,i;return i=new v.String("",this._preserveWhitespace),i.characters=function(){var i,o,r,s;for(r=this.characters.slice(t,e),s=[],i=0,o=r.length;i<o;i++)n=r[i],s.push(n.copy());return s}.call(this),i},String.prototype.split=function(t,e){var n,i,o,r,s,a,l,u,h,c;for(null==t&&(t=""),null==e&&(e=0),a=0,n=0,s=[0];;){if(e>0&&n>e)break;if(-1===(r=this.indexOf(t,a)))break;s.push(r),a=r+1}for(s.push(this.length()),u=[],o=h=0,c=s.length-2;0<=c?h<=c:h>=c;o=0<=c?++h:--h)l=s[o],o>0&&(l+=1),i=s[o+1],u.push(this.slice(l,i));return u},String.prototype.startsWith=function(t){var e,n,i,o,r;if("string"==typeof t)return this.text().slice(0,t.length)===t;for(r=t.characters,n=i=0,o=r.length;i<o;n=++i)if(e=r[n],!e.eq(this.characters[n]))return!1;return!0},String.prototype.substr=function(t,e){return e<=0?new v.String("",this._preserveWhitespace):(t<0&&(t=this.length()+t),void 0===e&&(e=this.length()-t),this.slice(t,t+e))},String.prototype.substring=function(t,e){return void 0===e&&(e=this.length()),this.slice(t,e)},String.prototype.text=function(){var t,e,n,i,o;for(e="",o=this.characters,n=0,i=o.length;n<i;n++)t=o[n],t.isTag()?t.isTag("br")&&(e+="\n"):(t.c(),e+=t.c());return this.constructor.decode(e)},String.prototype.toLowerCase=function(){var t,e,n,i,o;for(e=this.copy(),o=e.characters,n=0,i=o.length;n<i;n++)t=o[n],1===t._c.length&&(t._c=t._c.toLowerCase());return e},String.prototype.toUpperCase=function(){var t,e,n,i,o;for(e=this.copy(),o=e.characters,n=0,i=o.length;n<i;n++)t=o[n],1===t._c.length&&(t._c=t._c.toUpperCase());return e},String.prototype.trim=function(){var t,e,n,i,o,r,s,a,l,u;for(l=this.characters,e=o=0,s=l.length;o<s&&(t=l[e],t.isWhitespace());e=++o);for(u=this.characters.slice().reverse(),i=r=0,a=u.length;r<a&&(t=u[i],t.isWhitespace());i=++r);return i=this.length()-i-1,n=new v.String("",this._preserveWhitespace),n.characters=function(){var n,o,r,s;for(r=this.characters.slice(e,+i+1||9e9),s=[],n=0,o=r.length;n<o;n++)t=r[n],s.push(t.copy());return s}.call(this),n},String.prototype.trimLeft=function(){var t,e,n,i,o,r,s;for(i=this.length()-1,s=this.characters,e=o=0,r=s.length;o<r&&(t=s[e],t.isWhitespace());e=++o);return n=new v.String("",this._preserveWhitespace),n.characters=function(){var n,o,r,s;for(r=this.characters.slice(e,+i+1||9e9),s=[],n=0,o=r.length;n<o;n++)t=r[n],s.push(t.copy());return s}.call(this),n},String.prototype.trimRight=function(){var t,e,n,i,o,r,s;for(e=0,s=this.characters.slice().reverse(),i=o=0,r=s.length;o<r&&(t=s[i],t.isWhitespace());i=++o);return i=this.length()-i-1,n=new v.String("",this._preserveWhitespace),n.characters=function(){var n,o,r,s;for(r=this.characters.slice(e,+i+1||9e9),s=[],n=0,o=r.length;n<o;n++)t=r[n],s.push(t.copy());return s}.call(this),n},String.prototype.unformat=function(){var t,e,n,i,o,r,s;for(e=arguments[0],r=arguments[1],o=3<=arguments.length?L.call(arguments,2):[],r<0&&(r=this.length()+r+1),e<0&&(e=this.length()+e),i=this.copy(),n=s=e;e<=r?s<r:s>r;n=e<=r?++s:--s)t=i.characters[n],t.removeTags.apply(t,o);return i},String.prototype.copy=function(){var t,e;return e=new v.String("",this._preserveWhitespace),e.characters=function(){var e,n,i,o;for(i=this.characters,o=[],e=0,n=i.length;e<n;e++)t=i[e],o.push(t.copy());return o}.call(this),e},String.decode=function(t){var e;return e=document.createElement("textarea"),e.innerHTML=t,e.textContent},String.encode=function(t){var e;return e=document.createElement("textarea"),e.textContent=t,e.innerHTML},String.join=function(t,e){var n,i,o,r;for(n=e.shift(),o=0,r=e.length;o<r;o++)i=e[o],n=n.concat(t,i);return n},String}(),e="AaBbCcDdEeFfGgHhIiJjKkLlMmNnOoPpQqRrSsTtUuVvWwXxYyZz-_$".split(""),n=e.concat("1234567890".split("")),l=n.concat([":"]),f=n.concat(["#"]),C=n.concat([":"]),_=1,g=2,E=3,y=4,m=5,b=6,T=7,S=8,I=9,h=10,a=11,u=12,i=13,p=14,c=15,d=16,r=17,s=18,o=19,w=function(){function _Parser(){this.fsm=new FSM.Machine(this),this.fsm.setInitialState(_),this.fsm.addTransitionAny(_,null,function(t){return this._pushChar(t)}),this.fsm.addTransition("<",_,E),this.fsm.addTransition("&",_,g),this.fsm.addTransitions(f,g,null,function(t){return this.entity+=t}),this.fsm.addTransition(";",g,_,function(){return this._pushChar("&"+this.entity+";"),this.entity=""}),this.fsm.addTransitions([" ","\n"],E),this.fsm.addTransitions(e,E,y,function(){return this._back()}),this.fsm.addTransition("/",E,m),this.fsm.addTransitions([" ","\n"],y),this.fsm.addTransitions(e,y,b,function(){return this._back()}),this.fsm.addTransitions([" ","\n"],m),this.fsm.addTransitions(e,m,T,function(){return this._back()}),this.fsm.addTransitions(C,b,null,function(t){return this.tagName+=t}),this.fsm.addTransitions([" ","\n"],b,h),this.fsm.addTransition("/",b,S,function(){return this.selfClosing=!0}),this.fsm.addTransition(">",b,_,function(){return this._pushTag()}),this.fsm.addTransitions([" ","\n"],S),this.fsm.addTransition(">",S,_,function(){return this._pushTag()}),this.fsm.addTransitions([" ","\n"],h),this.fsm.addTransition("/",h,S,function(){return this.selfClosing=!0}),this.fsm.addTransition(">",h,_,function(){return this._pushTag()}),this.fsm.addTransitions(e,h,a,function(){return this._back()}),this.fsm.addTransitions(C,T,null,function(t){return this.tagName+=t}),this.fsm.addTransitions([" ","\n"],T,I),this.fsm.addTransition(">",T,_,function(){return this._popTag()}),this.fsm.addTransitions([" ","\n"],I),this.fsm.addTransition(">",I,_,function(){return this._popTag()}),this.fsm.addTransitions(l,a,null,function(t){return this.attributeName+=t}),this.fsm.addTransitions([" ","\n"],a,u),this.fsm.addTransition("=",a,i),this.fsm.addTransitions([" ","\n"],u),this.fsm.addTransition("=",u,i),this.fsm.addTransitions(">",a,h,function(){return this._pushAttribute(),this._back()}),this.fsm.addTransitionAny(u,h,function(){return this._pushAttribute(),this._back()}),this.fsm.addTransitions([" ","\n"],i),this.fsm.addTransition("'",i,p),this.fsm.addTransition('"',i,c),this.fsm.addTransitions(n.concat(["&"],i,d,function(){return this._back()})),this.fsm.addTransition(" ",d,h,function(){return this._pushAttribute()}),this.fsm.addTransitions(["/",">"],d,h,function(){return this._back(),this._pushAttribute()}),this.fsm.addTransition("&",d,r),this.fsm.addTransitionAny(d,null,function(t){return this.attributeValue+=t}),this.fsm.addTransition("'",p,h,function(){return this._pushAttribute()}),this.fsm.addTransition("&",p,s),this.fsm.addTransitionAny(p,null,function(t){return this.attributeValue+=t}),this.fsm.addTransition('"',c,h,function(){return this._pushAttribute()}),this.fsm.addTransition("&",c,o),this.fsm.addTransitionAny(c,null,function(t){return this.attributeValue+=t}),this.fsm.addTransitions(f,r,null,function(t){return this.entity+=t}),this.fsm.addTransitions(f,s,function(t){return this.entity+=t}),this.fsm.addTransitions(f,o,null,function(t){return this.entity+=t}),this.fsm.addTransition(";",r,d,function(){return this.attributeValue+="&"+this.entity+";",this.entity=""}),this.fsm.addTransition(";",s,p,function(){return this.attributeValue+="&"+this.entity+";",this.entity=""}),this.fsm.addTransition(";",o,c,function(){return this.attributeValue+="&"+this.entity+";",this.entity=""})}return _Parser.prototype._back=function(){return this.head--},_Parser.prototype._pushAttribute=function(){return this.attributes[this.attributeName]=this.attributeValue,this.attributeName="",this.attributeValue=""},_Parser.prototype._pushChar=function(t){var e,n;return e=new v.Character(t,this.tags),this._preserveWhitespace?void this.string.characters.push(e):!this.string.length()||e.isTag()||e.isEntity()||!e.isWhitespace()||(n=this.string.characters[this.string.length()-1],!n.isWhitespace()||n.isTag()||n.isEntity())?this.string.characters.push(e):void 0},_Parser.prototype._pushTag=function(){var t,e;return t=new v.Tag(this.tagName,this.attributes),this.tags.push(t),t.selfClosing()&&(this._pushChar(""),this.tags.pop(),!this.selfClosed&&(e=this.tagName,M.call(v.Tag.SELF_CLOSING,e)>=0)&&this.fsm.reset()),this.tagName="",this.selfClosed=!1,this.attributes={}},_Parser.prototype._popTag=function(){for(var t,e;;)if(e=this.tags.pop(),this.string.length()&&(t=this.string.characters[this.string.length()-1],t.isTag()||t.isEntity()||!t.isWhitespace()||t.removeTags(e)),e.name()===this.tagName.toLowerCase())break;return this.tagName=""},_Parser.prototype.parse=function(t,e){var n,i;for(this._preserveWhitespace=e,this.reset(),t=this.preprocess(t),this.fsm.parser=this;this.head<t.length;){n=t[this.head];try{this.fsm.process(n)}catch(t){throw i=t,new Error("Error at char "+this.head+" >> "+i)}this.head++}return this.string},_Parser.prototype.preprocess=function(t){return t=t.replace(/\r\n/g,"\n").replace(/\r/g,"\n"),t=t.replace(/<!--[\s\S]*?-->/g,""),this._preserveWhitespace||(t=t.replace(/\s+/g," ")),t},_Parser.prototype.reset=function(){return this.fsm.reset(),this.head=0,this.string=new v.String,this.entity="",this.tags=[],this.tagName="",this.selfClosing=!1,this.attributes={},this.attributeName="",this.attributeValue=""},_Parser}(),v.Tag=function(){function Tag(t,e){var n,i;this._name=t.toLowerCase(),this._selfClosing=!0===v.Tag.SELF_CLOSING[this._name],this._head=null,this._attributes={};for(n in e)i=e[n],this._attributes[n]=i}return Tag.SELF_CLOSING={area:!0,base:!0,br:!0,hr:!0,img:!0,input:!0,"link meta":!0,wbr:!0},Tag.prototype.head=function(){var t,e,n,i;if(!this._head){t=[],i=this._attributes;for(e in i)n=i[e],n?t.push(e+'="'+n+'"'):t.push(""+e);t.sort(),t.unshift(this._name),this._head="<"+t.join(" ")+">"}return this._head},Tag.prototype.name=function(){return this._name},Tag.prototype.selfClosing=function(){return this._selfClosing},Tag.prototype.tail=function(){return this._selfClosing?"":"</"+this._name+">"},Tag.prototype.attr=function(t,e){return void 0===e?this._attributes[t]:(this._attributes[t]=e,this._head=null)},Tag.prototype.removeAttr=function(t){if(void 0!==this._attributes[t])return delete this._attributes[t],this._head=null},Tag.prototype.copy=function(){return new v.Tag(this._name,this._attributes)},Tag}(),v.Character=function(){function Character(t,e){this._c=t,t.length>1&&(this._c=t.toLowerCase()),this._tags=[],this.addTags.apply(this,e)}return Character.prototype.c=function(){return this._c},Character.prototype.isEntity=function(){return this._c.length>1},Character.prototype.isTag=function(t){return!(0===this._tags.length||!this._tags[0].selfClosing())&&(!t||this._tags[0].name()===t)},Character.prototype.isWhitespace=function(){var t;return" "===(t=this._c)||"\n"===t||"&nbsp;"===t||this.isTag("br")},Character.prototype.tags=function(){var t;return function(){var e,n,i,o;for(i=this._tags,o=[],e=0,n=i.length;e<n;e++)t=i[e],o.push(t.copy());return o}.call(this)},Character.prototype.addTags=function(){var t,e,n,i,o;for(e=1<=arguments.length?L.call(arguments,0):[],o=[],n=0,i=e.length;n<i;n++)t=e[n],Array.isArray(t)||(t.selfClosing()?this.isTag()||this._tags.unshift(t.copy()):o.push(this._tags.push(t.copy())));return o},Character.prototype.eq=function(t){var e,n,i,o,r,s,a,l;if(this.c()!==t.c())return!1;if(this._tags.length!==t._tags.length)return!1;for(n={},a=this._tags,i=0,r=a.length;i<r;i++)e=a[i],n[e.head()]=!0;for(l=t._tags,o=0,s=l.length;o<s;o++)if(e=l[o],!n[e.head()])return!1;return!0},Character.prototype.hasTags=function(){var t,e,n,i,o,r,s,a,l;for(i=1<=arguments.length?L.call(arguments,0):[],n={},e={},l=this._tags,o=0,s=l.length;o<s;o++)t=l[o],n[t.name()]=!0,e[t.head()]=!0;for(r=0,a=i.length;r<a;r++)if("string"==typeof(t=i[r])){if(void 0===n[t])return!1}else if(void 0===e[t.head()])return!1;return!0},Character.prototype.removeTags=function(){var t,e,n,i,o,r;if(i=1<=arguments.length?L.call(arguments,0):[],0===i.length)return void(this._tags=[]);for(e={},t={},o=0,r=i.length;o<r;o++)n=i[o],"string"==typeof n?e[n]=n:t[n.head()]=n;return[],this._tags=this._tags.filter(function(n){if(!t[n.head()]&&!e[n.name()])return n})},Character.prototype.copy=function(){var t;return new v.Character(this._c,function(){var e,n,i,o;for(i=this._tags,o=[],e=0,n=i.length;e<n;e++)t=i[e],o.push(t.copy());return o}.call(this))},Character}()}.call(this),function(){var e,n,i,o,r,s,a=[].indexOf||function(t){for(var e=0,n=this.length;e<n;e++)if(e in this&&this[e]===t)return e;return-1};e={},e.Range=function(){function Range(t,e){this.set(t,e)}return Range.prototype.isCollapsed=function(){return this._from===this._to},Range.prototype.span=function(){return this._to-this._from},Range.prototype.collapse=function(){return this._to=this._from},Range.prototype.eq=function(t){return this.get()[0]===t.get()[0]&&this.get()[1]===t.get()[1]},Range.prototype.get=function(){return[this._from,this._to]},Range.prototype.select=function(t){var n,i,r,s,a,l,u,h,c;return e.Range.unselectAll(),n=document.createRange(),h=o(t,this._from),a=h[0],u=h[1],c=o(t,this._to),i=c[0],s=c[1],l=a.length||0,r=i.length||0,n.setStart(a,Math.min(u,l)),n.setEnd(i,Math.min(s,r)),window.getSelection().addRange(n)},Range.prototype.set=function(t,e){return t=Math.max(0,t),e=Math.max(0,e),this._from=Math.min(t,e),this._to=Math.max(t,e)},Range.prepareElement=function(t){var e,i,o,r,s,a;for(o=t.querySelectorAll(n.join(", ")),a=[],e=r=0,s=o.length;r<s;e=++r)i=o[e],i.parentNode.insertBefore(document.createTextNode(""),i),e<o.length-1?a.push(i.parentNode.insertBefore(document.createTextNode(""),i.nextSibling)):a.push(void 0);return a},Range.query=function(t){var n,o,a,l,u,h,c;l=new e.Range(0,0);try{n=window.getSelection().getRangeAt(0)}catch(t){return l}return null===t.firstChild&&null===t.lastChild?l:i(n.startContainer,t)&&i(n.endContainer,t)?(c=r(t,n),u=c[0],h=c[1],o=c[2],a=c[3],l.set(s(t,u)+h,s(t,o)+a),l):l},Range.rect=function(){var t,e,n;try{t=window.getSelection().getRangeAt(0)}catch(t){return null}return t.collapsed?(e=document.createElement("span"),t.insertNode(e),n=e.getBoundingClientRect(),e.parentNode.removeChild(e),n):t.getBoundingClientRect()},Range.unselectAll=function(){if(window.getSelection())return window.getSelection().removeAllRanges()},Range}(),n=["br","img","input"],i=function(t,e){for(;t;){if(t===e)return!0;t=t.parentNode}return!1},o=function(t,e){var i,o,r,s,l;if(0===t.childNodes.length)return[t,e];for(i=null,o=e,r=function(){var e,n,i,o;for(i=t.childNodes,o=[],e=0,n=i.length;e<n;e++)s=i[e],o.push(s);return o}();r.length>0;)switch(i=r.shift(),i.nodeType){case Node.TEXT_NODE:if(i.textContent.length>=o)return[i,o];o-=i.textContent.length;break;case Node.ELEMENT_NODE:if(l=i.nodeName.toLowerCase(),a.call(n,l)>=0){if(0===o)return[i,0];o=Math.max(0,o-1)}else i.childNodes&&Array.prototype.unshift.apply(r,function(){var t,e,n,o;for(n=i.childNodes,o=[],t=0,e=n.length;t<e;t++)s=n[t],o.push(s);return o}())}return[i,o]},s=function(t,e){var i,o,r,s,l,u;if(0===t.childNodes.length)return 0;for(r=0,i=function(){var e,n,i,r;for(i=t.childNodes,r=[],e=0,n=i.length;e<n;e++)o=i[e],r.push(o);return r}();i.length>0;){if((s=i.shift())===e)return l=s.nodeName.toLowerCase(),a.call(n,l)>=0?r+1:r;switch(s.nodeType){case Node.TEXT_NODE:r+=s.textContent.length;break;case Node.ELEMENT_NODE:u=s.nodeName.toLowerCase(),a.call(n,u)>=0?r+=1:s.childNodes&&Array.prototype.unshift.apply(i,function(){var t,e,n,i;for(n=s.childNodes,i=[],t=0,e=n.length;t<e;t++)o=n[t],i.push(o);return i}())}}return r},r=function(t,e){var i,o,r,s,l,u,h,c,d,p,_,m,g,f;if(o=t.childNodes,d=e.cloneRange(),d.collapse(!0),l=e.cloneRange(),l.collapse(!1),h=d.startContainer,c=d.startOffset,r=l.endContainer,s=l.endOffset,!d.comparePoint)return[h,c,r,s];if(h===t)for(h=o[o.length-1],c=h.textContent.length,u=p=0,m=o.length;p<m;u=++p)if(i=o[u],1===d.comparePoint(i,0)){0===u?(h=i,c=0):(h=o[u-1],c=i.textContent.length),f=h.nodeName.toLowerCase,a.call(n,f)>=0&&(c=1);break}if(e.collapsed)return[h,c,h,c];if(r===t)for(r=o[o.length-1],s=r.textContent.length,u=_=0,g=o.length;_<g;u=++_)i=o[u],1===l.comparePoint(i,0)&&(r=0===u?i:o[u-1],s=i.textContent.length+1);return[h,c,r,s]},"undefined"!=typeof window&&(window.ContentSelect=e),void 0!==t&&t.exports&&(t.exports=e)}.call(this),function(){var e,n,i,o,r=[].slice,s=[].indexOf||function(t){for(var e=0,n=this.length;e<n;e++)if(e in this&&this[e]===t)return e;return-1},a={}.hasOwnProperty,l=function(t,e){function ctor(){this.constructor=t}for(var n in e)a.call(e,n)&&(t[n]=e[n]);return ctor.prototype=e.prototype,t.prototype=new ctor,t.__super__=e.prototype,t},u=function(t,e){return function(){return t.apply(e,arguments)}};e={ALIGNMENT_CLASS_NAMES:{left:"align-left",right:"align-right"},DEFAULT_MAX_ELEMENT_WIDTH:800,DEFAULT_MIN_ELEMENT_WIDTH:80,DRAG_HOLD_DURATION:500,DROP_EDGE_SIZE:50,HELPER_CHAR_LIMIT:250,INDENT:"    ",LANGUAGE:"en",LINE_ENDINGS:"\n",PREFER_LINE_BREAKS:!1,RESIZE_CORNER_SIZE:15,TRIM_WHITESPACE:!0,_translations:{},_:function(t){var n;return n=e.LANGUAGE,e._translations[n]&&e._translations[n][t]?e._translations[n][t]:t},addTranslations:function(t,n){return e._translations[t]=n},addCSSClass:function(t,e){var n,i,o;return t.classList?void t.classList.add(e):(i=t.getAttribute("class"),i?(o=function(){var t,e,o,r;for(o=i.split(" "),r=[],t=0,e=o.length;t<e;t++)n=o[t],r.push(n);return r}(),-1===o.indexOf(e)?t.setAttribute("class",i+" "+e):void 0):t.setAttribute("class",e))},attributesToString:function(t){var e,n,i,o,r,s;if(!t)return"";for(i=function(){var e;e=[];for(n in t)e.push(n);return e}(),i.sort(),e=[],r=0,s=i.length;r<s;r++)n=i[r],o=t[n],""===o?e.push(n):(o=HTMLString.String.encode(o),o=o.replace(/"/g,"&quot;"),e.push(n+'="'+o+'"'));return e.join(" ")},removeCSSClass:function(t,e){var n,i,o,r;return t.classList?(t.classList.remove(e),void(0===t.classList.length&&t.removeAttribute("class"))):(i=t.getAttribute("class"),i&&(r=function(){var t,e,o,r;for(o=i.split(" "),r=[],t=0,e=o.length;t<e;t++)n=o[t],r.push(n);return r}(),(o=r.indexOf(e))>-1)?(r.splice(o,1),r.length?t.setAttribute("class",r.join(" ")):t.removeAttribute("class")):void 0)}},"undefined"!=typeof window&&(window.ContentEdit=e),void 0!==t&&t.exports&&(t.exports=e),i=function(){function _TagNames(){this._tagNames={}}return _TagNames.prototype.register=function(){var t,e,n,i,o,s;for(t=arguments[0],n=2<=arguments.length?r.call(arguments,1):[],s=[],i=0,o=n.length;i<o;i++)e=n[i],s.push(this._tagNames[e.toLowerCase()]=t);return s},_TagNames.prototype.match=function(t){return t=t.toLowerCase(),this._tagNames[t]?this._tagNames[t]:e.Static},_TagNames}(),e.TagNames=function(){function TagNames(){}var t;return t=null,TagNames.get=function(){return null!=t?t:t=new i},TagNames}(),e.Node=function(){function Node(){this._bindings={},this._parent=null,this._modified=null}return Node.prototype.lastModified=function(){return this._modified},Node.prototype.parent=function(){return this._parent},Node.prototype.parents=function(){var t,e;for(e=[],t=this._parent;t;)e.push(t),t=t._parent;return e},Node.prototype.type=function(){return"Node"},Node.prototype.html=function(t){throw null==t&&(t=""),new Error("`html` not implemented")},Node.prototype.bind=function(t,e){return void 0===this._bindings[t]&&(this._bindings[t]=[]),this._bindings[t].push(e),e},Node.prototype.trigger=function(){var t,e,n,i,o,s,a;if(n=arguments[0],t=2<=arguments.length?r.call(arguments,1):[],this._bindings[n]){for(s=this._bindings[n],a=[],i=0,o=s.length;i<o;i++)(e=s[i])&&a.push(e.call.apply(e,[this].concat(r.call(t))));return a}},Node.prototype.unbind=function(t,e){var n,i,o,r,s,a;if(!t)return void(this._bindings={});if(!e)return void(this._bindings[t]=void 0);if(this._bindings[t]){for(s=this._bindings[t],a=[],n=o=0,r=s.length;o<r;n=++o)i=s[n],i===e?a.push(this._bindings[t].splice(n,1)):a.push(void 0);return a}},Node.prototype.commit=function(){return this._modified=null,e.Root.get().trigger("commit",this)},Node.prototype.taint=function(){var t,n,i,o,r,s;for(t=Date.now(),this._modified=t,s=this.parents(),o=0,r=s.length;o<r;o++)n=s[o],n._modified=t;return i=e.Root.get(),i._modified=t,i.trigger("taint",this)},Node.prototype.closest=function(t){var e;for(e=this.parent();e&&!t(e);)e=e.parent?e.parent():null;return e},Node.prototype.next=function(){var t,e,n,i,o,r;if(this.children&&this.children.length>0)return this.children[0];for(r=[this].concat(this.parents()),i=0,o=r.length;i<o;i++){if(n=r[i],!n.parent())return null;if(t=n.parent().children,(e=t.indexOf(n))<t.length-1)return t[e+1]}},Node.prototype.nextContent=function(){return this.nextWithTest(function(t){return void 0!==t.content})},Node.prototype.nextSibling=function(){var t;return t=this.parent().children.indexOf(this),t===this.parent().children.length-1?null:this.parent().children[t+1]},Node.prototype.nextWithTest=function(t){var e;for(e=this;e;)if((e=e.next())&&t(e))return e},Node.prototype.previous=function(){var t,e;if(!this.parent())return null;if(t=this.parent().children,t[0]===this)return this.parent();for(e=t[t.indexOf(this)-1];e.children&&e.children.length;)e=e.children[e.children.length-1];return e},Node.prototype.previousContent=function(){return this.previousWithTest(function(t){return void 0!==t.content})},Node.prototype.previousSibling=function(){var t;return t=this.parent().children.indexOf(this),0===t?null:this.parent().children[t-1]},Node.prototype.previousWithTest=function(t){var e;for(e=this;e;)if((e=e.previous())&&t(e))return e},Node.extend=function(t){var e,n,i;i=t.prototype;for(e in i)n=i[e],"constructor"!==e&&(this.prototype[e]=n);for(e in t)n=t[e],s.call("__super__",e)>=0||(this.prototype[e]=n);return this},Node.fromDOMElement=function(t){throw new Error("`fromDOMElement` not implemented")},Node}(),e.NodeCollection=function(t){function NodeCollection(){NodeCollection.__super__.constructor.call(this),this.children=[]}return l(NodeCollection,t),NodeCollection.prototype.descendants=function(){var t,e,n;for(t=[],n=this.children.slice();n.length>0;)e=n.shift(),t.push(e),e.children&&e.children.length>0&&(n=e.children.slice().concat(n));return t},NodeCollection.prototype.isMounted=function(){return!1},NodeCollection.prototype.type=function(){return"NodeCollection"},NodeCollection.prototype.attach=function(t,n){return t.parent()&&t.parent().detach(t),t._parent=this,void 0!==n?this.children.splice(n,0,t):this.children.push(t),t.mount&&this.isMounted()&&t.mount(),this.taint(),e.Root.get().trigger("attach",this,t)},NodeCollection.prototype.commit=function(){var t,n,i,o;for(o=this.descendants(),n=0,i=o.length;n<i;n++)t=o[n],t._modified=null;return this._modified=null,e.Root.get().trigger("commit",this)},NodeCollection.prototype.detach=function(t){var n;if(-1!==(n=this.children.indexOf(t)))return t.unmount&&this.isMounted()&&t.isMounted()&&t.unmount(),this.children.splice(n,1),t._parent=null,this.taint(),e.Root.get().trigger("detach",this,t)},NodeCollection}(e.Node),e.Element=function(t){function Element(t,e){Element.__super__.constructor.call(this),this._tagName=t.toLowerCase(),this._attributes=e||{},this._domElement=null,this._behaviours={drag:!0,drop:!0,merge:!0,remove:!0,resize:!0,spawn:!0}}return l(Element,t),Element.prototype.attributes=function(){var t,e,n,i;t={},i=this._attributes;for(e in i)n=i[e],t[e]=n;return t},Element.prototype.cssTypeName=function(){return"element"},Element.prototype.domElement=function(){return this._domElement},Element.prototype.isFixed=function(){return this.parent()&&"Fixture"===this.parent().type()},Element.prototype.isFocused=function(){return e.Root.get().focused()===this},Element.prototype.isMounted=function(){return null!==this._domElement},Element.prototype.type=function(){return"Element"},Element.prototype.typeName=function(){return"Element"},Element.prototype.addCSSClass=function(t){var e;if(e=!1,this.hasCSSClass(t)||(e=!0,this.attr("class")?this.attr("class",this.attr("class")+" "+t):this.attr("class",t)),this._addCSSClass(t),e)return this.taint()},Element.prototype.attr=function(t,e){return t=t.toLowerCase(),void 0===e?this._attributes[t]:(this._attributes[t]=e,this.isMounted()&&"class"!==t.toLowerCase()&&this._domElement.setAttribute(t,e),this.taint())},Element.prototype.blur=function(){var t;if(t=e.Root.get(),this.isFocused())return this._removeCSSClass("ce-element--focused"),t._focused=null,t.trigger("blur",this)},Element.prototype.can=function(t,e){return void 0===e?!this.isFixed()&&this._behaviours[t]:this._behaviours[t]=e},Element.prototype.createDraggingDOMElement=function(){var t;if(this.isMounted())return t=document.createElement("div"),t.setAttribute("class","ce-drag-helper ce-drag-helper--type-"+this.cssTypeName()),t.setAttribute("data-ce-type",e._(this.typeName())),t},Element.prototype.drag=function(t,n){var i;if(this.isMounted()&&this.can("drag"))return i=e.Root.get(),i.startDragging(this,t,n),i.trigger("drag",this)},Element.prototype.drop=function(t,n){var i;if(this.can("drop")){if(i=e.Root.get(),t){if(t._removeCSSClass("ce-element--drop"),t._removeCSSClass("ce-element--drop-"+n[0]),t._removeCSSClass("ce-element--drop-"+n[1]),this.constructor.droppers[t.type()])return this.constructor.droppers[t.type()](this,t,n),void i.trigger("drop",this,t,n);if(t.constructor.droppers[this.type()])return t.constructor.droppers[this.type()](this,t,n),void i.trigger("drop",this,t,n)}return i.trigger("drop",this,null,null)}},Element.prototype.focus=function(t){var n;if(n=e.Root.get(),!this.isFocused())return n.focused()&&n.focused().blur(),this._addCSSClass("ce-element--focused"),n._focused=this,this.isMounted()&&!t&&this.domElement().focus(),n.trigger("focus",this)},Element.prototype.hasCSSClass=function(t){var e,n;return!!(this.attr("class")&&(n=function(){var t,n,i,o;for(i=this.attr("class").split(" "),o=[],t=0,n=i.length;t<n;t++)e=i[t],o.push(e);return o}.call(this),n.indexOf(t)>-1))},Element.prototype.merge=function(t){return!(!this.can("merge")||!this.can("remove"))&&(this.constructor.mergers[t.type()]?this.constructor.mergers[t.type()](t,this):t.constructor.mergers[this.type()]?t.constructor.mergers[this.type()](t,this):void 0)},Element.prototype.mount=function(){var t;return this._domElement||(this._domElement=document.createElement(this.tagName())),t=this.nextSibling(),t?this.parent().domElement().insertBefore(this._domElement,t.domElement()):this.isFixed()?(this.parent().domElement().parentNode.replaceChild(this._domElement,this.parent().domElement()),this.parent()._domElement=this._domElement):this.parent().domElement().appendChild(this._domElement),this._addDOMEventListeners(),this._addCSSClass("ce-element"),this._addCSSClass("ce-element--type-"+this.cssTypeName()),this.isFocused()&&this._addCSSClass("ce-element--focused"),e.Root.get().trigger("mount",this)},Element.prototype.removeAttr=function(t){if(t=t.toLowerCase(),this._attributes[t])return delete this._attributes[t],this.isMounted()&&"class"!==t.toLowerCase()&&this._domElement.removeAttribute(t),this.taint()},Element.prototype.removeCSSClass=function(t){var e,n,i;if(this.hasCSSClass(t))return i=function(){var t,n,i,o;for(i=this.attr("class").split(" "),o=[],t=0,n=i.length;t<n;t++)e=i[t],o.push(e);return o}.call(this),n=i.indexOf(t),n>-1&&i.splice(n,1),i.length?this.attr("class",i.join(" ")):this.removeAttr("class"),this._removeCSSClass(t),this.taint()},Element.prototype.tagName=function(t){return void 0===t?this._tagName:(this._tagName=t.toLowerCase(),this.isMounted()&&(this.unmount(),this.mount()),this.taint())},Element.prototype.unmount=function(){return this._removeDOMEventListeners(),this.isFixed()?(this._removeCSSClass("ce-element"),this._removeCSSClass("ce-element--type-"+this.cssTypeName()),void this._removeCSSClass("ce-element--focused")):(this._domElement.parentNode&&this._domElement.parentNode.removeChild(this._domElement),this._domElement=null,e.Root.get().trigger("unmount",this))},Element.prototype._addDOMEventListeners=function(){var t,e,n,i;this._domEventHandlers={dragstart:function(t){return function(t){return t.preventDefault()}}(),focus:function(t){return function(t){return t.preventDefault()}}(),keydown:function(t){return function(e){return t._onKeyDown(e)}}(this),keyup:function(t){return function(e){return t._onKeyUp(e)}}(this),mousedown:function(t){return function(e){if(0===e.button)return t._onMouseDown(e)}}(this),mousemove:function(t){return function(e){return t._onMouseMove(e)}}(this),mouseover:function(t){return function(e){return t._onMouseOver(e)}}(this),mouseout:function(t){return function(e){return t._onMouseOut(e)}}(this),mouseup:function(t){return function(e){if(0===e.button)return t._onMouseUp(e)}}(this),dragover:function(t){return function(t){return t.preventDefault()}}(),drop:function(t){return function(e){return t._onNativeDrop(e)}}(this),paste:function(t){return function(e){return t._onPaste(e)}}(this)},n=this._domEventHandlers,i=[];for(e in n)t=n[e],i.push(this._domElement.addEventListener(e,t));return i},Element.prototype._onKeyDown=function(t){},Element.prototype._onKeyUp=function(t){},Element.prototype._onMouseDown=function(t){if(this.focus)return this.focus(!0)},Element.prototype._onMouseMove=function(t){return this._onOver(t)},Element.prototype._onMouseOver=function(t){return this._onOver(t)},Element.prototype._onMouseOut=function(t){var n;if(this._removeCSSClass("ce-element--over"),n=e.Root.get(),n.dragging())return this._removeCSSClass("ce-element--drop"),this._removeCSSClass("ce-element--drop-above"),this._removeCSSClass("ce-element--drop-below"),this._removeCSSClass("ce-element--drop-center"),this._removeCSSClass("ce-element--drop-left"),this._removeCSSClass("ce-element--drop-right"),n._dropTarget=null},Element.prototype._onMouseUp=function(t){return this._ieMouseDownEchoed=!1},Element.prototype._onNativeDrop=function(t){return t.preventDefault(),t.stopPropagation(),e.Root.get().trigger("native-drop",this,t)},Element.prototype._onPaste=function(t){return t.preventDefault(),t.stopPropagation(),e.Root.get().trigger("paste",this,t)},Element.prototype._onOver=function(t){var n,i;if(this._addCSSClass("ce-element--over"),i=e.Root.get(),(n=i.dragging())&&n!==this&&!i._dropTarget&&this.can("drop")&&(this.constructor.droppers[n.type()]||n.constructor.droppers[this.type()]))return this._addCSSClass("ce-element--drop"),i._dropTarget=this},Element.prototype._removeDOMEventListeners=function(){var t,e,n,i;n=this._domEventHandlers,i=[];for(e in n)t=n[e],i.push(this._domElement.removeEventListener(e,t));return i},Element.prototype._addCSSClass=function(t){if(this.isMounted())return e.addCSSClass(this._domElement,t)},Element.prototype._attributesToString=function(){return Object.getOwnPropertyNames(this._attributes).length>0?" "+e.attributesToString(this._attributes):""},Element.prototype._removeCSSClass=function(t){if(this.isMounted())return e.removeCSSClass(this._domElement,t)},Element.droppers={},Element.mergers={},Element.placements=["above","below"],Element.getDOMElementAttributes=function(t){var e,n,i,o,r;if(!t.hasAttributes())return{};for(n={},r=t.attributes,i=0,o=r.length;i<o;i++)e=r[i],n[e.name.toLowerCase()]=e.value;return n},Element._dropVert=function(t,e,n){var i;return t.parent().detach(t),i=e.parent().children.indexOf(e),"below"===n[0]&&(i+=1),e.parent().attach(t,i)},Element._dropBoth=function(t,n,i){var o,r,s,a,l,u,h,c;if(t.parent().detach(t),l=n.parent().children.indexOf(n),"below"===i[0]&&"center"===i[1]&&(l+=1),r=e.ALIGNMENT_CLASS_NAMES.left,s=e.ALIGNMENT_CLASS_NAMES.right,t.a){if(t._removeCSSClass(r),t._removeCSSClass(s),t.a.class){for(o=[],c=t.a.class.split(" "),u=0,h=c.length;u<h;u++)(a=c[u])!==r&&a!==s&&o.push(a);o.length?t.a.class=o.join(" "):delete t.a.class}}else t.removeCSSClass(r),t.removeCSSClass(s);return"left"===i[1]&&(t.a?(t.a.class?t.a.class+=" "+r:t.a.class=r,t._addCSSClass(r)):t.addCSSClass(r)),"right"===i[1]&&(t.a?(t.a.class?t.a.class+=" "+s:t.a.class=s,t._addCSSClass(s)):t.addCSSClass(s)),n.parent().attach(t,l)},Element}(e.Node),e.ElementCollection=function(t){function ElementCollection(t,n){ElementCollection.__super__.constructor.call(this,t,n),e.NodeCollection.prototype.constructor.call(this)}return l(ElementCollection,t),ElementCollection.extend(e.NodeCollection),ElementCollection.prototype.cssTypeName=function(){return"element-collection"},ElementCollection.prototype.isMounted=function(){return null!==this._domElement},ElementCollection.prototype.type=function(){return"ElementCollection"},ElementCollection.prototype.createDraggingDOMElement=function(){var t,n;if(this.isMounted())return t=ElementCollection.__super__.createDraggingDOMElement.call(this),n=this._domElement.textContent,n.length>e.HELPER_CHAR_LIMIT&&(n=n.substr(0,e.HELPER_CHAR_LIMIT)),t.innerHTML=n,t},ElementCollection.prototype.detach=function(t){if(e.NodeCollection.prototype.detach.call(this,t),0===this.children.length&&this.parent())return this.parent().detach(this)},ElementCollection.prototype.html=function(t){var n,i,o,r;return null==t&&(t=""),o=function(){var n,o,r,s;for(r=this.children,s=[],n=0,o=r.length;n<o;n++)i=r[n],s.push(i.html(t+e.INDENT));return s}.call(this),r=e.LINE_ENDINGS,this.isFixed()?o.join(r):(n=this._attributesToString(),t+"<"+this.tagName()+n+">"+r+o.join(r)+r+t+"</"+this.tagName()+">")},ElementCollection.prototype.mount=function(){var t,e,n,i,o,r,s,a;this._domElement=document.createElement(this._tagName),r=this._attributes;for(e in r)n=r[e],this._domElement.setAttribute(e,n);for(ElementCollection.__super__.mount.call(this),s=this.children,a=[],i=0,o=s.length;i<o;i++)t=s[i],a.push(t.mount());return a},ElementCollection.prototype.unmount=function(){var t,e,n,i;for(i=this.children,e=0,n=i.length;e<n;e++)t=i[e],t.unmount();return ElementCollection.__super__.unmount.call(this)},ElementCollection.prototype.blur=void 0,ElementCollection.prototype.focus=void 0,ElementCollection}(e.Element),e.ResizableElement=function(t){function ResizableElement(t,e){ResizableElement.__super__.constructor.call(this,t,e),this._domSizeInfoElement=null,this._aspectRatio=1}return l(ResizableElement,t),ResizableElement.prototype.aspectRatio=function(){return this._aspectRatio},ResizableElement.prototype.maxSize=function(){var t;return t=parseInt(this.attr("data-ce-max-width")||0),t||(t=e.DEFAULT_MAX_ELEMENT_WIDTH),t=Math.max(t,this.size()[0]),[t,t*this.aspectRatio()]},ResizableElement.prototype.minSize=function(){var t;return t=parseInt(this.attr("data-ce-min-width")||0),t||(t=e.DEFAULT_MIN_ELEMENT_WIDTH),t=Math.min(t,this.size()[0]),[t,t*this.aspectRatio()]},ResizableElement.prototype.type=function(){return"ResizableElement"},ResizableElement.prototype.mount=function(){return ResizableElement.__super__.mount.call(this),this._domElement.setAttribute("data-ce-size",this._getSizeInfo())},ResizableElement.prototype.resize=function(t,n,i){if(this.isMounted()&&this.can("resize"))return e.Root.get().startResizing(this,t,n,i,!0)},ResizableElement.prototype.size=function(t){var e,n,i,o;return t?(t[0]=parseInt(t[0]),t[1]=parseInt(t[1]),i=this.minSize(),t[0]=Math.max(t[0],i[0]),t[1]=Math.max(t[1],i[1]),n=this.maxSize(),t[0]=Math.min(t[0],n[0]),t[1]=Math.min(t[1],n[1]),this.attr("width",parseInt(t[0])),this.attr("height",parseInt(t[1])),this.isMounted()?(this._domElement.style.width=t[0]+"px",this._domElement.style.height=t[1]+"px",this._domElement.setAttribute("data-ce-size",this._getSizeInfo())):void 0):(o=parseInt(this.attr("width")||1),e=parseInt(this.attr("height")||1),[o,e])},ResizableElement.prototype._onMouseDown=function(t){var e;return ResizableElement.__super__._onMouseDown.call(this,t),e=this._getResizeCorner(t.clientX,t.clientY),e?this.resize(e,t.clientX,t.clientY):(clearTimeout(this._dragTimeout),this._dragTimeout=setTimeout(function(e){return function(){return e.drag(t.pageX,t.pageY)}}(this),150))},ResizableElement.prototype._onMouseMove=function(t){var e;if(ResizableElement.__super__._onMouseMove.call(this),this.can("resize"))return this._removeCSSClass("ce-element--resize-top-left"),this._removeCSSClass("ce-element--resize-top-right"),this._removeCSSClass("ce-element--resize-bottom-left"),this._removeCSSClass("ce-element--resize-bottom-right"),e=this._getResizeCorner(t.clientX,t.clientY),e?this._addCSSClass("ce-element--resize-"+e[0]+"-"+e[1]):void 0},ResizableElement.prototype._onMouseOut=function(t){return ResizableElement.__super__._onMouseOut.call(this),this._removeCSSClass("ce-element--resize-top-left"),this._removeCSSClass("ce-element--resize-top-right"),this._removeCSSClass("ce-element--resize-bottom-left"),this._removeCSSClass("ce-element--resize-bottom-right")},ResizableElement.prototype._onMouseUp=function(t){if(ResizableElement.__super__._onMouseUp.call(this),this._dragTimeout)return clearTimeout(this._dragTimeout)},ResizableElement.prototype._getResizeCorner=function(t,n){var i,o,r,s,a;return r=this._domElement.getBoundingClientRect(),a=[t-r.left,n-r.top],t=a[0],n=a[1],s=this.size(),o=e.RESIZE_CORNER_SIZE,o=Math.min(o,Math.max(parseInt(s[0]/4),1)),o=Math.min(o,Math.max(parseInt(s[1]/4),1)),i=null,t<o?n<o?i=["top","left"]:n>r.height-o&&(i=["bottom","left"]):t>r.width-o&&(n<o?i=["top","right"]:n>r.height-o&&(i=["bottom","right"])),i},ResizableElement.prototype._getSizeInfo=function(){var t;return t=this.size(),"w "+t[0]+" × h "+t[1]},ResizableElement}(e.Element),e.Region=function(t){function Region(t){Region.__super__.constructor.call(this),this._domElement=t,this.setContent(t)}return l(Region,t),Region.prototype.domElement=function(){return this._domElement},Region.prototype.isMounted=function(){return!0},Region.prototype.type=function(){return"Region"},Region.prototype.html=function(t){var n,i;return null==t&&(t=""),i=e.LINE_ENDINGS,function(){var e,i,o,r;for(o=this.children,r=[],e=0,i=o.length;e<i;e++)n=o[e],r.push(n.html(t));return r}.call(this).join(i).trim()},Region.prototype.setContent=function(t){var n,i,o,r,s,a,l,u,h,c,d,p,_,m;for(a=t,void 0===t.childNodes&&(h=document.createElement("div"),h.innerHTML=t,a=h),m=this.children.slice(),c=0,p=m.length;c<p;c++)i=m[c],this.detach(i);for(u=e.TagNames.get(),r=function(){var t,e,i,o;for(i=a.childNodes,o=[],t=0,e=i.length;t<e;t++)n=i[t],o.push(n);return o}(),d=0,_=r.length;d<_;d++)o=r[d],1===o.nodeType&&(s=o.getAttribute("data-ce-tag")?u.match(o.getAttribute("data-ce-tag")):u.match(o.tagName),l=s.fromDOMElement(o),a.removeChild(o),l&&this.attach(l));return e.Root.get().trigger("ready",this)},Region}(e.NodeCollection),e.Fixture=function(t){function Fixture(t){var n,i,o;Fixture.__super__.constructor.call(this),this._domElement=t,o=e.TagNames.get(),n=this._domElement.getAttribute("data-ce-tag")?o.match(this._domElement.getAttribute("data-ce-tag")):o.match(this._domElement.tagName),i=n.fromDOMElement(this._domElement),this.children=[i],i._parent=this,i.mount(),e.Root.get().trigger("ready",this)}return l(Fixture,t),Fixture.prototype.domElement=function(){return this._domElement},Fixture.prototype.isMounted=function(){return!0},Fixture.prototype.type=function(){return"Fixture"},Fixture.prototype.html=function(t){var n,i;return null==t&&(t=""),i=e.LINE_ENDINGS,function(){var e,i,o,r;for(o=this.children,r=[],e=0,i=o.length;e<i;e++)n=o[e],r.push(n.html(t));return r}.call(this).join(i).trim()},Fixture}(e.NodeCollection),n=function(t){function _Root(){this._onStopResizing=u(this._onStopResizing,this),this._onResize=u(this._onResize,this),this._onStopDragging=u(this._onStopDragging,this),this._onDrag=u(this._onDrag,this),_Root.__super__.constructor.call(this),this._focused=null,this._dragging=null,this._dropTarget=null,this._draggingDOMElement=null,this._resizing=null,this._resizingInit=null}return l(_Root,t),_Root.prototype.dragging=function(){return this._dragging},_Root.prototype.dropTarget=function(){return this._dropTarget},_Root.prototype.focused=function(){return this._focused},_Root.prototype.resizing=function(){return this._resizing},_Root.prototype.type=function(){return"Root"},_Root.prototype.cancelDragging=function(){if(this._dragging)return document.body.removeChild(this._draggingDOMElement),document.removeEventListener("mousemove",this._onDrag),document.removeEventListener("mouseup",this._onStopDragging),this._dragging._removeCSSClass("ce-element--dragging"),this._dragging=null,this._dropTarget=null,e.removeCSSClass(document.body,"ce--dragging")},_Root.prototype.startDragging=function(t,n,i){if(!this._dragging)return this._dragging=t,this._dragging._addCSSClass("ce-element--dragging"),this._draggingDOMElement=this._dragging.createDraggingDOMElement(),document.body.appendChild(this._draggingDOMElement),this._draggingDOMElement.style.left=n+"px",this._draggingDOMElement.style.top=i+"px",document.addEventListener("mousemove",this._onDrag),document.addEventListener("mouseup",this._onStopDragging),e.addCSSClass(document.body,"ce--dragging")},_Root.prototype._getDropPlacement=function(t,n){var i,o,r,s;return this._dropTarget?(o=this._dropTarget.domElement().getBoundingClientRect(),s=[t-o.left,n-o.top],t=s[0],n=s[1],i="center",t<e.DROP_EDGE_SIZE?i="left":t>o.width-e.DROP_EDGE_SIZE&&(i="right"),r="above",n>o.height/2&&(r="below"),[r,i]):null},_Root.prototype._onDrag=function(t){var e,n,i;if(ContentSelect.Range.unselectAll(),this._draggingDOMElement.style.left=t.pageX+"px",this._draggingDOMElement.style.top=t.pageY+"px",this._dropTarget&&(e=this._getDropPlacement(t.clientX,t.clientY),this._dropTarget._removeCSSClass("ce-element--drop-above"),this._dropTarget._removeCSSClass("ce-element--drop-below"),this._dropTarget._removeCSSClass("ce-element--drop-center"),this._dropTarget._removeCSSClass("ce-element--drop-left"),this._dropTarget._removeCSSClass("ce-element--drop-right"),n=e[0],s.call(this._dragging.constructor.placements,n)>=0&&this._dropTarget._addCSSClass("ce-element--drop-"+e[0]),i=e[1],s.call(this._dragging.constructor.placements,i)>=0))return this._dropTarget._addCSSClass("ce-element--drop-"+e[1])},_Root.prototype._onStopDragging=function(t){var e;return e=this._getDropPlacement(t.clientX,t.clientY),this._dragging.drop(this._dropTarget,e),this.cancelDragging()},_Root.prototype.startResizing=function(t,n,i,o,r){var s,a;if(!this._resizing)return this._resizing=t,this._resizingInit={corner:n,fixed:r,origin:[i,o],size:t.size()},this._resizing._addCSSClass("ce-element--resizing"),a=this._resizing.parent().domElement(),s=document.createElement("div"),s.setAttribute("class","ce-measure"),a.appendChild(s),this._resizingParentWidth=s.getBoundingClientRect().width,a.removeChild(s),document.addEventListener("mousemove",this._onResize),document.addEventListener("mouseup",this._onStopResizing),e.addCSSClass(document.body,"ce--resizing")},_Root.prototype._onResize=function(t){var e,n,i,o;return ContentSelect.Range.unselectAll(),i=this._resizingInit.origin[0]-t.clientX,"right"===this._resizingInit.corner[1]&&(i=-i),n=this._resizingInit.size[0]+i,n=Math.min(n,this._resizingParentWidth),this._resizingInit.fixed?e=n*this._resizing.aspectRatio():(o=this._resizingInit.origin[1]-t.clientY,"bottom"===this._resizingInit.corner[0]&&(o=-o),e=this._resizingInit.size[1]+o),this._resizing.size([n,e])},_Root.prototype._onStopResizing=function(t){return document.removeEventListener("mousemove",this._onResize),document.removeEventListener("mouseup",this._onStopResizing),this._resizing._removeCSSClass("ce-element--resizing"),this._resizing=null,this._resizingInit=null,this._resizingParentWidth=null,e.removeCSSClass(document.body,"ce--resizing")},_Root}(e.Node),e.Root=function(){function Root(){}var t;return t=null,Root.get=function(){return null!=t?t:t=new n},Root}(),e.Static=function(t){function Static(t,e,n){Static.__super__.constructor.call(this,t,e),this._content=n}return l(Static,t),Static.prototype.cssTypeName=function(){return"static"},Static.prototype.type=function(){return"Static"},Static.prototype.typeName=function(){return"Static"},Static.prototype.createDraggingDOMElement=function(){var t,n;if(this.isMounted())return t=Static.__super__.createDraggingDOMElement.call(this),n=this._domElement.textContent,n.length>e.HELPER_CHAR_LIMIT&&(n=n.substr(0,e.HELPER_CHAR_LIMIT)),t.innerHTML=n,t},Static.prototype.html=function(t){return null==t&&(t=""),HTMLString.Tag.SELF_CLOSING[this._tagName]?t+"<"+this._tagName+this._attributesToString()+">":t+"<"+this._tagName+this._attributesToString()+">"+this._content+t+"</"+this._tagName+">"},Static.prototype.mount=function(){var t,e,n;this._domElement=document.createElement(this._tagName),n=this._attributes;for(t in n)e=n[t],this._domElement.setAttribute(t,e);return this._domElement.innerHTML=this._content,Static.__super__.mount.call(this)},Static.prototype.blur=void 0,Static.prototype.focus=void 0,Static.prototype._onMouseDown=function(t){if(Static.__super__._onMouseDown.call(this,t),void 0!==this.attr("data-ce-moveable"))return clearTimeout(this._dragTimeout),this._dragTimeout=setTimeout(function(e){return function(){return e.drag(t.pageX,t.pageY)}}(this),150)},Static.prototype._onMouseOver=function(t){return Static.__super__._onMouseOver.call(this,t),this._removeCSSClass("ce-element--over")},Static.prototype._onMouseUp=function(t){if(Static.__super__._onMouseUp.call(this,t),this._dragTimeout)return clearTimeout(this._dragTimeout)},Static.droppers={Static:e.Element._dropVert},Static.fromDOMElement=function(t){return new this(t.tagName,this.getDOMElementAttributes(t),t.innerHTML)},Static}(e.Element),e.TagNames.get().register(e.Static,"static"),e.Text=function(t){function Text(t,n,i){Text.__super__.constructor.call(this,t,n),i instanceof HTMLString.String?this.content=i:e.TRIM_WHITESPACE?this.content=new HTMLString.String(i).trim():this.content=new HTMLString.String(i,!0)}return l(Text,t),Text.prototype.cssTypeName=function(){return"text"},Text.prototype.type=function(){return"Text"},Text.prototype.typeName=function(){return"Text"},Text.prototype.blur=function(){return this.isMounted()&&this._syncContent(),this.content.isWhitespace()&&this.can("remove")?this.parent()&&this.parent().detach(this):this.isMounted()&&(document.documentMode||/Edge/.test(navigator.userAgent)||this._domElement.blur(),this._domElement.removeAttribute("contenteditable")),Text.__super__.blur.call(this)},Text.prototype.createDraggingDOMElement=function(){var t,n;if(this.isMounted())return t=Text.__super__.createDraggingDOMElement.call(this),n=HTMLString.String.encode(this._domElement.textContent),n.length>e.HELPER_CHAR_LIMIT&&(n=n.substr(0,e.HELPER_CHAR_LIMIT)),t.innerHTML=n,t},Text.prototype.drag=function(t,e){return this.storeState(),this._domElement.removeAttribute("contenteditable"),Text.__super__.drag.call(this,t,e)},Text.prototype.drop=function(t,e){return Text.__super__.drop.call(this,t,e),this.restoreState()},Text.prototype.focus=function(t){return this.isMounted()&&this._domElement.setAttribute("contenteditable",""),Text.__super__.focus.call(this,t)},Text.prototype.html=function(t){var n,i,o;return null==t&&(t=""),(!this._lastCached||this._lastCached<this._modified)&&(i=e.TRIM_WHITESPACE?this.content.copy().trim():this.content.copy(),i.optimize(),this._lastCached=Date.now(),this._cached=i.html()),o=e.LINE_ENDINGS,n=this._attributesToString(),t+"<"+this._tagName+n+">"+o+t+e.INDENT+this._cached+o+t+"</"+this._tagName+">"},Text.prototype.mount=function(){var t,e,n;this._domElement=document.createElement(this._tagName),n=this._attributes;for(t in n)e=n[t],this._domElement.setAttribute(t,e);return this.updateInnerHTML(),Text.__super__.mount.call(this)},Text.prototype.restoreState=function(){if(this._savedSelection)return this.isMounted()&&this.isFocused()?(this._domElement.setAttribute("contenteditable",""),this._addCSSClass("ce-element--focused"),document.activeElement!==this.domElement()&&this.domElement().focus(),this._savedSelection.select(this._domElement),this._savedSelection=void 0):void(this._savedSelection=void 0)},Text.prototype.selection=function(t){return void 0===t?this.isMounted()?ContentSelect.Range.query(this._domElement):new ContentSelect.Range(0,0):t.select(this._domElement)},Text.prototype.storeState=function(){if(this.isMounted()&&this.isFocused())return this._savedSelection=ContentSelect.Range.query(this._domElement)},Text.prototype.unmount=function(){return this._domElement.removeAttribute("contenteditable"),Text.__super__.unmount.call(this)},Text.prototype.updateInnerHTML=function(){return this._domElement.innerHTML=this.content.html(),ContentSelect.Range.prepareElement(this._domElement),this._flagIfEmpty()},Text.prototype._onKeyDown=function(t){switch(t.keyCode){case 40:return this._keyDown(t);case 37:return this._keyLeft(t);case 39:return this._keyRight(t);case 38:return this._keyUp(t);case 9:return this._keyTab(t);case 8:return this._keyBack(t);case 46:return this._keyDelete(t);case 13:return this._keyReturn(t)}},Text.prototype._onKeyUp=function(t){return Text.__super__._onKeyUp.call(this,t),this._syncContent()},Text.prototype._onMouseDown=function(t){if(Text.__super__._onMouseDown.call(this,t),clearTimeout(this._dragTimeout),this._dragTimeout=setTimeout(function(e){return function(){return e.drag(t.pageX,t.pageY)}}(this),e.DRAG_HOLD_DURATION),0===this.content.length()&&e.Root.get().focused()===this)return t.preventDefault(),document.activeElement!==this._domElement&&this._domElement.focus(),new ContentSelect.Range(0,0).select(this._domElement)},Text.prototype._onMouseMove=function(t){return this._dragTimeout&&clearTimeout(this._dragTimeout),Text.__super__._onMouseMove.call(this,t)},Text.prototype._onMouseOut=function(t){return this._dragTimeout&&clearTimeout(this._dragTimeout),Text.__super__._onMouseOut.call(this,t)},Text.prototype._onMouseUp=function(t){return this._dragTimeout&&clearTimeout(this._dragTimeout),Text.__super__._onMouseUp.call(this,t)},Text.prototype._keyBack=function(t){var e,n;if(n=ContentSelect.Range.query(this._domElement),0===n.get()[0]&&n.isCollapsed())return t.preventDefault(),e=this.previousContent(),this._syncContent(),e?e.merge(this):void 0},Text.prototype._keyDelete=function(t){var e,n;if(n=ContentSelect.Range.query(this._domElement),this._atEnd(n)&&n.isCollapsed())return t.preventDefault(),e=this.nextContent(),e?this.merge(e):void 0},Text.prototype._keyDown=function(t){return this._keyRight(t)},Text.prototype._keyLeft=function(t){var n,i;if(i=ContentSelect.Range.query(this._domElement),0===i.get()[0]&&i.isCollapsed())return t.preventDefault(),n=this.previousContent(),n?(n.focus(),i=new ContentSelect.Range(n.content.length(),n.content.length()),i.select(n.domElement())):e.Root.get().trigger("previous-region",this.closest(function(t){return"Fixture"===t.type()||"Region"===t.type()}))},Text.prototype._keyReturn=function(t){var n,i,o,r,s,a;if(t.preventDefault(),!(this.content.isWhitespace()&&!t.shiftKey^e.PREFER_LINE_BREAKS)){if(r=ContentSelect.Range.query(this._domElement),a=this.content.substring(0,r.get()[0]),s=this.content.substring(r.get()[1]),t.shiftKey^e.PREFER_LINE_BREAKS)return i=r.get()[0],o="<br>",this.content.length()===i&&(0!==this.content.length()&&this.content.characters[i-1].isTag("br")||(o="<br><br>")),this.content=this.content.insert(i,new HTMLString.String(o,!0),!0),this.updateInnerHTML(),i+=1,r=new ContentSelect.Range(i,i),r.select(this.domElement()),void this.taint();if(this.can("spawn"))return this.content=a.trim(),this.updateInnerHTML(),n=new this.constructor("p",{},s.trim()),this.parent().attach(n,this.parent().children.indexOf(this)+1),a.length()?(n.focus(),r=new ContentSelect.Range(0,0),r.select(n.domElement())):(r=new ContentSelect.Range(0,a.length()),r.select(this._domElement)),this.taint()}},Text.prototype._keyRight=function(t){var n,i;if(i=ContentSelect.Range.query(this._domElement),this._atEnd(i)&&i.isCollapsed())return t.preventDefault(),n=this.nextContent(),n?(n.focus(),i=new ContentSelect.Range(0,0),i.select(n.domElement())):e.Root.get().trigger("next-region",this.closest(function(t){return"Fixture"===t.type()||"Region"===t.type()}))},Text.prototype._keyTab=function(t){if(t.preventDefault(),this.isFixed())return t.shiftKey?e.Root.get().trigger("previous-region",this.closest(function(t){return"Fixture"===t.type()||"Region"===t.type()})):e.Root.get().trigger("next-region",this.closest(function(t){return"Fixture"===t.type()||"Region"===t.type()}))},Text.prototype._keyUp=function(t){return this._keyLeft(t)},Text.prototype._atEnd=function(t){return t.get()[0]>=this.content.length()},Text.prototype._flagIfEmpty=function(){return 0===this.content.length()?this._addCSSClass("ce-element--empty"):this._removeCSSClass("ce-element--empty")},Text.prototype._syncContent=function(t){var e,n;return n=this.content.html(),this.content=new HTMLString.String(this._domElement.innerHTML,this.content.preserveWhitespace()),e=this.content.html(),n!==e&&this.taint(),this._flagIfEmpty()},Text.droppers={Static:e.Element._dropVert,Text:e.Element._dropVert},Text.mergers={Text:function(t,e){var n;return n=e.content.length(),t.content.length()&&(e.content=e.content.concat(t.content)),e.isMounted()&&e.updateInnerHTML(),e.focus(),new ContentSelect.Range(n,n).select(e._domElement),t.parent()&&t.parent().detach(t),e.taint()}},Text.fromDOMElement=function(t){return new this(t.tagName,this.getDOMElementAttributes(t),t.innerHTML.replace(/^\s+|\s+$/g,""))},Text}(e.Element),e.TagNames.get().register(e.Text,"address","blockquote","h1","h2","h3","h4","h5","h6","p"),e.PreText=function(t){function PreText(t,n,i){i instanceof HTMLString.String?this.content=i:this.content=new HTMLString.String(i,!0),e.Element.call(this,t,n)}return l(PreText,t),PreText.TAB_INDENT="    ",PreText.prototype.cssTypeName=function(){return"pre-text"},PreText.prototype.type=function(){return"PreText"},PreText.prototype.typeName=function(){return"Preformatted"},PreText.prototype.blur=function(){return this.isMounted()&&(this._domElement.innerHTML=this.content.html()),PreText.__super__.blur.call(this)},PreText.prototype.html=function(t){var e;return null==t&&(t=""),(!this._lastCached||this._lastCached<this._modified)&&(e=this.content.copy(),e.optimize(),this._lastCached=Date.now(),this._cached=e.html()),t+"<"+this._tagName+this._attributesToString()+">"+this._cached+"</"+this._tagName+">"},PreText.prototype.updateInnerHTML=function(){var t;return t=this.content.html(),this._domElement.innerHTML=t,this._ensureEndZWS(),ContentSelect.Range.prepareElement(this._domElement),this._flagIfEmpty()},PreText.prototype._keyBack=function(t){var e;return e=ContentSelect.Range.query(this._domElement),e.get()[0]<=this.content.length()?PreText.__super__._keyBack.call(this,t):(e.set(this.content.length(),this.content.length()),e.select(this._domElement))},PreText.prototype._keyReturn=function(t){var e,n,i,o;return t.preventDefault(),n=ContentSelect.Range.query(this._domElement),e=n.get()[0]+1,0===n.get()[0]&&n.isCollapsed()?this.content=new HTMLString.String("\n",!0).concat(this.content):this._atEnd(n)&&n.isCollapsed()?this.content=this.content.concat(new HTMLString.String("\n",!0)):0===n.get()[0]&&n.get()[1]===this.content.length()?(this.content=new HTMLString.String("\n",!0),e=0):(o=this.content.substring(0,n.get()[0]),i=this.content.substring(n.get()[1]),this.content=o.concat(new HTMLString.String("\n",!0),i)),this.updateInnerHTML(),n.set(e,e),n.select(this._domElement),this.taint()},PreText.prototype._keyTab=function(t){var n,i,o,r,s,a,l,u,h,c,d,p,_,m,g,f,v,y,E,C,T,I,b,S,w,L;for(t.preventDefault(),n=this.content.length(),h=e.PreText.TAB_INDENT,u=h.length,_=this.content.split("\n"),m=this.selection().get(),m[0]=Math.min(m[0],n),m[1]=Math.min(m[1],n),o=0,v=-1,r=-1,a=C=0,S=_.length;C<S&&(d=_[a],p=d.length()+1,m[0]<o+p&&-1===v&&(v=a),m[1]<o+p&&-1===r&&(r=a),!(v>-1&&r>-1));a=++C)o+=p;if(v===r)u-=(m[0]-o)%u,l=new HTMLString.String(Array(u+1).join(" "),!0),E=_[v].substring(0,m[0]-o),y=_[v].substring(m[1]-o),_[v]=E.concat(l,y),f=u;else if(t.shiftKey){for(s=0,a=T=v;v<=r?T<=r:T>=r;a=v<=r?++T:--T){for(L=_[a].characters.slice(),c=I=0,w=L.length;I<w&&(i=L[c],!(c>u-1))&&i.isWhitespace();c=++I)_[a].characters.shift();a===v&&(s=c)}f=Math.max(-u,-s)}else{for(l=new HTMLString.String(h,!0),a=b=v;v<=r?b<=r:b>=r;a=v<=r?++b:--b)_[a]=l.concat(_[a]);f=u}return this.content=HTMLString.String.join(new HTMLString.String("\n",!0),_),this.updateInnerHTML(),g=this.content.length()-n,new ContentSelect.Range(m[0]+f,m[1]+g).select(this._domElement)},PreText.prototype._syncContent=function(t){var e,n;return this._ensureEndZWS(),n=this.content.html(),this.content=new HTMLString.String(this._domElement.innerHTML.replace(/\u200B$/g,""),this.content.preserveWhitespace()),e=this.content.html(),n!==e&&this.taint(),this._flagIfEmpty()},PreText.prototype._ensureEndZWS=function(){var t,e;if(this._domElement.lastChild&&(t=this._domElement.innerHTML,!("​"===t[t.length-1]&&t.indexOf("​")<t.length-1)))return e=function(e){return function(){return t.indexOf("​")>-1&&(e._domElement.innerHTML=t.replace(/\u200B/g,"")),e._domElement.lastChild.textContent+="​"}}(this),this._savedSelection?e():(this.storeState(),e(),this.restoreState())},PreText.droppers={PreText:e.Element._dropVert,Static:e.Element._dropVert,Text:e.Element._dropVert},PreText.mergers={},PreText.fromDOMElement=function(t){return new this(t.tagName,this.getDOMElementAttributes(t),t.innerHTML)},PreText}(e.Text),e.TagNames.get().register(e.PreText,"pre"),e.Image=function(t){function Image(t,e){var n;Image.__super__.constructor.call(this,"img",t),this.a=e||null,n=this.size(),this._aspectRatio=n[1]/n[0]}return l(Image,t),Image.prototype.cssTypeName=function(){return"image"},Image.prototype.type=function(){return"Image"},Image.prototype.typeName=function(){return"Image"},Image.prototype.createDraggingDOMElement=function(){var t;if(this.isMounted())return t=Image.__super__.createDraggingDOMElement.call(this),t.style.backgroundImage="url('"+this._attributes.src+"')",t},Image.prototype.html=function(t){var n,i,o;return null==t&&(t=""),i=t+"<img"+this._attributesToString()+">",this.a?(o=e.LINE_ENDINGS,n=e.attributesToString(this.a),n+=' data-ce-tag="img"',t+"<a "+n+">"+o+e.INDENT+i+o+t+"</a>"):i},Image.prototype.mount=function(){var t,e;return this._domElement=document.createElement("div"),t="",this.a&&this.a.class&&(t+=" "+this.a.class),this._attributes.class&&(t+=" "+this._attributes.class),this._domElement.setAttribute("class",t),e=this._attributes.style?this._attributes.style:"",e+="background-image:url('"+this._attributes.src+"');",this._attributes.width&&(e+="width:"+this._attributes.width+"px;"),this._attributes.height&&(e+="height:"+this._attributes.height+"px;"),this._domElement.setAttribute("style",e),Image.__super__.mount.call(this)},Image.prototype.unmount=function(){var t,e;return this.isFixed()&&(e=document.createElement("div"),e.innerHTML=this.html(),t=e.querySelector("a, img"),this._domElement.parentNode.replaceChild(t,this._domElement),this._domElement=t),Image.__super__.unmount.call(this)},Image.droppers={Image:e.Element._dropBoth,PreText:e.Element._dropBoth,Static:e.Element._dropBoth,Text:e.Element._dropBoth},Image.placements=["above","below","left","right","center"],Image.fromDOMElement=function(t){var e,n,i,o,r,s,a,l,u;if(e=null,"a"===t.tagName.toLowerCase()){for(e=this.getDOMElementAttributes(t),r=function(){var e,n,o,r;for(o=t.childNodes,r=[],e=0,n=o.length;e<n;e++)i=o[e],r.push(i);return r}(),l=0,u=r.length;l<u;l++)if(o=r[l],1===o.nodeType&&"img"===o.tagName.toLowerCase()){t=o;break}"a"===t.tagName.toLowerCase()&&(t=document.createElement("img"))}return n=this.getDOMElementAttributes(t),a=n.width,s=n.height,void 0===n.width&&(a=void 0===n.height?t.naturalWidth:t.clientWidth),void 0===n.height&&(s=void 0===n.width?t.naturalHeight:t.clientHeight),n.width=a,n.height=s,new this(n,e)},Image}(e.ResizableElement),e.TagNames.get().register(e.Image,"img"),e.ImageFixture=function(t){function ImageFixture(t,e,n){ImageFixture.__super__.constructor.call(this,t,e),this._src=n}return l(ImageFixture,t),ImageFixture.prototype.cssTypeName=function(){return"image-fixture"},ImageFixture.prototype.type=function(){return"ImageFixture"},ImageFixture.prototype.typeName=function(){return"ImageFixture"},ImageFixture.prototype.html=function(t){var n,i,o,r;return null==t&&(t=""),r=e.LINE_ENDINGS,i=this._attributesToString(),n="",void 0!==this._attributes.alt&&(n='alt="'+this._attributes.alt+'"'),o=t+'<img src="'+this.src()+'"'+n+">",t+"<"+this.tagName()+" "+i+">"+r+e.INDENT+o+r+t+"</"+this.tagName()+">"},ImageFixture.prototype.mount=function(){var t,e,n,i,o;this._domElement=document.createElement(this.tagName()),o=this._attributes;for(e in o)i=o[e],"alt"!==e&&"style"!==e&&this._domElement.setAttribute(e,i);return t="",this.a&&this.a.class&&(t+=" "+this.a.class),this._attributes.class&&(t+=" "+this._attributes.class),this._domElement.setAttribute("class",t),n=this._attributes.style?this._attributes.style:"",n=n.replace(/background-image:.+?(;|$)/i,""),n=[n.trim(),"background-image:url('"+this.src()+"');"].join(" "),this._domElement.setAttribute("style",n.trim()),ImageFixture.__super__.mount.call(this)},ImageFixture.prototype.src=function(t){return void 0===t?this._src:(this._src=t.toLowerCase(),this.isMounted()&&(this.unmount(),this.mount()),this.taint())},ImageFixture.prototype.unmount=function(){var t,e;return this.isFixed()?(e=document.createElement("div"),e.innerHTML=this.html(),t=e.firstElementChild,this._domElement.parentNode.replaceChild(t,this._domElement),this._domElement=t,this.parent()._domElement=this._domElement):ImageFixture.__super__.unmount.call(this)},ImageFixture.prototype._attributesToString=function(){var t,n,i,o,r;this._attributes.style?(i=this._attributes.style?this._attributes.style:"",i=i.replace(/background-image:.+?(;|$)/i,""),i=[i.trim(),"background-image:url('"+this.src()+"');"].join(" "),this._attributes.style=i.trim()):this._attributes.style="background-image:url('"+this.src()+"');",t={},r=this._attributes;for(n in r)o=r[n],"alt"!==n&&(t[n]=o);return" "+e.attributesToString(t)},ImageFixture.droppers={ImageFixture:e.Element._dropVert,Image:e.Element._dropVert,PreText:e.Element._dropVert,Text:e.Element._dropVert},ImageFixture.fromDOMElement=function(t){var e,n,i,o,r,s,a,l;for(t.tagName,n=this.getDOMElementAttributes(t),s="",e="",r=function(){var e,n,o,r;for(o=t.childNodes,r=[],e=0,n=o.length;e<n;e++)i=o[e],r.push(i);return r}(),a=0,l=r.length;a<l;a++)if(o=r[a],1===o.nodeType&&"img"===o.tagName.toLowerCase()){s=o.getAttribute("src")||"",e=o.getAttribute("alt")||"";break}return n=this.getDOMElementAttributes(t),n.alt=e,new this(t.tagName,n,s)},ImageFixture}(e.Element),e.TagNames.get().register(e.ImageFixture,"img-fixture"),e.Video=function(t){function Video(t,e,n){var i;null==n&&(n=[]),Video.__super__.constructor.call(this,t,e),this.sources=n,i=this.size(),this._aspectRatio=i[1]/i[0]}return l(Video,t),Video.prototype.cssTypeName=function(){return"video"},Video.prototype.type=function(){return"Video"},Video.prototype.typeName=function(){return"Video"},Video.prototype._title=function(){var t;return t="",this.attr("src")?t=this.attr("src"):this.sources.length&&(t=this.sources[0].src),t||(t="No video source set"),t.length>80&&(t=t.substr(0,80)+"..."),t},Video.prototype.createDraggingDOMElement=function(){var t;if(this.isMounted())return t=Video.__super__.createDraggingDOMElement.call(this),t.innerHTML=this._title(),t},Video.prototype.html=function(t){var n,i,o,r,s,a,l;if(null==t&&(t=""),i=e.LINE_ENDINGS,"video"===this.tagName()){for(r=[],l=this.sources,s=0,a=l.length;s<a;s++)o=l[s],n=e.attributesToString(o),r.push(""+t+e.INDENT+"<source "+n+">");return t+"<video"+this._attributesToString()+">"+i+r.join(i)+i+t+"</video>"}return t+"<"+this._tagName+this._attributesToString()+"></"+this._tagName+">"},Video.prototype.mount=function(){var t;return this._domElement=document.createElement("div"),this.a&&this.a.class?this._domElement.setAttribute("class",this.a.class):this._attributes.class&&this._domElement.setAttribute("class",this._attributes.class),t=this._attributes.style?this._attributes.style:"",this._attributes.width&&(t+="width:"+this._attributes.width+"px;"),this._attributes.height&&(t+="height:"+this._attributes.height+"px;"),this._domElement.setAttribute("style",t),this._domElement.setAttribute("data-ce-title",this._title()),Video.__super__.mount.call(this)},Video.prototype.unmount=function(){var t,e;return this.isFixed()&&(e=document.createElement("div"),e.innerHTML=this.html(),t=e.querySelector("iframe"),this._domElement.parentNode.replaceChild(t,this._domElement),this._domElement=t),Video.__super__.unmount.call(this)},Video.droppers={Image:e.Element._dropBoth,PreText:e.Element._dropBoth,Static:e.Element._dropBoth,Text:e.Element._dropBoth,Video:e.Element._dropBoth},Video.placements=["above","below","left","right","center"],Video.fromDOMElement=function(t){var e,n,i,o,r,s;for(i=function(){var n,i,o,r;for(o=t.childNodes,r=[],n=0,i=o.length;n<i;n++)e=o[n],r.push(e);return r}(),o=[],r=0,s=i.length;r<s;r++)n=i[r],1===n.nodeType&&"source"===n.tagName.toLowerCase()&&o.push(this.getDOMElementAttributes(n));return new this(t.tagName,this.getDOMElementAttributes(t),o)},Video}(e.ResizableElement),e.TagNames.get().register(e.Video,"iframe","video"),e.List=function(t){function List(t,e){List.__super__.constructor.call(this,t,e)}return l(List,t),List.prototype.cssTypeName=function(){return"list"},List.prototype.type=function(){return"List"},List.prototype.typeName=function(){return"List"},List.prototype._onMouseOver=function(t){if("ListItem"!==this.parent().type())return List.__super__._onMouseOver.call(this,t),this._removeCSSClass("ce-element--over")},List.droppers={Image:e.Element._dropBoth,ImageFixture:e.Element._dropVert,List:e.Element._dropVert,PreText:e.Element._dropVert,Static:e.Element._dropVert,Text:e.Element._dropVert,Video:e.Element._dropBoth},List.fromDOMElement=function(t){var n,i,o,r,s,a;for(r=new this(t.tagName,this.getDOMElementAttributes(t)),o=function(){var e,i,o,r;for(o=t.childNodes,r=[],e=0,i=o.length;e<i;e++)n=o[e],r.push(n);return r}(),s=0,a=o.length;s<a;s++)i=o[s],1===i.nodeType&&"li"===i.tagName.toLowerCase()&&r.attach(e.ListItem.fromDOMElement(i));return 0===r.children.length?null:r},List}(e.ElementCollection),e.TagNames.get().register(e.List,"ol","ul"),e.ListItem=function(t){function ListItem(t){ListItem.__super__.constructor.call(this,"li",t),this._behaviours.indent=!0}return l(ListItem,t),ListItem.prototype.cssTypeName=function(){return"list-item"},ListItem.prototype.list=function(){return 2===this.children.length?this.children[1]:null},ListItem.prototype.listItemText=function(){return this.children.length>0?this.children[0]:null},ListItem.prototype.type=function(){return"ListItem"},ListItem.prototype.html=function(t){var n;return null==t&&(t=""),n=[t+"<li"+this._attributesToString()+">"],this.listItemText()&&n.push(this.listItemText().html(t+e.INDENT)),this.list()&&n.push(this.list().html(t+e.INDENT)),n.push(t+"</li>"),n.join(e.LINE_ENDINGS)},ListItem.prototype.indent=function(){var t;if(this.can("indent")&&0!==this.parent().children.indexOf(this))return t=this.previousSibling(),t.list()||t.attach(new e.List(t.parent().tagName())),this.listItemText().storeState(),this.parent().detach(this),t.list().attach(this),this.listItemText().restoreState()},ListItem.prototype.remove=function(){var t,e,n,i,o,r;if(this.parent()){if(n=this.parent().children.indexOf(this),this.list())for(r=this.list().children.slice(),e=i=0,o=r.length;i<o;e=++i)t=r[e],t.parent().detach(t),this.parent().attach(t,e+n);return this.parent().detach(this)}},ListItem.prototype.unindent=function(){var t,n,i,o,r,s,a,l,u,h,c,d,p,_,m,g,f,v,y,E,C;if(this.can("indent")){if(s=this.parent(),n=s.parent(),h=s.children.slice(s.children.indexOf(this)+1,s.children.length),"ListItem"===n.type()){for(this.listItemText().storeState(),s.detach(this),n.parent().attach(this,n.parent().children.indexOf(n)+1),h.length&&!this.list()&&this.attach(new e.List(s.tagName())),d=0,g=h.length;d<g;d++)u=h[d],u.parent().detach(u),this.list().attach(u);return this.listItemText().restoreState()}if(c=new e.Text("p",this.attr("class")?{class:this.attr("class")}:{},this.listItemText().content),l=null,this.listItemText().isFocused()&&(l=ContentSelect.Range.query(this.listItemText().domElement())),a=n.children.indexOf(s),0===(o=s.children.indexOf(this))){if(r=null,1===s.children.length?(this.list()&&(r=new e.List(s.tagName())),n.detach(s)):s.detach(this),n.attach(c,a),r&&n.attach(r,a+1),this.list())for(E=this.list().children.slice(),i=p=0,f=E.length;p<f;i=++p)t=E[i],t.parent().detach(t),r?r.attach(t):s.attach(t,i)}else if(o===s.children.length-1)s.detach(this),n.attach(c,a+1),this.list()&&n.attach(this.list(),a+2);else{if(s.detach(this),n.attach(c,a+1),r=new e.List(s.tagName()),n.attach(r,a+2),this.list())for(C=this.list().children.slice(),_=0,v=C.length;_<v;_++)t=C[_],t.parent().detach(t),r.attach(t);for(m=0,y=h.length;m<y;m++)u=h[m],u.parent().detach(u),r.attach(u)}return l?(c.focus(),l.select(c.domElement())):void 0}},ListItem.prototype._onMouseOver=function(t){return ListItem.__super__._onMouseOver.call(this,t),this._removeCSSClass("ce-element--over")},ListItem.prototype._addDOMEventListeners=function(){},ListItem.prototype._removeDOMEventListners=function(){},ListItem.fromDOMElement=function(t){var n,i,o,r,s,a,l,u,h,c;for(s=new this(this.getDOMElementAttributes(t)),i="",o=null,h=t.childNodes,l=0,u=h.length;l<u;l++)n=h[l],1===n.nodeType?"ul"===(c=n.tagName.toLowerCase())||"ol"===c||"li"===c?o||(o=n):i+=n.outerHTML:i+=HTMLString.String.encode(n.textContent);return i=i.replace(/^\s+|\s+$/g,""),a=new e.ListItemText(i),s.attach(a),o&&(r=e.List.fromDOMElement(o),s.attach(r)),s},ListItem}(e.ElementCollection),e.ListItemText=function(t){function ListItemText(t){ListItemText.__super__.constructor.call(this,"div",{},t)}return l(ListItemText,t),ListItemText.prototype.cssTypeName=function(){return"list-item-text"},ListItemText.prototype.type=function(){return"ListItemText"},ListItemText.prototype.typeName=function(){return"List item"},ListItemText.prototype.blur=function(){return this.content.isWhitespace()&&this.can("remove")?this.parent().remove():this.isMounted()&&(this._domElement.blur(),this._domElement.removeAttribute("contenteditable")),e.Element.prototype.blur.call(this)},ListItemText.prototype.can=function(t,e){if(e)throw new Error("Cannot set behaviour for ListItemText");return this.parent().can(t)},ListItemText.prototype.html=function(t){var n;return null==t&&(t=""),(!this._lastCached||this._lastCached<this._modified)&&(n=e.TRIM_WHITESPACE?this.content.copy().trim():this.content.copy(),n.optimize(),this._lastCached=Date.now(),this._cached=n.html()),""+t+this._cached},ListItemText.prototype._onMouseDown=function(t){var n;return e.Element.prototype._onMouseDown.call(this,t),n=function(i){return function(){var o;return e.Root.get().dragging()===i?(e.Root.get().cancelDragging(),o=i.closest(function(t){return"Region"===t.parent().type()}),o.drag(t.pageX,t.pageY)):(i.drag(t.pageX,t.pageY),i._dragTimeout=setTimeout(n,2*e.DRAG_HOLD_DURATION))}}(this),clearTimeout(this._dragTimeout),this._dragTimeout=setTimeout(n,e.DRAG_HOLD_DURATION)},ListItemText.prototype._onMouseMove=function(t){return this._dragTimeout&&clearTimeout(this._dragTimeout),e.Element.prototype._onMouseMove.call(this,t)},ListItemText.prototype._onMouseUp=function(t){return this._dragTimeout&&clearTimeout(this._dragTimeout),e.Element.prototype._onMouseUp.call(this,t)},ListItemText.prototype._keyTab=function(t){return t.preventDefault(),t.shiftKey?this.parent().unindent():this.parent().indent()},ListItemText.prototype._keyReturn=function(t){var n,i,o,r,s,a;return t.preventDefault(),this.content.isWhitespace()?void this.parent().unindent():this.can("spawn")?(ContentSelect.Range.query(this._domElement),r=ContentSelect.Range.query(this._domElement),a=this.content.substring(0,r.get()[0]),s=this.content.substring(r.get()[1]),a.length()+s.length()===0?void this.parent().unindent():(this.content=a.trim(),this.updateInnerHTML(),n=this.parent().parent(),o=new e.ListItem(this.attr("class")?{class:this.attr("class")}:{}),n.attach(o,n.children.indexOf(this.parent())+1),o.attach(new e.ListItemText(s.trim())),i=this.parent().list(),i&&(this.parent().detach(i),o.attach(i)),a.length()?(o.listItemText().focus(),r=new ContentSelect.Range(0,0),r.select(o.listItemText().domElement())):(r=new ContentSelect.Range(0,a.length()),r.select(this._domElement)),this.taint())):void 0},ListItemText.droppers={ListItemText:function(t,n,i){var o,r,s,a;return o=t.parent(),a=n.parent(),o.remove(),o.detach(t),s=new e.ListItem(o._attributes),s.attach(t),a.list()&&"below"===i[0]?void a.list().attach(s,0):(r=a.parent().children.indexOf(a),"below"===i[0]&&(r+=1),a.parent().attach(s,r))},Text:function(t,n,i){var o,r,s,a,l;if("Text"===t.type()){if(a=n.parent(),t.parent().detach(t),o=t.attr("class"),s=new e.ListItem(o?{class:o}:{}),s.attach(new e.ListItemText(t.content)),a.list()&&"below"===i[0])return void a.list().attach(s,0);if(r=a.parent().children.indexOf(a),"below"===i[0]&&(r+=1),a.parent().attach(s,r),s.listItemText().focus(),t._savedSelection)return t._savedSelection.select(s.listItemText().domElement())}else if(o=t.attr("class"),l=new e.Text("p",o?{class:o}:{},t.content),t.parent().remove(),r=n.parent().children.indexOf(n),"below"===i[0]&&(r+=1),n.parent().attach(l,r),l.focus(),t._savedSelection)return t._savedSelection.select(l.domElement())}},ListItemText.mergers={ListItemText:function(t,e){var n;return n=e.content.length(),t.content.length()&&(e.content=e.content.concat(t.content)),e.isMounted()&&(e._domElement.innerHTML=e.content.html()),e.focus(),new ContentSelect.Range(n,n).select(e._domElement),"Text"===t.type()?t.parent()&&t.parent().detach(t):t.parent().remove(),e.taint()}},ListItemText}(e.Text),o=e.ListItemText.mergers,o.Text=o.ListItemText,e.Table=function(t){function Table(t){Table.__super__.constructor.call(this,"table",t)}return l(Table,t),Table.prototype.cssTypeName=function(){return"table"},Table.prototype.typeName=function(){return"Table"},Table.prototype.type=function(){return"Table"},Table.prototype.firstSection=function(){var t;return(t=this.thead())?t:(t=this.tbody())?t:(t=this.tfoot())?t:null},Table.prototype.lastSection=function(){var t;return(t=this.tfoot())?t:(t=this.tbody())?t:(t=this.thead())?t:null},Table.prototype.tbody=function(){return this._getChild("tbody")},Table.prototype.tfoot=function(){return this._getChild("tfoot")},Table.prototype.thead=function(){return this._getChild("thead")},Table.prototype._onMouseOver=function(t){return Table.__super__._onMouseOver.call(this,t),this._removeCSSClass("ce-element--over")},Table.prototype._getChild=function(t){var e,n,i,o;for(o=this.children,n=0,i=o.length;n<i;n++)if(e=o[n],e.tagName()===t)return e;return null},Table.droppers={Image:e.Element._dropBoth,ImageFixture:e.Element._dropVert,List:e.Element._dropVert,PreText:e.Element._dropVert,Static:e.Element._dropVert,Table:e.Element._dropVert,Text:e.Element._dropVert,Video:e.Element._dropBoth},Table.fromDOMElement=function(t){var n,i,o,r,s,a,l,u,h,c,d,p;for(l=new this(this.getDOMElementAttributes(t)),o=function(){var e,i,o,r;for(o=t.childNodes,r=[],e=0,i=o.length;e<i;e++)n=o[e],r.push(n);return r}(),r=[],h=0,d=o.length;h<d;h++)if(i=o[h],1===i.nodeType&&(u=i.tagName.toLowerCase(),!l._getChild(u)))switch(u){case"tbody":case"tfoot":case"thead":a=e.TableSection.fromDOMElement(i),l.attach(a);break;case"tr":r.push(e.TableRow.fromDOMElement(i))}if(r.length>0)for(l._getChild("tbody")||l.attach(new e.TableSection("tbody")),c=0,p=r.length;c<p;c++)s=r[c],l.tbody().attach(s);return 0===l.children.length?null:l},Table}(e.ElementCollection),e.TagNames.get().register(e.Table,"table"),e.TableSection=function(t){function TableSection(t,e){TableSection.__super__.constructor.call(this,t,e)}return l(TableSection,t),TableSection.prototype.cssTypeName=function(){return"table-section"},TableSection.prototype.type=function(){return"TableSection"},TableSection.prototype._onMouseOver=function(t){return TableSection.__super__._onMouseOver.call(this,t),this._removeCSSClass("ce-element--over")},TableSection.fromDOMElement=function(t){var n,i,o,r,s,a;for(r=new this(t.tagName,this.getDOMElementAttributes(t)),o=function(){var e,i,o,r;for(o=t.childNodes,r=[],e=0,i=o.length;e<i;e++)n=o[e],r.push(n);return r}(),s=0,a=o.length;s<a;s++)i=o[s],1===i.nodeType&&"tr"===i.tagName.toLowerCase()&&r.attach(e.TableRow.fromDOMElement(i));return r},TableSection}(e.ElementCollection),e.TableRow=function(t){function TableRow(t){TableRow.__super__.constructor.call(this,"tr",t)}return l(TableRow,t),TableRow.prototype.cssTypeName=function(){return"table-row"},TableRow.prototype.isEmpty=function(){var t,e,n,i,o;for(o=this.children,n=0,i=o.length;n<i;n++)if(t=o[n],(e=t.tableCellText())&&e.content.length()>0)return!1;return!0},TableRow.prototype.type=function(){return"TableRow"},TableRow.prototype.typeName=function(){return"Table row"},TableRow.prototype._onMouseOver=function(t){return TableRow.__super__._onMouseOver.call(this,t),this._removeCSSClass("ce-element--over")},TableRow.droppers={TableRow:e.Element._dropVert},TableRow.fromDOMElement=function(t){var n,i,o,r,s,a,l;for(r=new this(this.getDOMElementAttributes(t)),o=function(){var e,i,o,r;for(o=t.childNodes,r=[],e=0,i=o.length;e<i;e++)n=o[e],r.push(n);return r}(),a=0,l=o.length;a<l;a++)i=o[a],1===i.nodeType&&("td"!==(s=i.tagName.toLowerCase())&&"th"!==s||r.attach(e.TableCell.fromDOMElement(i)));return r},TableRow}(e.ElementCollection),e.TableCell=function(t){function TableCell(t,e){TableCell.__super__.constructor.call(this,t,e)}return l(TableCell,t),TableCell.prototype.cssTypeName=function(){return"table-cell"},TableCell.prototype.tableCellText=function(){return this.children.length>0?this.children[0]:null},TableCell.prototype.type=function(){return"TableCell"},TableCell.prototype.html=function(t){var n;return null==t&&(t=""),n=[t+"<"+this.tagName()+this._attributesToString()+">"],this.tableCellText()&&n.push(this.tableCellText().html(t+e.INDENT)),n.push(t+"</"+this.tagName()+">"),n.join(e.LINE_ENDINGS)},TableCell.prototype._onMouseOver=function(t){return TableCell.__super__._onMouseOver.call(this,t),this._removeCSSClass("ce-element--over")},TableCell.prototype._addDOMEventListeners=function(){},TableCell.prototype._removeDOMEventListners=function(){},TableCell.fromDOMElement=function(t){var n,i;return n=new this(t.tagName,this.getDOMElementAttributes(t)),i=new e.TableCellText(t.innerHTML.replace(/^\s+|\s+$/g,"")),n.attach(i),n},TableCell}(e.ElementCollection),e.TableCellText=function(t){function TableCellText(t){TableCellText.__super__.constructor.call(this,"div",{},t)}return l(TableCellText,t),TableCellText.prototype.cssTypeName=function(){return"table-cell-text"},TableCellText.prototype.type=function(){return"TableCellText"},TableCellText.prototype._isInFirstRow=function(){var t,e,n,i;return t=this.parent(),e=t.parent(),n=e.parent(),i=n.parent(),n===i.firstSection()&&e===n.children[0]},TableCellText.prototype._isInLastRow=function(){var t,e,n,i;return t=this.parent(),e=t.parent(),n=e.parent(),i=n.parent(),n===i.lastSection()&&e===n.children[n.children.length-1]},TableCellText.prototype._isLastInSection=function(){var t,e,n;return t=this.parent(),e=t.parent(),n=e.parent(),e===n.children[n.children.length-1]&&t===e.children[e.children.length-1]},TableCellText.prototype.blur=function(){return this.isMounted()&&(this._domElement.blur(),this._domElement.removeAttribute("contenteditable")),e.Element.prototype.blur.call(this)},TableCellText.prototype.can=function(t,e){if(e)throw new Error("Cannot set behaviour for ListItemText");return this.parent().can(t)},TableCellText.prototype.html=function(t){var n;return null==t&&(t=""),(!this._lastCached||this._lastCached<this._modified)&&(n=e.TRIM_WHITESPACE?this.content.copy().trim():this.content.copy(),n.optimize(),this._lastCached=Date.now(),this._cached=n.html()),""+t+this._cached},TableCellText.prototype._onMouseDown=function(t){var n;return e.Element.prototype._onMouseDown.call(this,t),n=function(i){return function(){var o,r;return o=i.parent(),e.Root.get().dragging()===o.parent()?(e.Root.get().cancelDragging(),r=o.parent().parent().parent(),r.drag(t.pageX,t.pageY)):(o.parent().drag(t.pageX,t.pageY),i._dragTimeout=setTimeout(n,2*e.DRAG_HOLD_DURATION))}}(this),clearTimeout(this._dragTimeout),this._dragTimeout=setTimeout(n,e.DRAG_HOLD_DURATION)},TableCellText.prototype._keyBack=function(t){var e,n,i,o;if(o=ContentSelect.Range.query(this._domElement),0===o.get()[0]&&o.isCollapsed()&&(t.preventDefault(),e=this.parent(),i=e.parent(),i.isEmpty()&&i.can("remove")))return 0===this.content.length()&&0===i.children.indexOf(e)?(n=this.previousContent(),n&&(n.focus(),o=new ContentSelect.Range(n.content.length(),n.content.length()),o.select(n.domElement())),i.parent().detach(i)):void 0},TableCellText.prototype._keyDelete=function(t){var e,n,i,o;if(i=this.parent().parent(),i.isEmpty()&&i.can("remove"))return t.preventDefault(),e=i.children[i.children.length-1],n=e.tableCellText().nextContent(),n&&(n.focus(),o=new ContentSelect.Range(0,0),o.select(n.domElement())),i.parent().detach(i)},TableCellText.prototype._keyDown=function(t){var n,i,o,r,s,a,l;if(l=ContentSelect.Range.query(this._domElement),this._atEnd(l)&&l.isCollapsed())return t.preventDefault(),n=this.parent(),this._isInLastRow()?(a=n.parent(),o=a.children[a.children.length-1].tableCellText(),r=o.nextContent(),r?r.focus():e.Root.get().trigger("next-region",this.closest(function(t){return"Fixture"===t.type()||"Region"===t.type()}))):(s=n.parent().nextWithTest(function(t){return"TableRow"===t.type()}),i=n.parent().children.indexOf(n),i=Math.min(i,s.children.length),s.children[i].tableCellText().focus())},TableCellText.prototype._keyReturn=function(t){return t.preventDefault(),this._keyTab({shiftKey:!1,preventDefault:function(){}})},TableCellText.prototype._keyTab=function(t){var n,i,o,r,s,a,l,u,h,c;if(t.preventDefault(),n=this.parent(),t.shiftKey){if(this._isInFirstRow()&&n.parent().children[0]===n)return;return this.previousContent().focus()}if(this.can("spawn")){if(o=n.parent().parent(),"tbody"===o.tagName()&&this._isLastInSection()){for(a=new e.TableRow,c=n.parent().children,u=0,h=c.length;u<h;u++)i=c[u],r=new e.TableCell(i.tagName(),i._attributes),s=new e.TableCellText(""),r.attach(s),a.attach(r);return l=this.closest(function(t){return"TableSection"===t.type()}),l.attach(a),a.children[0].tableCellText().focus()}return this.nextContent().focus()}},TableCellText.prototype._keyUp=function(t){var n,i,o,r,s,a;if(a=ContentSelect.Range.query(this._domElement),0===a.get()[0]&&a.isCollapsed())return t.preventDefault(),n=this.parent(),this._isInFirstRow()?(s=n.parent(),o=s.children[0].previousContent(),o?o.focus():e.Root.get().trigger("previous-region",this.closest(function(t){return"Fixture"===t.type()||"Region"===t.type()}))):(r=n.parent().previousWithTest(function(t){return"TableRow"===t.type()}),i=n.parent().children.indexOf(n),i=Math.min(i,r.children.length),r.children[i].tableCellText().focus())},TableCellText.droppers={},TableCellText.mergers={},TableCellText}(e.Text)}.call(this),function(){var e,n,i,o,r,s={}.hasOwnProperty,a=function(t,e){function ctor(){this.constructor=t}for(var n in e)s.call(e,n)&&(t[n]=e[n]);return ctor.prototype=e.prototype,t.prototype=new ctor,t.__super__=e.prototype,t},l=function(t,e){return function(){return t.apply(e,arguments)}},u=[].slice;n={Tools:{},CANCEL_MESSAGE:"Your changes have not been saved, do you really want to lose them?".trim(),DEFAULT_TOOLS:[["bold","italic","link","align-left","align-center","align-right"],["heading","subheading","paragraph","unordered-list","ordered-list","table","indent","unindent","line-break"],["image","video","preformatted"],["undo","redo","remove"]],DEFAULT_VIDEO_HEIGHT:300,DEFAULT_VIDEO_WIDTH:400,HIGHLIGHT_HOLD_DURATION:2e3,INSPECTOR_IGNORED_ELEMENTS:["Fixture","ListItemText","Region","TableCellText"],IMAGE_UPLOADER:null,MIN_CROP:10,RESTRICTED_ATTRIBUTES:{"*":["style"],img:["height","src","width","data-ce-max-width","data-ce-min-width"],iframe:["height","width"]},getEmbedVideoURL:function(t){var e,n,i,o,r,s,a,l,u,h,c,d,p,_,m;for(e={"www.youtube.com":"youtube","youtu.be":"youtube","vimeo.com":"vimeo","player.vimeo.com":"vimeo"},h=document.createElement("a"),h.href=t,s=h.hostname.toLowerCase(),c=h.pathname,null!==c&&"/"!==c.substr(0,1)&&(c="/"+c),l={},u=h.search.slice(1),m=u.split("&"),p=0,_=m.length;p<_;p++)o=m[p],o=o.split("="),o[0]&&(l[o[0]]=o[1]);switch(e[s]){case"youtube":if("/watch"===c.toLowerCase()){if(!l.v)return null;n=l.v,delete l.v}else{if(!(r=c.match(/\/([A-Za-z0-9_-]+)$/i)))return null;n=r[1]}return t="https://www.youtube.com/embed/"+n,a=function(){var t;t=[];for(i in l)d=l[i],t.push(i+"="+d);return t}().join("&"),a&&(t+="?"+a),t;case"vimeo":return(r=c.match(/\/(\w+\/\w+\/){0,1}(\d+)/i))?(t="https://player.vimeo.com/video/"+r[2],a=function(){var t;t=[];for(i in l)d=l[i],t.push(i+"="+d);return t}().join("&"),a&&(t+="?"+a),t):null}return null},getRestrictedAtributes:function(t){var e;return e=[],n.RESTRICTED_ATTRIBUTES[t]&&(e=e.concat(n.RESTRICTED_ATTRIBUTES[t])),n.RESTRICTED_ATTRIBUTES["*"]&&(e=e.concat(n.RESTRICTED_ATTRIBUTES["*"])),e},getScrollPosition:function(){var t,e;return e=void 0!==window.pageXOffset,t=4===(document.compatMode||4),e?[window.pageXOffset,window.pageYOffset]:t?[document.documentElement.scrollLeft,document.documentElement.scrollTop]:[document.body.scrollLeft,document.body.scrollTop]}},"undefined"!=typeof window&&(window.ContentTools=n),void 0!==t&&t.exports&&(t.exports=n),n.ComponentUI=function(){function ComponentUI(){this._bindings={},this._parent=null,this._children=[],this._domElement=null}return ComponentUI.prototype.children=function(){return this._children.slice()},ComponentUI.prototype.domElement=function(){return this._domElement},ComponentUI.prototype.isMounted=function(){return null!==this._domElement},ComponentUI.prototype.parent=function(){return this._parent},ComponentUI.prototype.attach=function(t,e){return t.parent()&&t.parent().detach(t),t._parent=this,void 0!==e?this._children.splice(e,0,t):this._children.push(t)},ComponentUI.prototype.addCSSClass=function(t){if(this.isMounted())return ContentEdit.addCSSClass(this._domElement,t)},ComponentUI.prototype.detach=function(t){var e;if(-1!==(e=this._children.indexOf(t)))return this._children.splice(e,1)},ComponentUI.prototype.mount=function(){},ComponentUI.prototype.removeCSSClass=function(t){if(this.isMounted())return ContentEdit.removeCSSClass(this._domElement,t)},ComponentUI.prototype.unmount=function(){if(this.isMounted())return this._removeDOMEventListeners(),this._domElement.parentNode&&this._domElement.parentNode.removeChild(this._domElement),this._domElement=null},ComponentUI.prototype.addEventListener=function(t,e){void 0===this._bindings[t]&&(this._bindings[t]=[]),this._bindings[t].push(e)},ComponentUI.prototype.createEvent=function(t,e){return new n.Event(t,e)},ComponentUI.prototype.dispatchEvent=function(t){var e,n,i,o;if(!this._bindings[t.name()])return!t.defaultPrevented();for(o=this._bindings[t.name()],n=0,i=o.length;n<i&&(e=o[n],!t.propagationStopped());n++)e&&e.call(this,t);return!t.defaultPrevented()},ComponentUI.prototype.removeEventListener=function(t,e){var n,i,o,r,s,a;if(!t)return void(this._bindings={});if(!e)return void(this._bindings[t]=void 0);if(this._bindings[t]){for(s=this._bindings[t],a=[],n=o=0,r=s.length;o<r;n=++o)i=s[n],i===e?a.push(this._bindings[t].splice(n,1)):a.push(void 0);return a}},ComponentUI.prototype._addDOMEventListeners=function(){},ComponentUI.prototype._removeDOMEventListeners=function(){},ComponentUI.createDiv=function(t,e,n){var i,o,r;if(i=document.createElement("div"),t&&t.length>0&&i.setAttribute("class",t.join(" ")),e)for(o in e)r=e[o],i.setAttribute(o,r);return n&&(i.innerHTML=n),i},ComponentUI}(),n.WidgetUI=function(t){function WidgetUI(){return WidgetUI.__super__.constructor.apply(this,arguments)}return a(WidgetUI,t),WidgetUI.prototype.attach=function(t,e){if(WidgetUI.__super__.attach.call(this,t,e),!this.isMounted())return t.mount()},WidgetUI.prototype.detach=function(t){if(WidgetUI.__super__.detach.call(this,t),this.isMounted())return t.unmount()},WidgetUI.prototype.detatch=function(t){return this.detach(t)},WidgetUI.prototype.show=function(){var t;return this._hideTimeout&&(clearTimeout(this._hideTimeout),this._hideTimeout=null,this.unmount()),this.isMounted()||this.mount(),t=function(t){return function(){return t.addCSSClass("ct-widget--active"),t._showTimeout=null}}(this),this._showTimeout=setTimeout(t,100)},WidgetUI.prototype.hide=function(){var t;if(this._showTimeout&&(clearTimeout(this._showTimeout),this._showTimeout=null),this.removeCSSClass("ct-widget--active"),t=function(e){return function(){return e._hideTimeout=null,window.getComputedStyle?parseFloat(window.getComputedStyle(e._domElement).opacity)<.01?e.unmount():e._hideTimeout=setTimeout(t,250):void e.unmount()}}(this),this.isMounted())return this._hideTimeout=setTimeout(t,250)},WidgetUI}(n.ComponentUI),n.AnchoredComponentUI=function(t){function AnchoredComponentUI(){return AnchoredComponentUI.__super__.constructor.apply(this,arguments)}return a(AnchoredComponentUI,t),AnchoredComponentUI.prototype.mount=function(t,e){return null==e&&(e=null),t.insertBefore(this._domElement,e),this._addDOMEventListeners()},AnchoredComponentUI}(n.ComponentUI),n.Event=function(){function Event(t,e){this._name=t,this._detail=e,this._timeStamp=Date.now(),this._defaultPrevented=!1,this._propagationStopped=!1}return Event.prototype.defaultPrevented=function(){return this._defaultPrevented},Event.prototype.detail=function(){return this._detail},Event.prototype.name=function(){return this._name},Event.prototype.propagationStopped=function(){return this._propagationStopped},Event.prototype.timeStamp=function(){return this._timeStamp},Event.prototype.preventDefault=function(){return this._defaultPrevented=!0},Event.prototype.stopImmediatePropagation=function(){return this._propagationStopped=!0},Event}(),n.FlashUI=function(t){function FlashUI(t){FlashUI.__super__.constructor.call(this),this.mount(t)}return a(FlashUI,t),FlashUI.prototype.mount=function(t){var e;return this._domElement=this.constructor.createDiv(["ct-flash","ct-flash--active","ct-flash--"+t,"ct-widget","ct-widget--active"]),FlashUI.__super__.mount.call(this,n.EditorApp.get().domElement()),e=function(t){return function(){return window.getComputedStyle?parseFloat(window.getComputedStyle(t._domElement).opacity)<.01?t.unmount():setTimeout(e,250):void t.unmount()}}(this),setTimeout(e,250)},FlashUI}(n.AnchoredComponentUI),n.IgnitionUI=function(t){function IgnitionUI(){IgnitionUI.__super__.constructor.call(this),this._revertToState="ready",this._state="ready"}return a(IgnitionUI,t),IgnitionUI.prototype.busy=function(t){if(this.dispatchEvent(this.createEvent("busy",{busy:t}))){if(t===("busy"===this._state))return;return t?(this._revertToState=this._state,this.state("busy")):this.state(this._revertToState)}},IgnitionUI.prototype.cancel=function(){if(this.dispatchEvent(this.createEvent("cancel")))return this.state("ready")},IgnitionUI.prototype.confirm=function(){if(this.dispatchEvent(this.createEvent("confirm")))return this.state("ready")},IgnitionUI.prototype.edit=function(){if(this.dispatchEvent(this.createEvent("edit")))return this.state("editing")},IgnitionUI.prototype.mount=function(){return IgnitionUI.__super__.mount.call(this),this._domElement=this.constructor.createDiv(["ct-widget","ct-ignition","ct-ignition--ready"]),this.parent().domElement().appendChild(this._domElement),this._domEdit=this.constructor.createDiv(["ct-ignition__button","ct-ignition__button--edit"]),this._domElement.appendChild(this._domEdit),this._domConfirm=this.constructor.createDiv(["ct-ignition__button","ct-ignition__button--confirm"]),this._domElement.appendChild(this._domConfirm),this._domCancel=this.constructor.createDiv(["ct-ignition__button","ct-ignition__button--cancel"]),this._domElement.appendChild(this._domCancel),this._domBusy=this.constructor.createDiv(["ct-ignition__button","ct-ignition__button--busy"]),this._domElement.appendChild(this._domBusy),this._addDOMEventListeners()},IgnitionUI.prototype.state=function(t){if(void 0===t)return this._state;if(this._state!==t&&this.dispatchEvent(this.createEvent("statechange",{state:t})))return this._state=t,this.removeCSSClass("ct-ignition--busy"),this.removeCSSClass("ct-ignition--editing"),this.removeCSSClass("ct-ignition--ready"),"busy"===this._state?this.addCSSClass("ct-ignition--busy"):"editing"===this._state?this.addCSSClass("ct-ignition--editing"):"ready"===this._state?this.addCSSClass("ct-ignition--ready"):void 0},IgnitionUI.prototype.unmount=function(){return IgnitionUI.__super__.unmount.call(this),this._domEdit=null,this._domConfirm=null,this._domCancel=null},IgnitionUI.prototype._addDOMEventListeners=function(){return this._domEdit.addEventListener("click",function(t){return function(e){return e.preventDefault(),t.edit()}}(this)),this._domConfirm.addEventListener("click",function(t){return function(e){return e.preventDefault(),t.confirm()}}(this)),this._domCancel.addEventListener("click",function(t){return function(e){return e.preventDefault(),t.cancel()}}(this))},IgnitionUI}(n.WidgetUI),n.InspectorUI=function(t){function InspectorUI(){InspectorUI.__super__.constructor.call(this),this._tagUIs=[]}return a(InspectorUI,t),InspectorUI.prototype.mount=function(){return this._domElement=this.constructor.createDiv(["ct-widget","ct-inspector"]),this.parent().domElement().appendChild(this._domElement),this._domTags=this.constructor.createDiv(["ct-inspector__tags","ct-tags"]),this._domElement.appendChild(this._domTags),this._domCounter=this.constructor.createDiv(["ct-inspector__counter"]),this._domElement.appendChild(this._domCounter),this.updateCounter(),this._addDOMEventListeners(),this._handleFocusChange=function(t){return function(){return t.updateTags()}}(this),ContentEdit.Root.get().bind("blur",this._handleFocusChange),ContentEdit.Root.get().bind("focus",this._handleFocusChange),ContentEdit.Root.get().bind("mount",this._handleFocusChange)},InspectorUI.prototype.unmount=function(){return InspectorUI.__super__.unmount.call(this),this._domTags=null,ContentEdit.Root.get().unbind("blur",this._handleFocusChange),ContentEdit.Root.get().unbind("focus",this._handleFocusChange),ContentEdit.Root.get().unbind("mount",this._handleFocusChange)},InspectorUI.prototype.updateCounter=function(){var t,e,i,o,r,s,a,l,u,h,c;if(this.isMounted()){for(e="",c=n.EditorApp.get().orderedRegions(),u=0,h=c.length;u<h;u++)(s=c[u])&&(e+=s.domElement().textContent);return e=e.trim(),(e=e.replace(/<\/?[a-z][^>]*>/gi,""),e=e.replace(/[\u200B]+/,""),e=e.replace(/['";:,.?¿\-!¡]+/g,""),l=(e.match(/\S+/g)||[]).length,l=l.toString().replace(/\B(?=(\d{3})+(?!\d))/g,","),(i=ContentEdit.Root.get().focused())&&"PreText"===i.type()&&i.selection().isCollapsed())?(o=0,t=1,a=i.content.substring(0,i.selection().get()[0]),r=a.text().split("\n"),o=r.length,t=r[r.length-1].length+1,o=o.toString().replace(/\B(?=(\d{3})+(?!\d))/g,","),t=t.toString().replace(/\B(?=(\d{3})+(?!\d))/g,","),this._domCounter.textContent=l+" / "+o+":"+t):void(this._domCounter.textContent=l)}},InspectorUI.prototype.updateTags=function(){var t,e,i,o,r,s,a,l,u;for(t=ContentEdit.Root.get().focused(),l=this._tagUIs,o=0,s=l.length;o<s;o++)i=l[o],i.unmount();if(this._tagUIs=[],t){for(e=t.parents(),e.reverse(),e.push(t),u=[],r=0,a=e.length;r<a;r++)t=e[r],-1===n.INSPECTOR_IGNORED_ELEMENTS.indexOf(t.type())&&(i=new n.TagUI(t),this._tagUIs.push(i),u.push(i.mount(this._domTags)));return u}},InspectorUI.prototype._addDOMEventListeners=function(){return this._updateCounterInterval=setInterval(function(t){return function(){return t.updateCounter()}}(this),250)},InspectorUI.prototype._removeDOMEventListeners=function(){return clearInterval(this._updateCounterInterval)},InspectorUI}(n.WidgetUI),n.TagUI=function(t){function TagUI(t){this.element=t,this._onMouseDown=l(this._onMouseDown,this),TagUI.__super__.constructor.call(this)}return a(TagUI,t),TagUI.prototype.mount=function(t,e){return null==e&&(e=null),this._domElement=this.constructor.createDiv(["ct-tag"]),this._domElement.textContent=this.element.tagName(),TagUI.__super__.mount.call(this,t,e)},TagUI.prototype._addDOMEventListeners=function(){return this._domElement.addEventListener("mousedown",this._onMouseDown)},TagUI.prototype._onMouseDown=function(t){var e,i,o;return t.preventDefault(),this.element.storeState&&this.element.storeState(),e=n.EditorApp.get(),o=new n.ModalUI,i=new n.PropertiesDialog(this.element),i.addEventListener("cancel",function(t){return function(){if(o.hide(),i.hide(),t.element.restoreState)return t.element.restoreState()}}(this)),i.addEventListener("save",function(t){return function(e){var n,r,s,a,l,u,h,c,d,p,_,m,g,f,v,y,E;u=e.detail(),r=u.changedAttributes,p=u.changedStyles,c=u.innerHTML;for(d in r)if(_=r[d],"class"===d){for(null===_&&(_=""),a={},y=_.split(" "),m=0,f=y.length;m<f;m++)s=y[m],(s=s.trim())&&(a[s]=!0,t.element.hasCSSClass(s)||t.element.addCSSClass(s));for(E=t.element.attr("class").split(" "),g=0,v=E.length;g<v;g++)s=E[g],s=s.trim(),void 0===a[s]&&t.element.removeCSSClass(s)}else null===_?t.element.removeAttr(d):t.element.attr(d,_);for(l in p)n=p[l],n?t.element.addCSSClass(l):t.element.removeCSSClass(l);if(null!==c&&c!==i.getElementInnerHTML()&&(h=t.element,h.content||(h=h.children[0]),h.content=new HTMLString.String(c,h.content.preserveWhitespace()),h.updateInnerHTML(),h.taint(),h.selection(new ContentSelect.Range(0,0)),h.storeState()),o.hide(),i.hide(),t.element.restoreState)return t.element.restoreState()}}(this)),e.attach(o),e.attach(i),o.show(),i.show()},TagUI}(n.AnchoredComponentUI),n.ModalUI=function(t){function ModalUI(t,e){ModalUI.__super__.constructor.call(this),this._transparent=t,this._allowScrolling=e}return a(ModalUI,t),ModalUI.prototype.mount=function(){return this._domElement=this.constructor.createDiv(["ct-widget","ct-modal"]),this.parent().domElement().appendChild(this._domElement),this._transparent&&this.addCSSClass("ct-modal--transparent"),this._allowScrolling||ContentEdit.addCSSClass(document.body,"ct--no-scroll"),this._addDOMEventListeners()},ModalUI.prototype.unmount=function(){return this._allowScrolling||ContentEdit.removeCSSClass(document.body,"ct--no-scroll"),ModalUI.__super__.unmount.call(this)},ModalUI.prototype._addDOMEventListeners=function(){return this._domElement.addEventListener("click",function(t){return function(e){return t.dispatchEvent(t.createEvent("click"))}}(this))},ModalUI}(n.WidgetUI),n.ToolboxUI=function(t){function ToolboxUI(t){this._onStopDragging=l(this._onStopDragging,this),this._onStartDragging=l(this._onStartDragging,this),this._onDrag=l(this._onDrag,this),ToolboxUI.__super__.constructor.call(this),this._tools=t,this._dragging=!1,this._draggingOffset=null,this._domGrip=null,this._toolUIs={}}return a(ToolboxUI,t),ToolboxUI.prototype.isDragging=function(){return this._dragging},ToolboxUI.prototype.hide=function(){return this._removeDOMEventListeners(),ToolboxUI.__super__.hide.call(this)},ToolboxUI.prototype.mount=function(){var t,e,n;return this._domElement=this.constructor.createDiv(["ct-widget","ct-toolbox"]),this.parent().domElement().appendChild(this._domElement),this._domGrip=this.constructor.createDiv(["ct-toolbox__grip","ct-grip"]),this._domElement.appendChild(this._domGrip),this._domGrip.appendChild(this.constructor.createDiv(["ct-grip__bump"])),this._domGrip.appendChild(this.constructor.createDiv(["ct-grip__bump"])),this._domGrip.appendChild(this.constructor.createDiv(["ct-grip__bump"])),this._domToolGroups=this.constructor.createDiv(["ct-tool-groups"]),this._domElement.appendChild(this._domToolGroups),this.tools(this._tools),n=window.localStorage.getItem("ct-toolbox-position"),n&&/^\d+,\d+$/.test(n)&&(e=function(){var e,i,o,r;for(o=n.split(","),r=[],e=0,i=o.length;e<i;e++)t=o[e],r.push(parseInt(t));return r}(),this._domElement.style.left=e[0]+"px",this._domElement.style.top=e[1]+"px",this._contain()),this._addDOMEventListeners()},ToolboxUI.prototype.tools=function(t){var e,i,o,r,s,a,l,u,h,c,d;if(void 0===t)return this._tools;if(this._tools=t,this.isMounted()){h=this._toolUIs;for(s in h)a=h[s],a.unmount();for(this._toolUIs={};this._domToolGroups.lastChild;)this._domToolGroups.removeChild(this._domToolGroups.lastChild);for(c=this._tools,d=[],i=l=0,u=c.length;l<u;i=++l)r=c[i],e=this.constructor.createDiv(["ct-tool-group"]),this._domToolGroups.appendChild(e),d.push(function(){var t,i,a;for(a=[],t=0,i=r.length;t<i;t++)s=r[t],o=n.ToolShelf.fetch(s),this._toolUIs[s]=new n.ToolUI(o),this._toolUIs[s].mount(e),this._toolUIs[s].disabled(!0),a.push(this._toolUIs[s].addEventListener("applied",function(t){return function(){return t.updateTools()}}(this)));return a}.call(this));return d}},ToolboxUI.prototype.updateTools=function(){var t,e,n,i,o,r;t=ContentEdit.Root.get().focused(),n=null,t&&t.selection&&(n=t.selection()),o=this._toolUIs,r=[];for(e in o)i=o[e],r.push(i.update(t,n));return r},ToolboxUI.prototype.unmount=function(){return ToolboxUI.__super__.unmount.call(this),this._domGrip=null},ToolboxUI.prototype._addDOMEventListeners=function(){return this._domGrip.addEventListener("mousedown",this._onStartDragging),this._handleResize=function(t){return function(e){var n;return t._resizeTimeout&&clearTimeout(t._resizeTimeout),n=function(){return t._contain()},t._resizeTimeout=setTimeout(n,250)}}(this),window.addEventListener("resize",this._handleResize),this._updateTools=function(t){return function(){var e,i,o,r,s,a,l,u;if(e=n.EditorApp.get(),a=!1,i=ContentEdit.Root.get().focused(),r=null,i===t._lastUpdateElement?i&&i.selection&&(r=i.selection(),t._lastUpdateSelection?r.eq(t._lastUpdateSelection)||(a=!0):a=!0):a=!0,e.history&&(t._lastUpdateHistoryLength!==e.history.length()&&(a=!0),t._lastUpdateHistoryLength=e.history.length(),t._lastUpdateHistoryIndex!==e.history.index()&&(a=!0),t._lastUpdateHistoryIndex=e.history.index()),t._lastUpdateElement=i,t._lastUpdateSelection=r,a){l=t._toolUIs,u=[];for(o in l)s=l[o],u.push(s.update(i,r));return u}}}(this),this._updateToolsInterval=setInterval(this._updateTools,100),this._handleKeyDown=function(t){return function(t){var e,i,o,r,s,a;if((i=ContentEdit.Root.get().focused())&&!i.content){if(46===t.keyCode)return t.preventDefault(),n.Tools.Remove.apply(i,null,function(){});if(13===t.keyCode)return t.preventDefault(),e=n.Tools.Paragraph,e.apply(i,null,function(){})}switch(a=navigator.appVersion,o="linux",-1!==a.indexOf("Mac")?o="mac":-1!==a.indexOf("Win")&&(o="windows"),r=!1,s=!1,o){case!t.altKey:90===t.keyCode&&t.ctrlKey&&(r=t.shiftKey,s=!r);break;case!(t.altKey||t.ctrlKey):90===t.keyCode&&t.metaKey&&(r=t.shiftKey,s=!r);break;case!t.altKey||t.shiftKey:89===t.keyCode&&t.ctrlKey&&(r=!0),90===t.keyCode&&t.ctrlKey&&(s=!0)}if(s&&n.Tools.Undo.canApply(null,null)&&n.Tools.Undo.apply(null,null,function(){}),r&&n.Tools.Redo.canApply(null,null))return n.Tools.Redo.apply(null,null,function(){})}}(),window.addEventListener("keydown",this._handleKeyDown)},ToolboxUI.prototype._contain=function(){var t;if(this.isMounted())return t=this._domElement.getBoundingClientRect(),t.left+t.width>window.innerWidth&&(this._domElement.style.left=window.innerWidth-t.width+"px"),t.top+t.height>window.innerHeight&&(this._domElement.style.top=window.innerHeight-t.height+"px"),t.left<0&&(this._domElement.style.left="0px"),t.top<0&&(this._domElement.style.top="0px"),t=this._domElement.getBoundingClientRect(),window.localStorage.setItem("ct-toolbox-position",t.left+","+t.top)},ToolboxUI.prototype._removeDOMEventListeners=function(){return this.isMounted()&&this._domGrip.removeEventListener("mousedown",this._onStartDragging),window.removeEventListener("keydown",this._handleKeyDown),window.removeEventListener("resize",this._handleResize),clearInterval(this._updateToolsInterval)},ToolboxUI.prototype._onDrag=function(t){return ContentSelect.Range.unselectAll(),this._domElement.style.left=t.clientX-this._draggingOffset.x+"px",this._domElement.style.top=t.clientY-this._draggingOffset.y+"px"},ToolboxUI.prototype._onStartDragging=function(t){var e;if(t.preventDefault(),!this.isDragging())return this._dragging=!0,this.addCSSClass("ct-toolbox--dragging"),e=this._domElement.getBoundingClientRect(),this._draggingOffset={x:t.clientX-e.left,y:t.clientY-e.top},document.addEventListener("mousemove",this._onDrag),document.addEventListener("mouseup",this._onStopDragging),ContentEdit.addCSSClass(document.body,"ce--dragging")},ToolboxUI.prototype._onStopDragging=function(t){if(this.isDragging())return this._contain(),document.removeEventListener("mousemove",this._onDrag),document.removeEventListener("mouseup",this._onStopDragging),this._draggingOffset=null,this._dragging=!1,this.removeCSSClass("ct-toolbox--dragging"),ContentEdit.removeCSSClass(document.body,"ce--dragging")},ToolboxUI}(n.WidgetUI),n.ToolUI=function(t){function ToolUI(t){this._onMouseUp=l(this._onMouseUp,this),this._onMouseLeave=l(this._onMouseLeave,this),this._onMouseDown=l(this._onMouseDown,this),this._addDOMEventListeners=l(this._addDOMEventListeners,this),ToolUI.__super__.constructor.call(this),this.tool=t,this._mouseDown=!1,this._disabled=!1}return a(ToolUI,t),ToolUI.prototype.apply=function(t,e){var n,i;if(this.tool.canApply(t,e))return i={element:t,selection:e},n=function(t){return function(e){if(e)return t.dispatchEvent(t.createEvent("applied",i))}}(this),this.dispatchEvent(this.createEvent("apply",i))?this.tool.apply(t,e,n):void 0},ToolUI.prototype.disabled=function(t){if(void 0===t)return this._disabled;if(this._disabled!==t)return this._disabled=t,t?(this._mouseDown=!1,this.addCSSClass("ct-tool--disabled"),this.removeCSSClass("ct-tool--applied")):this.removeCSSClass("ct-tool--disabled")},ToolUI.prototype.mount=function(t,e){return null==e&&(e=null),this._domElement=this.constructor.createDiv(["ct-tool","ct-tool--"+this.tool.icon]),this._domElement.setAttribute("data-ct-tooltip",ContentEdit._(this.tool.label)),ToolUI.__super__.mount.call(this,t,e)},ToolUI.prototype.update=function(t,e){return(!this.tool.requiresElement||t&&t.isMounted())&&this.tool.canApply(t,e)?(this.disabled(!1),this.tool.isApplied(t,e)?this.addCSSClass("ct-tool--applied"):this.removeCSSClass("ct-tool--applied")):void this.disabled(!0)},ToolUI.prototype._addDOMEventListeners=function(){return this._domElement.addEventListener("mousedown",this._onMouseDown),this._domElement.addEventListener("mouseleave",this._onMouseLeave),this._domElement.addEventListener("mouseup",this._onMouseUp)},ToolUI.prototype._onMouseDown=function(t){if(t.preventDefault(),!this.disabled())return this._mouseDown=!0,this.addCSSClass("ct-tool--down")},ToolUI.prototype._onMouseLeave=function(t){return this._mouseDown=!1,this.removeCSSClass("ct-tool--down")},ToolUI.prototype._onMouseUp=function(t){var e,n;if(this._mouseDown){if(e=ContentEdit.Root.get().focused(),this.tool.requiresElement&&(!e||!e.isMounted()))return;n=null,e&&e.selection&&(n=e.selection()),this.apply(e,n)}return this._mouseDown=!1,this.removeCSSClass("ct-tool--down")},ToolUI}(n.AnchoredComponentUI),n.AnchoredDialogUI=function(t){function AnchoredDialogUI(){AnchoredDialogUI.__super__.constructor.call(this),this._position=[0,0]}return a(AnchoredDialogUI,t),AnchoredDialogUI.prototype.mount=function(){return this._domElement=this.constructor.createDiv(["ct-widget","ct-anchored-dialog"]),this.parent().domElement().appendChild(this._domElement),this._contain(),this._domElement.style.top=this._position[1]+"px",this._domElement.style.left=this._position[0]+"px"},AnchoredDialogUI.prototype.position=function(t){return void 0===t?this._position.slice():(this._position=t.slice(),this.isMounted()?(this._contain(),this._domElement.style.top=this._position[1]+"px",this._domElement.style.left=this._position[0]+"px"):void 0)},AnchoredDialogUI.prototype._contain=function(){var t,e,n;if(this.isMounted())return n=this._domElement.getBoundingClientRect(),t=n.width/2+5,e=document.documentElement.clientWidth||document.body.clientWidth,this._position[0]+t>e&&(this._position[0]=e-t),this._position[0]<t&&(this._position[0]=t),this._position[1]+n.top<5?this._position[1]=Math.abs(n.top)+5:void 0},AnchoredDialogUI}(n.WidgetUI),n.DialogUI=function(t){function DialogUI(t){null==t&&(t=""),DialogUI.__super__.constructor.call(this),this._busy=!1,this._caption=t}return a(DialogUI,t),DialogUI.prototype.busy=function(t){if(void 0===t)return this._busy;if(this._busy!==t&&(this._busy=t,this.isMounted()))return this._busy?ContentEdit.addCSSClass(this._domElement,"ct-dialog--busy"):ContentEdit.removeCSSClass(this._domElement,"ct-dialog--busy")},DialogUI.prototype.caption=function(t){return void 0===t?this._caption:(this._caption=t,this._domCaption.textContent=ContentEdit._(t))},DialogUI.prototype.mount=function(){var t,e,n;return document.activeElement&&(document.activeElement.blur(),window.getSelection().removeAllRanges()),t=["ct-widget","ct-dialog"],this._busy&&t.push("ct-dialog--busy"),this._domElement=this.constructor.createDiv(t),this.parent().domElement().appendChild(this._domElement),n=this.constructor.createDiv(["ct-dialog__header"]),this._domElement.appendChild(n),this._domCaption=this.constructor.createDiv(["ct-dialog__caption"]),n.appendChild(this._domCaption),this.caption(this._caption),this._domClose=this.constructor.createDiv(["ct-dialog__close"]),n.appendChild(this._domClose),e=this.constructor.createDiv(["ct-dialog__body"]),this._domElement.appendChild(e),this._domView=this.constructor.createDiv(["ct-dialog__view"]),e.appendChild(this._domView),this._domControls=this.constructor.createDiv(["ct-dialog__controls"]),e.appendChild(this._domControls),this._domBusy=this.constructor.createDiv(["ct-dialog__busy"]),this._domElement.appendChild(this._domBusy)},DialogUI.prototype.unmount=function(){return DialogUI.__super__.unmount.call(this),this._domBusy=null,this._domCaption=null,this._domClose=null,this._domControls=null,this._domView=null},DialogUI.prototype._addDOMEventListeners=function(){return this._handleEscape=function(t){return function(e){if(!t._busy)return 27===e.keyCode?t.dispatchEvent(t.createEvent("cancel")):void 0}}(this),document.addEventListener("keyup",this._handleEscape),this._domClose.addEventListener("click",function(t){return function(e){if(e.preventDefault(),!t._busy)return t.dispatchEvent(t.createEvent("cancel"))}}(this))},DialogUI.prototype._removeDOMEventListeners=function(){return document.removeEventListener("keyup",this._handleEscape)},DialogUI}(n.WidgetUI),n.ImageDialog=function(t){function ImageDialog(){ImageDialog.__super__.constructor.call(this,"Insert image"),this._cropMarks=null,this._imageURL=null,this._imageSize=null,this._progress=0,this._state="empty",n.IMAGE_UPLOADER&&n.IMAGE_UPLOADER(this)}return a(ImageDialog,t),ImageDialog.prototype.cropRegion=function(){return this._cropMarks?this._cropMarks.region():[0,0,1,1]},ImageDialog.prototype.addCropMarks=function(){if(!this._cropMarks)return this._cropMarks=new i(this._imageSize),this._cropMarks.mount(this._domView),ContentEdit.addCSSClass(this._domCrop,"ct-control--active")},ImageDialog.prototype.clear=function(){return this._domImage&&(this._domImage.parentNode.removeChild(this._domImage),this._domImage=null),this._imageURL=null,this._imageSize=null,this.state("empty")},ImageDialog.prototype.mount=function(){var t,e,n;return ImageDialog.__super__.mount.call(this),ContentEdit.addCSSClass(this._domElement,"ct-image-dialog"),ContentEdit.addCSSClass(this._domElement,"ct-image-dialog--empty"),ContentEdit.addCSSClass(this._domView,"ct-image-dialog__view"),n=this.constructor.createDiv(["ct-control-group","ct-control-group--left"]),this._domControls.appendChild(n),this._domRotateCCW=this.constructor.createDiv(["ct-control","ct-control--icon","ct-control--rotate-ccw"]),this._domRotateCCW.setAttribute("data-ct-tooltip",ContentEdit._("Rotate")+" -90°"),n.appendChild(this._domRotateCCW),this._domRotateCW=this.constructor.createDiv(["ct-control","ct-control--icon","ct-control--rotate-cw"]),this._domRotateCW.setAttribute("data-ct-tooltip",ContentEdit._("Rotate")+" 90°"),n.appendChild(this._domRotateCW),this._domCrop=this.constructor.createDiv(["ct-control","ct-control--icon","ct-control--crop"]),this._domCrop.setAttribute("data-ct-tooltip",ContentEdit._("Crop marks")),n.appendChild(this._domCrop),e=this.constructor.createDiv(["ct-progress-bar"]),n.appendChild(e),this._domProgress=this.constructor.createDiv(["ct-progress-bar__progress"]),e.appendChild(this._domProgress),t=this.constructor.createDiv(["ct-control-group","ct-control-group--right"]),this._domControls.appendChild(t),this._domUpload=this.constructor.createDiv(["ct-control","ct-control--text","ct-control--upload"]),this._domUpload.textContent=ContentEdit._("Upload"),t.appendChild(this._domUpload),this._domInput=document.createElement("input"),this._domInput.setAttribute("class","ct-image-dialog__file-upload"),this._domInput.setAttribute("name","file"),this._domInput.setAttribute("type","file"),this._domInput.setAttribute("accept","image/*"),this._domUpload.appendChild(this._domInput),this._domInsert=this.constructor.createDiv(["ct-control","ct-control--text","ct-control--insert"]),this._domInsert.textContent=ContentEdit._("Insert"),t.appendChild(this._domInsert),this._domCancelUpload=this.constructor.createDiv(["ct-control","ct-control--text","ct-control--cancel"]),this._domCancelUpload.textContent=ContentEdit._("Cancel"),t.appendChild(this._domCancelUpload),this._domClear=this.constructor.createDiv(["ct-control","ct-control--text","ct-control--clear"]),this._domClear.textContent=ContentEdit._("Clear"),t.appendChild(this._domClear),this._addDOMEventListeners(),this.dispatchEvent(this.createEvent("imageuploader.mount"))},ImageDialog.prototype.populate=function(t,e){return this._imageURL=t,this._imageSize=e,this._domImage||(this._domImage=this.constructor.createDiv(["ct-image-dialog__image"]),this._domView.appendChild(this._domImage)),this._domImage.style["background-image"]="url("+t+")",this.state("populated")},ImageDialog.prototype.progress=function(t){return void 0===t?this._progress:(this._progress=t,this.isMounted()?this._domProgress.style.width=this._progress+"%":void 0)},ImageDialog.prototype.removeCropMarks=function(){if(this._cropMarks)return this._cropMarks.unmount(),this._cropMarks=null,ContentEdit.removeCSSClass(this._domCrop,"ct-control--active")},ImageDialog.prototype.save=function(t,e,n){return this.dispatchEvent(this.createEvent("save",{imageURL:t,imageSize:e,imageAttrs:n}))},ImageDialog.prototype.state=function(t){var e;if(void 0===t)return this._state;if(this._state!==t&&(e=this._state,this._state=t,this.isMounted()))return ContentEdit.addCSSClass(this._domElement,"ct-image-dialog--"+this._state),ContentEdit.removeCSSClass(this._domElement,"ct-image-dialog--"+e)},ImageDialog.prototype.unmount=function(){return ImageDialog.__super__.unmount.call(this),this._domCancelUpload=null,this._domClear=null,this._domCrop=null,this._domInput=null,this._domInsert=null,this._domProgress=null,this._domRotateCCW=null,this._domRotateCW=null,this._domUpload=null,this.dispatchEvent(this.createEvent("imageuploader.unmount"))},ImageDialog.prototype._addDOMEventListeners=function(){return ImageDialog.__super__._addDOMEventListeners.call(this),this._domInput.addEventListener("change",function(t){return function(e){var n;if(n=e.target.files[0])return e.target.value="",e.target.value&&(e.target.type="text",e.target.type="file"),t.dispatchEvent(t.createEvent("imageuploader.fileready",{file:n}))}}(this)),this._domCancelUpload.addEventListener("click",function(t){return function(e){return t.dispatchEvent(t.createEvent("imageuploader.cancelupload"))}}(this)),this._domClear.addEventListener("click",function(t){return function(e){return t.removeCropMarks(),t.dispatchEvent(t.createEvent("imageuploader.clear"))}}(this)),this._domRotateCCW.addEventListener("click",function(t){return function(e){return t.removeCropMarks(),t.dispatchEvent(t.createEvent("imageuploader.rotateccw"))}}(this)),this._domRotateCW.addEventListener("click",function(t){return function(e){return t.removeCropMarks(),t.dispatchEvent(t.createEvent("imageuploader.rotatecw"))}}(this)),this._domCrop.addEventListener("click",function(t){return function(e){return t._cropMarks?t.removeCropMarks():t.addCropMarks()}}(this)),this._domInsert.addEventListener("click",function(t){return function(e){return t.dispatchEvent(t.createEvent("imageuploader.save"))}}(this))},ImageDialog}(n.DialogUI),i=function(t){function CropMarksUI(t){CropMarksUI.__super__.constructor.call(this),this._bounds=null,this._dragging=null,this._draggingOrigin=null,this._imageSize=t}return a(CropMarksUI,t),CropMarksUI.prototype.mount=function(t,e){return null==e&&(e=null),this._domElement=this.constructor.createDiv(["ct-crop-marks"]),this._domClipper=this.constructor.createDiv(["ct-crop-marks__clipper"]),this._domElement.appendChild(this._domClipper),this._domRulers=[this.constructor.createDiv(["ct-crop-marks__ruler","ct-crop-marks__ruler--top-left"]),this.constructor.createDiv(["ct-crop-marks__ruler","ct-crop-marks__ruler--bottom-right"])],this._domClipper.appendChild(this._domRulers[0]),this._domClipper.appendChild(this._domRulers[1]),this._domHandles=[this.constructor.createDiv(["ct-crop-marks__handle","ct-crop-marks__handle--top-left"]),this.constructor.createDiv(["ct-crop-marks__handle","ct-crop-marks__handle--bottom-right"])],this._domElement.appendChild(this._domHandles[0]),this._domElement.appendChild(this._domHandles[1]),CropMarksUI.__super__.mount.call(this,t,e),this._fit(t)},CropMarksUI.prototype.region=function(){return[parseFloat(this._domHandles[0].style.top)/this._bounds[1],parseFloat(this._domHandles[0].style.left)/this._bounds[0],parseFloat(this._domHandles[1].style.top)/this._bounds[1],parseFloat(this._domHandles[1].style.left)/this._bounds[0]]},CropMarksUI.prototype.unmount=function(){return CropMarksUI.__super__.unmount.call(this),this._domClipper=null,this._domHandles=null,this._domRulers=null},CropMarksUI.prototype._addDOMEventListeners=function(){return CropMarksUI.__super__._addDOMEventListeners.call(this),this._domHandles[0].addEventListener("mousedown",function(t){return function(e){if(0===e.button)return t._startDrag(0,e.clientY,e.clientX)}}(this)),this._domHandles[1].addEventListener("mousedown",function(t){return function(e){if(0===e.button)return t._startDrag(1,e.clientY,e.clientX)}}(this))},CropMarksUI.prototype._drag=function(t,e){var i,o,r,s,a;if(null!==this._dragging)return ContentSelect.Range.unselectAll(),s=t-this._draggingOrigin[1],r=e-this._draggingOrigin[0],i=this._bounds[1],e=0,t=0,a=this._bounds[0],o=Math.min(Math.min(n.MIN_CROP,i),a),0===this._dragging?(i=parseInt(this._domHandles[1].style.top)-o,a=parseInt(this._domHandles[1].style.left)-o):(e=parseInt(this._domHandles[0].style.left)+o,t=parseInt(this._domHandles[0].style.top)+o),s=Math.min(Math.max(t,s),i),r=Math.min(Math.max(e,r),a),this._domHandles[this._dragging].style.top=s+"px",this._domHandles[this._dragging].style.left=r+"px",this._domRulers[this._dragging].style.top=s+"px",this._domRulers[this._dragging].style.left=r+"px"},CropMarksUI.prototype._fit=function(t){var e,n,i,o,r,s,a,l;return r=t.getBoundingClientRect(),l=r.width/this._imageSize[0],n=r.height/this._imageSize[1],o=Math.min(l,n),a=o*this._imageSize[0],e=o*this._imageSize[1],i=(r.width-a)/2,s=(r.height-e)/2,this._domElement.style.width=a+"px",this._domElement.style.height=e+"px",this._domElement.style.top=s+"px",this._domElement.style.left=i+"px",this._domHandles[0].style.top="0px",this._domHandles[0].style.left="0px",this._domHandles[1].style.top=e+"px",this._domHandles[1].style.left=a+"px",this._domRulers[0].style.top="0px",this._domRulers[0].style.left="0px",this._domRulers[1].style.top=e+"px",this._domRulers[1].style.left=a+"px",this._bounds=[a,e]},CropMarksUI.prototype._startDrag=function(t,e,n){var i;return i=this._domHandles[t],this._dragging=t,this._draggingOrigin=[n-parseInt(i.style.left),e-parseInt(i.style.top)],this._onMouseMove=function(t){return function(e){return t._drag(e.clientY,e.clientX)}}(this),document.addEventListener("mousemove",this._onMouseMove),this._onMouseUp=function(t){return function(e){return t._stopDrag()}}(this),document.addEventListener("mouseup",this._onMouseUp)},CropMarksUI.prototype._stopDrag=function(){return document.removeEventListener("mousemove",this._onMouseMove),document.removeEventListener("mouseup",this._onMouseUp),this._dragging=null,this._draggingOrigin=null},CropMarksUI}(n.AnchoredComponentUI),n.LinkDialog=function(t){function LinkDialog(t,e){null==t&&(t=""),null==e&&(e=""),LinkDialog.__super__.constructor.call(this),this._href=t,this._target=e}var e;return a(LinkDialog,t),e="_blank",LinkDialog.prototype.mount=function(){return LinkDialog.__super__.mount.call(this),this._domInput=document.createElement("input"),this._domInput.setAttribute("class","ct-anchored-dialog__input"),this._domInput.setAttribute("name","href"),this._domInput.setAttribute("placeholder",ContentEdit._("Enter a link")+"..."),this._domInput.setAttribute("type","text"),this._domInput.setAttribute("value",this._href),this._domElement.appendChild(this._domInput),this._domTargetButton=this.constructor.createDiv(["ct-anchored-dialog__target-button"]),this._domElement.appendChild(this._domTargetButton),this._target===e&&ContentEdit.addCSSClass(this._domTargetButton,"ct-anchored-dialog__target-button--active"),this._domButton=this.constructor.createDiv(["ct-anchored-dialog__button"]),this._domElement.appendChild(this._domButton),this._addDOMEventListeners()},LinkDialog.prototype.save=function(){var t;return this.isMounted()?(t={href:this._domInput.value.trim()},this._target&&(t.target=this._target),this.dispatchEvent(this.createEvent("save",t))):void this.dispatchEvent(this.createEvent("save"))},LinkDialog.prototype.show=function(){if(LinkDialog.__super__.show.call(this),this._domInput.focus(),this._href)return this._domInput.select()},LinkDialog.prototype.unmount=function(){return this.isMounted()&&this._domInput.blur(),LinkDialog.__super__.unmount.call(this),this._domButton=null,this._domInput=null},LinkDialog.prototype._addDOMEventListeners=function(){return this._domInput.addEventListener("keypress",function(t){return function(e){if(13===e.keyCode)return t.save()}}(this)),this._domTargetButton.addEventListener("click",function(t){return function(n){return n.preventDefault(),t._target===e?(t._target="",ContentEdit.removeCSSClass(t._domTargetButton,"ct-anchored-dialog__target-button--active")):(t._target=e,ContentEdit.addCSSClass(t._domTargetButton,"ct-anchored-dialog__target-button--active"))}}(this)),this._domButton.addEventListener("click",function(t){return function(e){return e.preventDefault(),t.save()}}(this))},LinkDialog}(n.AnchoredDialogUI),n.PropertiesDialog=function(t){function PropertiesDialog(t){var e;this.element=t,PropertiesDialog.__super__.constructor.call(this,"Properties"),this._attributeUIs=[],this._focusedAttributeUI=null,this._styleUIs=[],this._supportsCoding=this.element.content,"ListItem"!==(e=this.element.type())&&"TableCell"!==e||(this._supportsCoding=!0)}return a(PropertiesDialog,t),PropertiesDialog.prototype.caption=function(t){return void 0===t?this._caption:(this._caption=t,this._domCaption.textContent=ContentEdit._(t)+": "+this.element.tagName())},PropertiesDialog.prototype.changedAttributes=function(){var t,e,i,o,r,s,a,l,u,h;for(e={},i={},u=this._attributeUIs,a=0,l=u.length;a<l;a++)t=u[a],o=t.name(),s=t.value(),""!==o&&(e[o.toLowerCase()]=!0,this.element.attr(o)!==s&&(i[o]=s));r=n.getRestrictedAtributes(this.element.tagName()),h=this.element.attributes();for(o in h)s=h[o],r&&-1!==r.indexOf(o.toLowerCase())||void 0===e[o]&&(i[o]=null);return i},PropertiesDialog.prototype.changedStyles=function(){var t,e,n,i,o,r;for(n={},r=this._styleUIs,i=0,o=r.length;i<o;i++)e=r[i],t=e.style.cssClass(),this.element.hasCSSClass(t)!==e.applied()&&(n[t]=e.applied());return n},PropertiesDialog.prototype.getElementInnerHTML=function(){return this._supportsCoding?this.element.content?this.element.content.html():this.element.children[0].content.html():null},PropertiesDialog.prototype.mount=function(){var t,e,i,r,s,a,l,u,h,c,d,p,_,m,g;for(PropertiesDialog.__super__.mount.call(this),ContentEdit.addCSSClass(this._domElement,"ct-properties-dialog"),ContentEdit.addCSSClass(this._domView,"ct-properties-dialog__view"),this._domStyles=this.constructor.createDiv(["ct-properties-dialog__styles"]),this._domStyles.setAttribute("data-ct-empty",ContentEdit._("No styles available for this tag")),this._domView.appendChild(this._domStyles),g=n.StylePalette.styles(this.element),d=0,_=g.length;d<_;d++)u=g[d],h=new o(u,this.element.hasCSSClass(u.cssClass())),this._styleUIs.push(h),h.mount(this._domStyles);this._domAttributes=this.constructor.createDiv(["ct-properties-dialog__attributes"]),this._domView.appendChild(this._domAttributes),l=n.getRestrictedAtributes(this.element.tagName()),e=this.element.attributes(),t=[];for(a in e)c=e[a],l&&-1!==l.indexOf(a.toLowerCase())||t.push(a);for(t.sort(),p=0,m=t.length;p<m;p++)a=t[p],c=e[a],this._addAttributeUI(a,c);return this._addAttributeUI("",""),this._domCode=this.constructor.createDiv(["ct-properties-dialog__code"]),this._domView.appendChild(this._domCode),this._domInnerHTML=document.createElement("textarea"),this._domInnerHTML.setAttribute("class","ct-properties-dialog__inner-html"),this._domInnerHTML.setAttribute("name","code"),this._domInnerHTML.value=this.getElementInnerHTML(),this._domCode.appendChild(this._domInnerHTML),r=this.constructor.createDiv(["ct-control-group","ct-control-group--left"]),this._domControls.appendChild(r),this._domStylesTab=this.constructor.createDiv(["ct-control","ct-control--icon","ct-control--styles"]),this._domStylesTab.setAttribute("data-ct-tooltip",ContentEdit._("Styles")),r.appendChild(this._domStylesTab),this._domAttributesTab=this.constructor.createDiv(["ct-control","ct-control--icon","ct-control--attributes"]),this._domAttributesTab.setAttribute("data-ct-tooltip",ContentEdit._("Attributes")),r.appendChild(this._domAttributesTab),this._domCodeTab=this.constructor.createDiv(["ct-control","ct-control--icon","ct-control--code"]),this._domCodeTab.setAttribute("data-ct-tooltip",ContentEdit._("Code")),r.appendChild(this._domCodeTab),this._supportsCoding||ContentEdit.addCSSClass(this._domCodeTab,"ct-control--muted"),this._domRemoveAttribute=this.constructor.createDiv(["ct-control","ct-control--icon","ct-control--remove","ct-control--muted"]),this._domRemoveAttribute.setAttribute("data-ct-tooltip",ContentEdit._("Remove")),r.appendChild(this._domRemoveAttribute),i=this.constructor.createDiv(["ct-control-group","ct-control-group--right"]),this._domControls.appendChild(i),this._domApply=this.constructor.createDiv(["ct-control","ct-control--text","ct-control--apply"]),this._domApply.textContent=ContentEdit._("Apply"),i.appendChild(this._domApply),s=window.localStorage.getItem("ct-properties-dialog-tab"),"attributes"===s?(ContentEdit.addCSSClass(this._domElement,"ct-properties-dialog--attributes"),ContentEdit.addCSSClass(this._domAttributesTab,"ct-control--active")):"code"===s&&this._supportsCoding?(ContentEdit.addCSSClass(this._domElement,"ct-properties-dialog--code"),ContentEdit.addCSSClass(this._domCodeTab,"ct-control--active")):(ContentEdit.addCSSClass(this._domElement,"ct-properties-dialog--styles"),ContentEdit.addCSSClass(this._domStylesTab,"ct-control--active")),this._addDOMEventListeners()},PropertiesDialog.prototype.save=function(){var t,e;return e=null,this._supportsCoding&&(e=this._domInnerHTML.value),t={changedAttributes:this.changedAttributes(),changedStyles:this.changedStyles(),innerHTML:e},this.dispatchEvent(this.createEvent("save",t))},PropertiesDialog.prototype._addAttributeUI=function(t,i){var o,r;return r=this,o=new e(t,i),this._attributeUIs.push(o),o.addEventListener("blur",function(t){var e,n,i;if(r._focusedAttributeUI=null,ContentEdit.addCSSClass(r._domRemoveAttribute,"ct-control--muted"),e=r._attributeUIs.indexOf(this),i=r._attributeUIs.length,""===this.name()&&e<i-1&&(this.unmount(),r._attributeUIs.splice(e,1)),(n=r._attributeUIs[i-1])&&n.name()&&n.value())return r._addAttributeUI("","")}),o.addEventListener("focus",function(t){return r._focusedAttributeUI=this,ContentEdit.removeCSSClass(r._domRemoveAttribute,"ct-control--muted")}),o.addEventListener("namechange",function(e){var i,o,s,a,l,u,h;for(i=r.element,t=this.name().toLowerCase(),s=n.getRestrictedAtributes(i.tagName()),a=!0,s&&-1!==s.indexOf(t)&&(a=!1),h=r._attributeUIs,l=0,u=h.length;l<u;l++)o=h[l],""!==t&&o!==this&&o.name().toLowerCase()===t&&(a=!1);return this.valid(a),a?ContentEdit.removeCSSClass(r._domApply,"ct-control--muted"):ContentEdit.addCSSClass(r._domApply,"ct-control--muted")}),o.mount(this._domAttributes),o},PropertiesDialog.prototype._addDOMEventListeners=function(){var t,e;return PropertiesDialog.__super__._addDOMEventListeners.call(this),t=function(t){return function(e){var n,i,o,r,s,a;for(r=["attributes","code","styles"],s=0,a=r.length;s<a;s++)(i=r[s])!==e&&(o=i.charAt(0).toUpperCase()+i.slice(1),ContentEdit.removeCSSClass(t._domElement,"ct-properties-dialog--"+i),ContentEdit.removeCSSClass(t["_dom"+o+"Tab"],"ct-control--active"));return n=e.charAt(0).toUpperCase()+e.slice(1),ContentEdit.addCSSClass(t._domElement,"ct-properties-dialog--"+e),ContentEdit.addCSSClass(t["_dom"+n+"Tab"],"ct-control--active"),window.localStorage.setItem("ct-properties-dialog-tab",e)}}(this),this._domStylesTab.addEventListener("mousedown",function(e){return function(){return t("styles")}}()),this._domAttributesTab.addEventListener("mousedown",function(e){return function(){return t("attributes")}}()),this._supportsCoding&&this._domCodeTab.addEventListener("mousedown",function(e){return function(){return t("code")}}()),this._domRemoveAttribute.addEventListener("mousedown",function(t){return function(e){var n,i;if(e.preventDefault(),t._focusedAttributeUI&&(n=t._attributeUIs.indexOf(t._focusedAttributeUI),i=n===t._attributeUIs.length-1,t._focusedAttributeUI.unmount(),t._attributeUIs.splice(n,1),i))return t._addAttributeUI("","")}}(this)),e=function(t){return function(e){try{return new HTMLString.String(t._domInnerHTML.value),ContentEdit.removeCSSClass(t._domInnerHTML,"ct-properties-dialog__inner-html--invalid"),ContentEdit.removeCSSClass(t._domApply,"ct-control--muted")}catch(e){return ContentEdit.addCSSClass(t._domInnerHTML,"ct-properties-dialog__inner-html--invalid"),ContentEdit.addCSSClass(t._domApply,"ct-control--muted")}}}(this),this._domInnerHTML.addEventListener("input",e),this._domInnerHTML.addEventListener("propertychange",e),this._domApply.addEventListener("click",function(t){return function(e){var n;if(e.preventDefault(),n=t._domApply.getAttribute("class"),-1===n.indexOf("ct-control--muted"))return t.save()}}(this))},PropertiesDialog}(n.DialogUI),o=function(t){function StyleUI(t,e){this.style=t,StyleUI.__super__.constructor.call(this),this._applied=e}return a(StyleUI,t),StyleUI.prototype.applied=function(t){if(void 0===t)return this._applied;if(this._applied!==t)return this._applied=t,this._applied?ContentEdit.addCSSClass(this._domElement,"ct-section--applied"):ContentEdit.removeCSSClass(this._domElement,"ct-section--applied")},StyleUI.prototype.mount=function(t,e){var n;return null==e&&(e=null),this._domElement=this.constructor.createDiv(["ct-section"]),this._applied&&ContentEdit.addCSSClass(this._domElement,"ct-section--applied"),n=this.constructor.createDiv(["ct-section__label"]),n.textContent=this.style.name(),this._domElement.appendChild(n),this._domElement.appendChild(this.constructor.createDiv(["ct-section__switch"])),StyleUI.__super__.mount.call(this,t,e)},StyleUI.prototype._addDOMEventListeners=function(){var t;return t=function(t){return function(e){return e.preventDefault(),t.applied()?t.applied(!1):t.applied(!0)}}(this),this._domElement.addEventListener("click",t)},StyleUI}(n.AnchoredComponentUI),e=function(t){function AttributeUI(t,e){AttributeUI.__super__.constructor.call(this),this._initialName=t,this._initialValue=e}return a(AttributeUI,t),AttributeUI.prototype.name=function(){return this._domName.value.trim()},AttributeUI.prototype.value=function(){return this._domValue.value.trim()},AttributeUI.prototype.mount=function(t,e){return null==e&&(e=null),this._domElement=this.constructor.createDiv(["ct-attribute"]),this._domName=document.createElement("input"),this._domName.setAttribute("class","ct-attribute__name"),this._domName.setAttribute("name","name"),this._domName.setAttribute("placeholder",ContentEdit._("Name")),this._domName.setAttribute("type","text"),this._domName.setAttribute("value",this._initialName),this._domElement.appendChild(this._domName),this._domValue=document.createElement("input"),this._domValue.setAttribute("class","ct-attribute__value"),this._domValue.setAttribute("name","value"),this._domValue.setAttribute("placeholder",ContentEdit._("Value")),this._domValue.setAttribute("type","text"),this._domValue.setAttribute("value",this._initialValue),this._domElement.appendChild(this._domValue),AttributeUI.__super__.mount.call(this,t,e)},AttributeUI.prototype.valid=function(t){return t?ContentEdit.removeCSSClass(this._domName,"ct-attribute__name--invalid"):ContentEdit.addCSSClass(this._domName,"ct-attribute__name--invalid")},AttributeUI.prototype._addDOMEventListeners=function(){return this._domName.addEventListener("blur",function(t){return function(){var e,n,i;if(e=t.name(),n=t._domElement.nextSibling,t.dispatchEvent(t.createEvent("blur")),""===e&&n)return i=n.querySelector(".ct-attribute__name"),i.focus()}}(this)),this._domName.addEventListener("focus",function(t){return function(){return t.dispatchEvent(t.createEvent("focus"))}}(this)),this._domName.addEventListener("input",function(t){return function(){return t.dispatchEvent(t.createEvent("namechange"))}}(this)),this._domName.addEventListener("keydown",function(t){return function(e){if(13===e.keyCode)return t._domValue.focus()}}(this)),this._domValue.addEventListener("blur",function(t){return function(){return t.dispatchEvent(t.createEvent("blur"))}}(this)),this._domValue.addEventListener("focus",function(t){return function(){return t.dispatchEvent(t.createEvent("focus"))}}(this)),this._domValue.addEventListener("keydown",function(t){return function(e){var n,i;if(13===e.keyCode||9===e.keyCode&&!e.shiftKey)return e.preventDefault(),n=t._domElement.nextSibling,n||(t._domValue.blur(),n=t._domElement.nextSibling),n?(i=n.querySelector(".ct-attribute__name"),i.focus()):void 0}}(this))},AttributeUI}(n.AnchoredComponentUI),n.TableDialog=function(t){function TableDialog(t){this.table=t,this.table?TableDialog.__super__.constructor.call(this,"Update table"):TableDialog.__super__.constructor.call(this,"Insert table")}return a(TableDialog,t),TableDialog.prototype.mount=function(){var t,e,n,i,o,r,s;return TableDialog.__super__.mount.call(this),t={columns:3,foot:!1,head:!0},this.table&&(t={columns:this.table.firstSection().children[0].children.length,foot:this.table.tfoot(),head:this.table.thead()}),ContentEdit.addCSSClass(this._domElement,"ct-table-dialog"),ContentEdit.addCSSClass(this._domView,"ct-table-dialog__view"),s=["ct-section"],t.head&&s.push("ct-section--applied"),this._domHeadSection=this.constructor.createDiv(s),this._domView.appendChild(this._domHeadSection),o=this.constructor.createDiv(["ct-section__label"]),o.textContent=ContentEdit._("Table head"),this._domHeadSection.appendChild(o),this._domHeadSwitch=this.constructor.createDiv(["ct-section__switch"]),this._domHeadSection.appendChild(this._domHeadSwitch),this._domBodySection=this.constructor.createDiv(["ct-section","ct-section--applied","ct-section--contains-input"]),this._domView.appendChild(this._domBodySection),e=this.constructor.createDiv(["ct-section__label"]),e.textContent=ContentEdit._("Table body (columns)"),this._domBodySection.appendChild(e),this._domBodyInput=document.createElement("input"),this._domBodyInput.setAttribute("class","ct-section__input"),this._domBodyInput.setAttribute("maxlength","2"),this._domBodyInput.setAttribute("name","columns"),this._domBodyInput.setAttribute("type","text"),this._domBodyInput.setAttribute("value",t.columns),this._domBodySection.appendChild(this._domBodyInput),r=["ct-section"],t.foot&&r.push("ct-section--applied"),this._domFootSection=this.constructor.createDiv(r),this._domView.appendChild(this._domFootSection),i=this.constructor.createDiv(["ct-section__label"]),i.textContent=ContentEdit._("Table foot"),this._domFootSection.appendChild(i),this._domFootSwitch=this.constructor.createDiv(["ct-section__switch"]),this._domFootSection.appendChild(this._domFootSwitch),n=this.constructor.createDiv(["ct-control-group","ct-control-group--right"]),this._domControls.appendChild(n),this._domApply=this.constructor.createDiv(["ct-control","ct-control--text","ct-control--apply"]),this._domApply.textContent="Apply",n.appendChild(this._domApply),this._addDOMEventListeners()},TableDialog.prototype.save=function(){var t,e,n;return e=this._domFootSection.getAttribute("class"),n=this._domHeadSection.getAttribute("class"),t={columns:parseInt(this._domBodyInput.value),foot:e.indexOf("ct-section--applied")>-1,head:n.indexOf("ct-section--applied")>-1},this.dispatchEvent(this.createEvent("save",t))},TableDialog.prototype.unmount=function(){return TableDialog.__super__.unmount.call(this),this._domBodyInput=null,this._domBodySection=null,this._domApply=null,this._domHeadSection=null,this._domHeadSwitch=null,this._domFootSection=null,this._domFootSwitch=null},TableDialog.prototype._addDOMEventListeners=function(){var t;return TableDialog.__super__._addDOMEventListeners.call(this),t=function(t){return t.preventDefault(),this.getAttribute("class").indexOf("ct-section--applied")>-1?ContentEdit.removeCSSClass(this,"ct-section--applied"):ContentEdit.addCSSClass(this,"ct-section--applied")},this._domHeadSection.addEventListener("click",t),this._domFootSection.addEventListener("click",t),this._domBodySection.addEventListener("click",function(t){return function(e){return t._domBodyInput.focus()}}(this)),this._domBodyInput.addEventListener("input",function(t){return function(e){var n;return n=/^[1-9]\d{0,1}$/.test(e.target.value),n?(ContentEdit.removeCSSClass(t._domBodyInput,"ct-section__input--invalid"),ContentEdit.removeCSSClass(t._domApply,"ct-control--muted")):(ContentEdit.addCSSClass(t._domBodyInput,"ct-section__input--invalid"),ContentEdit.addCSSClass(t._domApply,"ct-control--muted"))}}(this)),this._domApply.addEventListener("click",function(t){return function(e){var n;if(e.preventDefault(),n=t._domApply.getAttribute("class"),-1===n.indexOf("ct-control--muted"))return t.save()}}(this))},TableDialog}(n.DialogUI),n.VideoDialog=function(t){function VideoDialog(){VideoDialog.__super__.constructor.call(this,"Insert video")}return a(VideoDialog,t),VideoDialog.prototype.clearPreview=function(){if(this._domPreview)return this._domPreview.parentNode.removeChild(this._domPreview),this._domPreview=void 0},VideoDialog.prototype.mount=function(){var t;return VideoDialog.__super__.mount.call(this),ContentEdit.addCSSClass(this._domElement,"ct-video-dialog"),ContentEdit.addCSSClass(this._domView,"ct-video-dialog__preview"),t=this.constructor.createDiv(["ct-control-group"]),this._domControls.appendChild(t),this._domInput=document.createElement("input"),this._domInput.setAttribute("class","ct-video-dialog__input"),this._domInput.setAttribute("name","url"),this._domInput.setAttribute("placeholder",ContentEdit._("Paste YouTube or Vimeo URL")+"..."),this._domInput.setAttribute("type","text"),t.appendChild(this._domInput),this._domButton=this.constructor.createDiv(["ct-control","ct-control--text","ct-control--insert","ct-control--muted"]),this._domButton.textContent=ContentEdit._("Insert"),t.appendChild(this._domButton),this._addDOMEventListeners()},VideoDialog.prototype.preview=function(t){return this.clearPreview(),this._domPreview=document.createElement("iframe"),this._domPreview.setAttribute("frameborder","0"),this._domPreview.setAttribute("height","100%"),this._domPreview.setAttribute("src",t),this._domPreview.setAttribute("width","100%"),this._domView.appendChild(this._domPreview)},VideoDialog.prototype.save=function(){var t,e;return e=this._domInput.value.trim(),t=n.getEmbedVideoURL(e),t?this.dispatchEvent(this.createEvent("save",{url:t})):this.dispatchEvent(this.createEvent("save",{url:e}))},VideoDialog.prototype.show=function(){return VideoDialog.__super__.show.call(this),this._domInput.focus()},VideoDialog.prototype.unmount=function(){return this.isMounted()&&this._domInput.blur(),VideoDialog.__super__.unmount.call(this),this._domButton=null,this._domInput=null,this._domPreview=null},VideoDialog.prototype._addDOMEventListeners=function(){return VideoDialog.__super__._addDOMEventListeners.call(this),this._domInput.addEventListener("input",function(t){return function(e){var i;return e.target.value?ContentEdit.removeCSSClass(t._domButton,"ct-control--muted"):ContentEdit.addCSSClass(t._domButton,"ct-control--muted"),t._updatePreviewTimeout&&clearTimeout(t._updatePreviewTimeout),i=function(){var e,i;return i=t._domInput.value.trim(),e=n.getEmbedVideoURL(i),e?t.preview(e):t.clearPreview()},t._updatePreviewTimeout=setTimeout(i,500)}}(this)),this._domInput.addEventListener("keypress",function(t){return function(e){if(13===e.keyCode)return t.save()}}(this)),this._domButton.addEventListener("click",function(t){return function(e){var n;if(e.preventDefault(),n=t._domButton.getAttribute("class"),-1===n.indexOf("ct-control--muted"))return t.save()}}(this))},VideoDialog}(n.DialogUI),r=function(t){function _EditorApp(){_EditorApp.__super__.constructor.call(this),this.history=null,this._state="dormant",this._busy=!1,this._namingProp=null,this._fixtureTest=function(t){return t.hasAttribute("data-fixture")},this._regionQuery=null,this._domRegions=null,this._regions={},this._orderedRegions=[],this._rootLastModified=null,this._regionsLastModified={},this._ignition=null,this._inspector=null,this._toolbox=null,this._emptyRegionsAllowed=!1}return a(_EditorApp,t),_EditorApp.prototype.ctrlDown=function(){return this._ctrlDown},_EditorApp.prototype.domRegions=function(){return this._domRegions},_EditorApp.prototype.getState=function(){return this._state},_EditorApp.prototype.ignition=function(){return this._ignition},_EditorApp.prototype.inspector=function(){return this._inspector},_EditorApp.prototype.isDormant=function(){return"dormant"===this._state},_EditorApp.prototype.isReady=function(){return"ready"===this._state},_EditorApp.prototype.isEditing=function(){return"editing"===this._state},_EditorApp.prototype.orderedRegions=function(){var t;return function(){var e,n,i,o;for(i=this._orderedRegions,o=[],e=0,n=i.length;e<n;e++)t=i[e],o.push(this._regions[t]);return o}.call(this)},_EditorApp.prototype.regions=function(){return this._regions},_EditorApp.prototype.shiftDown=function(){return this._shiftDown},_EditorApp.prototype.toolbox=function(){return this._toolbox},_EditorApp.prototype.busy=function(t){if(void 0===t&&(this._busy=t),this._busy=t,this._ignition)return this._ignition.busy(t)},_EditorApp.prototype.createPlaceholderElement=function(t){return new ContentEdit.Text("p",{},"")},_EditorApp.prototype.init=function(t,e,i,o){return null==e&&(e="id"),null==i&&(i=null),null==o&&(o=!0),this._namingProp=e,i&&(this._fixtureTest=i),this.mount(),o&&(this._ignition=new n.IgnitionUI,this.attach(this._ignition),this._ignition.addEventListener("edit",function(t){return function(e){return e.preventDefault(),t.start(),t._ignition.state("editing")}}(this)),this._ignition.addEventListener("confirm",function(t){return function(e){if(e.preventDefault(),"editing"===t._ignition.state())return t._ignition.state("ready"),t.stop(!0)}}(this)),this._ignition.addEventListener("cancel",function(t){return function(e){if(e.preventDefault(),"editing"===t._ignition.state())return t.stop(!1),t.isEditing()?t._ignition.state("editing"):t._ignition.state("ready")}}(this))),this._toolbox=new n.ToolboxUI(n.DEFAULT_TOOLS),this.attach(this._toolbox),this._inspector=new n.InspectorUI,this.attach(this._inspector),this._state="ready",this._handleDetach=function(t){return function(e){return t._preventEmptyRegions()}}(this),this._handleClipboardPaste=function(t){return function(e,n){var i;return i=null,n.clipboardData&&(i=n.clipboardData.getData("text/plain")),window.clipboardData&&(i=window.clipboardData.getData("TEXT")),t.paste(e,i)}}(this),this._handleNextRegionTransition=function(t){return function(e){var n,i,o,r,s,a,l;if(r=t.orderedRegions(),!((o=r.indexOf(e))>=r.length-1)){for(e=r[o+1],i=null,l=e.descendants(),s=0,a=l.length;s<a;s++)if(n=l[s],void 0!==n.content){i=n;break}return i?(i.focus(),void i.selection(new ContentSelect.Range(0,0))):ContentEdit.Root.get().trigger("next-region",e)}}}(this),this._handlePreviousRegionTransition=function(t){return function(e){var n,i,o,r,s,a,l,u;if(a=t.orderedRegions(),!((r=a.indexOf(e))<=0)){for(e=a[r-1],o=null,i=e.descendants(),i.reverse(),l=0,u=i.length;l<u;l++)if(n=i[l],void 0!==n.content){o=n;break}return o?(s=o.content.length(),o.focus(),void o.selection(new ContentSelect.Range(s,s))):ContentEdit.Root.get().trigger("previous-region",e)}}}(this),ContentEdit.Root.get().bind("detach",this._handleDetach),ContentEdit.Root.get().bind("paste",this._handleClipboardPaste),ContentEdit.Root.get().bind("next-region",this._handleNextRegionTransition),ContentEdit.Root.get().bind("previous-region",this._handlePreviousRegionTransition),this.syncRegions(t)},_EditorApp.prototype.destroy=function(){return ContentEdit.Root.get().unbind("detach",this._handleDetach),ContentEdit.Root.get().unbind("paste",this._handleClipboardPaste),ContentEdit.Root.get().unbind("next-region",this._handleNextRegionTransition),ContentEdit.Root.get().unbind("previous-region",this._handlePreviousRegionTransition),this.removeEventListener(),this.unmount(),this._children=[]},_EditorApp.prototype.highlightRegions=function(t){var e,n,i,o,r;for(o=this._domRegions,r=[],n=0,i=o.length;n<i;n++)e=o[n],t?r.push(ContentEdit.addCSSClass(e,"ct--highlight")):r.push(ContentEdit.removeCSSClass(e,"ct--highlight"));return r},_EditorApp.prototype.mount=function(){return this._domElement=this.constructor.createDiv(["ct-app"]),document.body.insertBefore(this._domElement,null),this._addDOMEventListeners()},_EditorApp.prototype.paste=function(t,e){var n,i,o,r,s,a,l,h,c,d,p,_,m,g,f,v,y,E,C,T,I,b,S;if(i=e,g=i.split("\n"),g=g.filter(function(t){return""!==t.trim()})){if(r=HTMLString.String.encode,y=!0,I=t.type(),1===g.length&&(y=!1),"PreText"===I&&(y=!1),t.can("spawn")||(y=!1),y){for("ListItemText"===I?(h=t.parent(),l=t.parent().parent(),a=l.children.indexOf(h)+1):(h=t,"Region"!==h.parent().type()&&(h=t.closest(function(t){return"Region"===t.parent().type()})),l=h.parent(),a=l.children.indexOf(h)+1),s=b=0,S=g.length;b<S;s=++b)_=g[s],_=r(_),"ListItemText"===I?(c=new ContentEdit.ListItem,d=new ContentEdit.ListItemText(_),c.attach(d),p=d):(c=new ContentEdit.Text("p",{},_),p=c),l.attach(c,a+s);return m=p.content.length(),p.focus(),p.selection(new ContentSelect.Range(m,m))}return i=r(i),i=new HTMLString.String(i,"PreText"===I),v=t.selection(),o=v.get()[0]+i.length(),T=t.content.substring(0,v.get()[0]),C=t.content.substring(v.get()[1]),f=t.content.substring(v.get()[0],v.get()[1]),f.length()&&(n=f.characters[0],E=n.tags(),n.isTag()&&E.shift(),E.length>=1&&(i=i.format.apply(i,[0,i.length()].concat(u.call(E))))),t.content=T.concat(i),t.content=t.content.concat(C,!1),t.updateInnerHTML(),t.taint(),v.set(o,o),t.selection(v)}},_EditorApp.prototype.unmount=function(){var t,e,n,i;if(this.isMounted()){for(i=this._children,e=0,n=i.length;e<n;e++)t=i[e],t.unmount();return this._domElement.parentNode.removeChild(this._domElement),this._domElement=null,this._removeDOMEventListeners(),this._ignition=null,this._inspector=null,this._toolbox=null}},_EditorApp.prototype.revert=function(){var t;if(this.dispatchEvent(this.createEvent("revert")))return!(n.CANCEL_MESSAGE&&(t=ContentEdit._(n.CANCEL_MESSAGE),ContentEdit.Root.get().lastModified()>this._rootLastModified&&!window.confirm(t)))&&(this.revertToSnapshot(this.history.goTo(0),!1),!0)},_EditorApp.prototype.revertToSnapshot=function(t,e){var n,i,o,r,s,a,l,u,h;null==e&&(e=!0),l=this._regions;for(i in l){for(o=l[i],u=o.children,s=0,a=u.length;s<a;s++)n=u[s],n.unmount();1===o.children.length&&o.children[0].isFixed()?(r=this.constructor.createDiv(),r.innerHTML=t.regions[i],o.domElement().parentNode.replaceChild(r.firstElementChild,o.domElement())):o.domElement().innerHTML=t.regions[i]}if(e){ContentEdit.Root.get().focused()&&ContentEdit.Root.get().focused().blur(),this._regions={},this.syncRegions(null,!0),ContentEdit.Root.get()._modified=t.rootModified,h=this._regions;for(i in h)o=h[i],t.regionModifieds[i]&&(o._modified=t.regionModifieds[i]);return this.history.replaceRegions(this._regions),this.history.restoreSelection(t),this._inspector.updateTags()}},_EditorApp.prototype.save=function(t){var e,n,i,o,r,s,a,l,u,h,c;if(this.dispatchEvent(this.createEvent("save",{passive:t}))){if(s=ContentEdit.Root.get(),s.lastModified()===this._rootLastModified&&t)return void this.dispatchEvent(this.createEvent("saved",{regions:{},passive:t}));i={},h=this._regions;for(o in h){if(r=h[o],n=r.html(),1===r.children.length&&(e=r.children[0],e.content&&!e.content.html()&&(n="")),!t){for(c=r.children,l=0,u=c.length;l<u;l++)e=c[l],e.unmount();1===r.children.length&&r.children[0].isFixed()?(a=this.constructor.createDiv(),a.innerHTML=n,r.domElement().parentNode.replaceChild(a.firstElementChild,r.domElement())):r.domElement().innerHTML=n}r.lastModified()!==this._regionsLastModified[o]&&(i[o]=n,this._regionsLastModified[o]=r.lastModified())}return this.dispatchEvent(this.createEvent("saved",{regions:i,passive:t}))}},_EditorApp.prototype.setRegionOrder=function(t){return this._orderedRegions=t.slice()},_EditorApp.prototype.start=function(){if(this.dispatchEvent(this.createEvent("start")))return this.busy(!0),this.syncRegions(),this._initRegions(),this._preventEmptyRegions(),this._rootLastModified=ContentEdit.Root.get().lastModified(),this.history=new n.History(this._regions),this.history.watch(),this._state="editing",this._toolbox.show(),this._inspector.show(),this.busy(!1)},_EditorApp.prototype.stop=function(t){var e;if(this.dispatchEvent(this.createEvent("stop",{save:t}))){if(e=ContentEdit.Root.get().focused(),e&&e.isMounted()&&void 0!==e._syncContent&&e._syncContent(),t)this.save();else if(!this.revert())return;this.history.stopWatching(),this.history=null,this._toolbox.hide(),this._inspector.hide(),this._regions={},this._state="ready",ContentEdit.Root.get().focused()&&this._allowEmptyRegions(function(t){return function(){return ContentEdit.Root.get().focused().blur()}}())}},_EditorApp.prototype.syncRegions=function(t,e){if(t&&(this._regionQuery=t),this._domRegions=[],this._regionQuery&&("string"==typeof this._regionQuery||this._regionQuery instanceof String?this._domRegions=document.querySelectorAll(this._regionQuery):this._domRegions=this._regionQuery),"editing"===this._state&&(this._initRegions(e),this._preventEmptyRegions()),this._ignition)return this._domRegions.length?this._ignition.show():this._ignition.hide()},_EditorApp.prototype._addDOMEventListeners=function(){return this._handleHighlightOn=function(t){return function(e){var i;if(17!==(i=e.keyCode)&&224!==i&&91!==i&&93!==i||(t._ctrlDown=!0),16===e.keyCode&&!t._ctrlDown){if(t._highlightTimeout)return;return t._shiftDown=!0,void(t._highlightTimeout=setTimeout(function(){return t.highlightRegions(!0)},n.HIGHLIGHT_HOLD_DURATION))}return clearTimeout(t._highlightTimeout),t.highlightRegions(!1)}}(this),this._handleHighlightOff=function(t){return function(e){var n;return 17===(n=e.keyCode)||224===n?void(t._ctrlDown=!1):16===e.keyCode?(t._shiftDown=!1,t._highlightTimeout&&(clearTimeout(t._highlightTimeout),t._highlightTimeout=null),t.highlightRegions(!1)):void 0}}(this),this._handleVisibility=function(t){return function(e){if(!document.hasFocus())return clearTimeout(t._highlightTimeout),t.highlightRegions(!1)}}(this),document.addEventListener("keydown",this._handleHighlightOn),document.addEventListener("keyup",this._handleHighlightOff),document.addEventListener("visibilitychange",this._handleVisibility),this._handleBeforeUnload=function(t){return function(e){var i;if("editing"===t._state&&n.CANCEL_MESSAGE)return i=ContentEdit._(n.CANCEL_MESSAGE),(e||window.event).returnValue=i,i}}(this),window.addEventListener("beforeunload",this._handleBeforeUnload),this._handleUnload=function(t){return function(e){return t.destroy()}}(this),window.addEventListener("unload",this._handleUnload)},_EditorApp.prototype._allowEmptyRegions=function(t){return this._emptyRegionsAllowed=!0,t(),this._emptyRegionsAllowed=!1},_EditorApp.prototype._preventEmptyRegions=function(){var t,e,n,i,o,r,s,a,l,u,h;if(!this._emptyRegionsAllowed){l=this._regions,h=[];for(i in l){for(r=l[i],n=r.lastModified(),e=!1,u=r.children,s=0,a=u.length;s<a;s++)if(t=u[s],"Static"!==t.type()){e=!0;break}e||(o=this.createPlaceholderElement(r),r.attach(o),h.push(r._modified=n))}return h}},_EditorApp.prototype._removeDOMEventListeners=function(){return document.removeEventListener("keydown",this._handleHighlightOn),document.removeEventListener("keyup",this._handleHighlightOff),window.removeEventListener("beforeunload",this._handleBeforeUnload),window.removeEventListener("unload",this._handleUnload)},_EditorApp.prototype._initRegions=function(t){var e,n,i,o,r,s,a,l,u,h;for(null==t&&(t=!1),n={},this._orderedRegions=[],l=this._domRegions,i=s=0,a=l.length;s<a;i=++s)e=l[i],r=e.getAttribute(this._namingProp),r||(r=i),n[r]=!0,this._orderedRegions.push(r),this._regions[r]&&this._regions[r].domElement()===e||(this._fixtureTest(e)?this._regions[r]=new ContentEdit.Fixture(e):this._regions[r]=new ContentEdit.Region(e),t||(this._regionsLastModified[r]=this._regions[r].lastModified()));u=this._regions,h=[];for(r in u)u[r],n[r]||(delete this._regions[r],delete this._regionsLastModified[r],o=this._orderedRegions.indexOf(r),o>-1?h.push(this._orderedRegions.splice(o,1)):h.push(void 0));return h},_EditorApp}(n.ComponentUI),n.EditorApp=function(){function EditorApp(){}var t;return t=null,EditorApp.get=function(){var e;return e=n.EditorApp.getCls(),null!=t?t:t=new e},EditorApp.getCls=function(){return r},EditorApp}(),n.History=function(){function History(t){this._lastSnapshotTaken=null,this._regions={},this.replaceRegions(t),this._snapshotIndex=-1,this._snapshots=[],this._store()}return History.prototype.canRedo=function(){return this._snapshotIndex<this._snapshots.length-1},History.prototype.canUndo=function(){return this._snapshotIndex>0},History.prototype.index=function(){return this._snapshotIndex},History.prototype.length=function(){return this._snapshots.length},History.prototype.snapshot=function(){return this._snapshots[this._snapshotIndex]},History.prototype.goTo=function(t){return this._snapshotIndex=Math.min(this._snapshots.length-1,Math.max(0,t)),this.snapshot()},History.prototype.redo=function(){return this.goTo(this._snapshotIndex+1)},History.prototype.replaceRegions=function(t){var e,n,i;this._regions={},i=[];for(e in t)n=t[e],i.push(this._regions[e]=n);return i},History.prototype.restoreSelection=function(t){var e,n;if(t.selected)return n=this._regions[t.selected.region],e=n.descendants()[t.selected.element],e.focus(),e.selection&&t.selected.selection?e.selection(t.selected.selection):void 0},History.prototype.stopWatching=function(){if(this._watchInterval&&clearInterval(this._watchInterval),this._delayedStoreTimeout)return clearTimeout(this._delayedStoreTimeout)},History.prototype.undo=function(){return this.goTo(this._snapshotIndex-1)},History.prototype.watch=function(){var t;return this._lastSnapshotTaken=Date.now(),t=function(t){return function(){var e,n;if(null!==(n=ContentEdit.Root.get().lastModified())&&n>t._lastSnapshotTaken){if(t._delayedStoreRequested===n)return;return t._delayedStoreTimeout&&clearTimeout(t._delayedStoreTimeout),e=function(){return t._lastSnapshotTaken=n,t._store()},t._delayedStoreRequested=n,t._delayedStoreTimeout=setTimeout(e,500)}}}(this),this._watchInterval=setInterval(t,50)},History.prototype._store=function(){var t,e,n,i,o,r,s;o={regions:{},regionModifieds:{},rootModified:ContentEdit.Root.get().lastModified(),selected:null},r=this._regions;for(e in r)i=r[e],o.regions[e]=i.html(),o.regionModifieds[e]=i.lastModified();if(t=ContentEdit.Root.get().focused()){if(o.selected={},!(i=t.closest(function(t){return"Region"===t.type()||"Fixture"===t.type()})))return;s=this._regions;for(e in s)if(n=s[e],i===n){o.selected.region=e;break}o.selected.element=i.descendants().indexOf(t),t.selection&&(o.selected.selection=t.selection())}return this._snapshotIndex<this._snapshots.length-1&&(this._snapshots=this._snapshots.slice(0,this._snapshotIndex+1)),this._snapshotIndex++,this._snapshots.splice(this._snapshotIndex,0,o)},History}(),n.StylePalette=function(){function StylePalette(){}return StylePalette._styles=[],StylePalette.add=function(t){return this._styles=this._styles.concat(t)},StylePalette.styles=function(t){var e;return void 0===t?this._styles.slice():(e=t.tagName(),this._styles.filter(function(t){return!t._applicableTo||-1!==t._applicableTo.indexOf(e)}))},StylePalette}(),n.Style=function(){function Style(t,e,n){this._name=t,this._cssClass=e,this._applicableTo=n||null}return Style.prototype.applicableTo=function(){return this._applicableTo},Style.prototype.cssClass=function(){return this._cssClass},Style.prototype.name=function(){return this._name},Style}(),n.ToolShelf=function(){function ToolShelf(){}return ToolShelf._tools={},ToolShelf.stow=function(t,e){return this._tools[e]=t},ToolShelf.fetch=function(t){if(!this._tools[t])throw new Error("`"+t+"` has not been stowed on the tool shelf");return this._tools[t]},ToolShelf}(),n.Tool=function(){function Tool(){}return Tool.label="Tool",Tool.icon="tool",Tool.requiresElement=!0,Tool.canApply=function(t,e){return!1},Tool.isApplied=function(t,e){return!1},Tool.apply=function(t,e,n){throw new Error("Not implemented")},Tool.editor=function(){return n.EditorApp.get()},Tool.dispatchEditorEvent=function(t,e){return this.editor().dispatchEvent(this.editor().createEvent(t,e))},Tool._insertAt=function(t){var e,n;return n=t,"Region"!==n.parent().type()&&(n=t.closest(function(t){return"Region"===t.parent().type()})),e=n.parent().children.indexOf(n)+1,[n,e]},Tool}(),n.Tools.Bold=function(t){function Bold(){return Bold.__super__.constructor.apply(this,arguments)}return a(Bold,t),n.ToolShelf.stow(Bold,"bold"),Bold.label="Bold",Bold.icon="bold",Bold.tagName="b",Bold.canApply=function(t,e){return!!t.content&&(e&&!e.isCollapsed())},Bold.isApplied=function(t,e){var n,i,o;return!(void 0===t.content||!t.content.length())&&(o=e.get(),n=o[0],i=o[1],n===i&&(i+=1),t.content.slice(n,i).hasTags(this.tagName,!0))},Bold.apply=function(t,e,n){var i,o,r,s;if(r={tool:this,element:t,selection:e},this.dispatchEditorEvent("tool-apply",r))return t.storeState(),s=e.get(),i=s[0],o=s[1],this.isApplied(t,e)?t.content=t.content.unformat(i,o,new HTMLString.Tag(this.tagName)):t.content=t.content.format(i,o,new HTMLString.Tag(this.tagName)),t.content.optimize(),t.updateInnerHTML(),t.taint(),t.restoreState(),n(!0),this.dispatchEditorEvent("tool-applied",r)},Bold}(n.Tool),n.Tools.Italic=function(t){function Italic(){return Italic.__super__.constructor.apply(this,arguments)}return a(Italic,t),n.ToolShelf.stow(Italic,"italic"),Italic.label="Italic",Italic.icon="italic",Italic.tagName="i",Italic}(n.Tools.Bold),n.Tools.Link=function(t){function Link(){return Link.__super__.constructor.apply(this,arguments)}return a(Link,t),n.ToolShelf.stow(Link,"link"),Link.label="Link",Link.icon="link",Link.tagName="a",Link.getAttr=function(t,e,n){var i,o,r,s,a,l,u,h,c,d,p,_;if("Image"===e.type()){if(e.a)return e.a[t]}else{if(e.isFixed()&&"a"===e.tagName())return e.attr(t);for(d=n.get(),o=d[0],a=d[1],r=e.content.slice(o,a),p=r.characters,l=0,h=p.length;l<h;l++)if(i=p[l],i.hasTags("a"))for(_=i.tags(),u=0,c=_.length;u<c;u++)if(s=_[u],"a"===s.name())return s.attr(t)}return""},Link.canApply=function(t,e){var n;return"Image"===t.type()||(!(!t.isFixed()||"a"!==t.tagName())||!!t.content&&(!!e&&!!(!e.isCollapsed()||(n=t.content.characters[e.get()[0]])&&n.hasTags("a"))))},Link.isApplied=function(t,e){return"Image"===t.type()?t.a:!(!t.isFixed()||"a"!==t.tagName())||Link.__super__.constructor.isApplied.call(this,t,e)},Link.apply=function(t,e,i){var o,r,s,a,l,u,h,c,d,p,_,m,g,f,v,y,E,C;if(y={tool:this,element:t,selection:e},this.dispatchEditorEvent("tool-apply",y)){if(r=!1,"Image"===t.type())p=t.domElement().getBoundingClientRect();else if(t.isFixed()&&"a"===t.tagName())p=t.domElement().getBoundingClientRect();else{if(e.isCollapsed()){for(s=t.content.characters,f=e.get(0)[0],u=f;f>0&&s[f-1].hasTags("a");)f-=1;for(;u<s.length&&s[u].hasTags("a");)u+=1;e=new ContentSelect.Range(f,u),e.select(t.domElement())}t.storeState(),g=new HTMLString.Tag("span",{class:"ct--puesdo-select"}),E=e.get(),h=E[0],v=E[1],t.content=t.content.format(h,v,g),t.updateInnerHTML(),l=t.domElement(),c=l.getElementsByClassName("ct--puesdo-select"),p=c[0].getBoundingClientRect()}return o=n.EditorApp.get(),d=new n.ModalUI(!0,!0),d.addEventListener("click",function(){if(this.unmount(),a.hide(),t.content&&(t.content=t.content.unformat(h,v,g),t.updateInnerHTML(),t.restoreState()),i(r),r)return n.Tools.Link.dispatchEditorEvent("tool-applied",y)}),a=new n.LinkDialog(this.getAttr("href",t,e),this.getAttr("target",t,e)),C=n.getScrollPosition(),_=C[0],m=C[1],a.position([p.left+p.width/2+_,p.top+p.height/2+m]),a.addEventListener("save",function(e){var n,i,o,s,a,l,u,c,p;if(s=e.detail(),r=!0,"Image"===t.type()){if(i=["align-center","align-left","align-right"],s.href){for(t.a={href:s.href},t.a&&(t.a.class=t.a.class),s.target&&(t.a.target=s.target),l=0,c=i.length;l<c;l++)if(o=i[l],t.hasCSSClass(o)){t.removeCSSClass(o),t.a.class=o;break}}else{for(a=[],t.a.class&&(a=t.a.class.split(" ")),u=0,p=i.length;u<p;u++)if(o=i[u],a.indexOf(o)>-1){t.addCSSClass(o);break}t.a=null}t.unmount(),t.mount()}else t.isFixed()&&"a"===t.tagName()?t.attr("href",s.href):(t.content=t.content.unformat(h,v,"a"),s.href&&(n=new HTMLString.Tag("a",s),t.content=t.content.format(h,v,n),t.content.optimize()),t.updateInnerHTML());return t.taint(),d.dispatchEvent(d.createEvent("click"))}),o.attach(d),o.attach(a),d.show(),a.show()}},Link}(n.Tools.Bold),n.Tools.Heading=function(t){function Heading(){return Heading.__super__.constructor.apply(this,arguments)}return a(Heading,t),n.ToolShelf.stow(Heading,"heading"),Heading.label="Heading",Heading.icon="heading",Heading.tagName="h1",Heading.canApply=function(t,e){return!t.isFixed()&&(void 0!==t.content&&-1!==["Text","PreText"].indexOf(t.type()))},Heading.isApplied=function(t,e){return!!t.content&&(-1!==["Text","PreText"].indexOf(t.type())&&t.tagName()===this.tagName)},Heading.apply=function(t,e,n){var i,o,r,s,a;if(a={tool:this,element:t,selection:e},this.dispatchEditorEvent("tool-apply",a))return t.storeState(),"PreText"===t.type()?(i=t.content.html().replace(/&nbsp;/g," "),s=new ContentEdit.Text(this.tagName,{},i),r=t.parent(),o=r.children.indexOf(t),r.detach(t),r.attach(s,o),t.blur(),s.focus(),s.selection(e)):(t.removeAttr("class"),t.tagName()===this.tagName?t.tagName("p"):t.tagName(this.tagName),t.restoreState()),this.dispatchEditorEvent("tool-applied",a),n(!0)},Heading}(n.Tool),n.Tools.Subheading=function(t){function Subheading(){return Subheading.__super__.constructor.apply(this,arguments)}return a(Subheading,t),n.ToolShelf.stow(Subheading,"subheading"),Subheading.label="Subheading",Subheading.icon="subheading",Subheading.tagName="h2",Subheading}(n.Tools.Heading),n.Tools.Paragraph=function(t){function Paragraph(){return Paragraph.__super__.constructor.apply(this,arguments)}return a(Paragraph,t),n.ToolShelf.stow(Paragraph,"paragraph"),Paragraph.label="Paragraph",Paragraph.icon="paragraph",Paragraph.tagName="p",Paragraph.canApply=function(t,e){return!t.isFixed()&&void 0!==t},Paragraph.apply=function(t,e,i){var o,r,s,a;return o=this.editor().ctrlDown(),n.Tools.Heading.canApply(t)&&!o?Paragraph.__super__.constructor.apply.call(this,t,e,i):(a={tool:this,element:t,selection:e},this.dispatchEditorEvent("tool-apply",a)?("Region"!==t.parent().type()&&(t=t.closest(function(t){return"Region"===t.parent().type()})),s=t.parent(),r=new ContentEdit.Text("p"),s.attach(r,s.children.indexOf(t)+1),r.focus(),i(!0),this.dispatchEditorEvent("tool-applied",a)):void 0)},Paragraph}(n.Tools.Heading),n.Tools.Preformatted=function(t){function Preformatted(){return Preformatted.__super__.constructor.apply(this,arguments)}return a(Preformatted,t),n.ToolShelf.stow(Preformatted,"preformatted"),Preformatted.label="Preformatted",Preformatted.icon="preformatted",Preformatted.tagName="pre",Preformatted.apply=function(t,e,i){var o,r,s,a,l;if(l={tool:this,element:t,selection:e},this.dispatchEditorEvent("tool-apply",l))return"PreText"===t.type()?void n.Tools.Paragraph.apply(t,e,i):(a=t.content.text(),s=new ContentEdit.PreText("pre",{},HTMLString.String.encode(a)),r=t.parent(),o=r.children.indexOf(t),r.detach(t),r.attach(s,o),t.blur(),s.focus(),s.selection(e),i(!0),this.dispatchEditorEvent("tool-applied",l))},Preformatted}(n.Tools.Heading),n.Tools.AlignLeft=function(t){function AlignLeft(){return AlignLeft.__super__.constructor.apply(this,arguments)}return a(AlignLeft,t),n.ToolShelf.stow(AlignLeft,"align-left"),AlignLeft.label="Align left",AlignLeft.icon="align-left",AlignLeft.className="text-left",AlignLeft.canApply=function(t,e){return void 0!==t.content},AlignLeft.isApplied=function(t,e){var n;return!!this.canApply(t)&&("ListItemText"!==(n=t.type())&&"TableCellText"!==n||(t=t.parent()),t.hasCSSClass(this.className))},AlignLeft.apply=function(t,e,i){var o,r,s,a,l,u;if(s={tool:this,element:t,selection:e},this.dispatchEditorEvent("tool-apply",s)){for("ListItemText"!==(u=t.type())&&"TableCellText"!==u||(t=t.parent()),o=[n.Tools.AlignLeft.className,n.Tools.AlignCenter.className,n.Tools.AlignRight.className],a=0,l=o.length;a<l;a++)if(r=o[a],t.hasCSSClass(r)&&(t.removeCSSClass(r),r===this.className))return i(!0);return t.addCSSClass(this.className),i(!0),this.dispatchEditorEvent("tool-applied",s)}},AlignLeft}(n.Tool),n.Tools.AlignCenter=function(t){function AlignCenter(){return AlignCenter.__super__.constructor.apply(this,arguments)}return a(AlignCenter,t),n.ToolShelf.stow(AlignCenter,"align-center"),AlignCenter.label="Align center",AlignCenter.icon="align-center",AlignCenter.className="text-center",AlignCenter}(n.Tools.AlignLeft),n.Tools.AlignRight=function(t){function AlignRight(){return AlignRight.__super__.constructor.apply(this,arguments)}return a(AlignRight,t),n.ToolShelf.stow(AlignRight,"align-right"),AlignRight.label="Align right",AlignRight.icon="align-right",AlignRight.className="text-right",AlignRight}(n.Tools.AlignLeft),n.Tools.UnorderedList=function(t){function UnorderedList(){return UnorderedList.__super__.constructor.apply(this,arguments)}return a(UnorderedList,t),n.ToolShelf.stow(UnorderedList,"unordered-list"),UnorderedList.label="Bullet list",UnorderedList.icon="unordered-list",UnorderedList.listTag="ul",UnorderedList.canApply=function(t,e){var n;return!t.isFixed()&&(void 0!==t.content&&("Region"===(n=t.parent().type())||"ListItem"===n))},UnorderedList.apply=function(t,e,n){var i,o,r,s,a,l;if(l={tool:this,element:t,selection:e},this.dispatchEditorEvent("tool-apply",l))return"ListItem"===t.parent().type()?(t.storeState(),o=t.closest(function(t){return"List"===t.type()}),o.tagName(this.listTag),t.restoreState()):(s=new ContentEdit.ListItemText(t.content.copy()),r=new ContentEdit.ListItem,r.attach(s),o=new ContentEdit.List(this.listTag,{}),o.attach(r),a=t.parent(),i=a.children.indexOf(t),a.detach(t),a.attach(o,i),s.focus(),s.selection(e)),n(!0),this.dispatchEditorEvent("tool-applied",l)},UnorderedList}(n.Tool),n.Tools.OrderedList=function(t){function OrderedList(){return OrderedList.__super__.constructor.apply(this,arguments)}return a(OrderedList,t),n.ToolShelf.stow(OrderedList,"ordered-list"),OrderedList.label="Numbers list",OrderedList.icon="ordered-list",OrderedList.listTag="ol",OrderedList}(n.Tools.UnorderedList),n.Tools.Table=function(t){function Table(){return Table.__super__.constructor.apply(this,arguments)}return a(Table,t),n.ToolShelf.stow(Table,"table"),Table.label="Table",Table.icon="table",Table.canApply=function(t,e){return!t.isFixed()&&void 0!==t},Table.apply=function(t,e,i){var o,r,s,a,l;if(l={tool:this,element:t,selection:e},this.dispatchEditorEvent("tool-apply",l))return t.storeState&&t.storeState(),o=n.EditorApp.get(),s=new n.ModalUI,a=t.closest(function(t){return t&&"Table"===t.type()}),r=new n.TableDialog(a),r.addEventListener("cancel",function(e){return function(){return s.hide(),r.hide(),t.restoreState&&t.restoreState(),i(!1)}}()),r.addEventListener("save",function(e){return function(n){var o,u,h,c,d;return c=n.detail(),u=!0,a?(e._updateTable(c,a),u=t.closest(function(t){return t&&"Table"===t.type()})):(a=e._createTable(c),d=e._insertAt(t),h=d[0],o=d[1],h.parent().attach(a,o),u=!1),u?t.restoreState():a.firstSection().children[0].children[0].children[0].focus(),s.hide(),r.hide(),i(!0),e.dispatchEditorEvent("tool-applied",l)}}(this)),o.attach(s),o.attach(r),s.show(),r.show()},Table._adjustColumns=function(t,e){var n,i,o,r,s,a,l,u,h,c,d;for(c=t.children,d=[],u=0,h=c.length;u<h;u++)l=c[u],i=l.children[0].tagName(),r=l.children.length,s=e-r,s<0?d.push(function(){var t,e;for(e=[],a=t=s;s<=0?t<0:t>0;a=s<=0?++t:--t)n=l.children[l.children.length-1],e.push(l.detach(n));return e}()):s>0?d.push(function(){var t,e;for(e=[],a=t=0;0<=s?t<s:t>s;a=0<=s?++t:--t)n=new ContentEdit.TableCell(i),l.attach(n),o=new ContentEdit.TableCellText(""),e.push(n.attach(o));return e}()):d.push(void 0);return d},Table._createTable=function(t){var e,n,i,o;return o=new ContentEdit.Table,t.head&&(i=this._createTableSection("thead","th",t.columns),o.attach(i)),e=this._createTableSection("tbody","td",t.columns),o.attach(e),t.foot&&(n=this._createTableSection("tfoot","td",t.columns),o.attach(n)),o},Table._createTableSection=function(t,e,n){var i,o,r,s,a;for(s=new ContentEdit.TableSection(t),r=new ContentEdit.TableRow,s.attach(r),a=0;0<=n?a<n:a>n;0<=n?++a:--a)i=new ContentEdit.TableCell(e),r.attach(i),o=new ContentEdit.TableCellText(""),i.attach(o);return s},Table._updateTable=function(t,e){var n,i,o,r,s,a,l;if(!t.head&&e.thead()&&e.detach(e.thead()),!t.foot&&e.tfoot()&&e.detach(e.tfoot()),n=e.firstSection().children[0].children.length,t.columns!==n)for(l=e.children,s=0,a=l.length;s<a;s++)r=l[s],this._adjustColumns(r,t.columns);if(t.head&&!e.thead()&&(o=this._createTableSection("thead","th",t.columns),e.attach(o)),t.foot&&!e.tfoot())return i=this._createTableSection("tfoot","td",t.columns),e.attach(i)},Table}(n.Tool),n.Tools.Indent=function(t){function Indent(){return Indent.__super__.constructor.apply(this,arguments)}return a(Indent,t),n.ToolShelf.stow(Indent,"indent"),Indent.label="Indent",Indent.icon="indent",Indent.canApply=function(t,e){return"ListItem"===t.parent().type()&&t.parent().parent().children.indexOf(t.parent())>0},Indent.apply=function(t,e,n){var i;if(i={tool:this,element:t,selection:e},this.dispatchEditorEvent("tool-apply",i))return t.parent().indent(),n(!0),this.dispatchEditorEvent("tool-applied",i)},Indent}(n.Tool),n.Tools.Unindent=function(t){function Unindent(){return Unindent.__super__.constructor.apply(this,arguments)}return a(Unindent,t),n.ToolShelf.stow(Unindent,"unindent"),Unindent.label="Unindent",Unindent.icon="unindent",Unindent.canApply=function(t,e){return"ListItem"===t.parent().type()},Unindent.apply=function(t,e,n){var i;if(i={tool:this,element:t,selection:e},this.dispatchEditorEvent("tool-apply",i))return t.parent().unindent(),n(!0),this.dispatchEditorEvent("tool-applied",i)},Unindent}(n.Tool),n.Tools.LineBreak=function(t){function LineBreak(){return LineBreak.__super__.constructor.apply(this,arguments)}return a(LineBreak,t),n.ToolShelf.stow(LineBreak,"line-break"),LineBreak.label="Line break",LineBreak.icon="line-break",LineBreak.canApply=function(t,e){return t.content},LineBreak.apply=function(t,e,n){var i,o,r,s,a;if(a={tool:this,element:t,selection:e},this.dispatchEditorEvent("tool-apply",a))return o=e.get()[0]+1,s=t.content.substring(0,e.get()[0]),r=t.content.substring(e.get()[1]),i=new HTMLString.String("<br>",t.content.preserveWhitespace()),t.content=s.concat(i,r),t.updateInnerHTML(),t.taint(),e.set(o,o),t.selection(e),n(!0),this.dispatchEditorEvent("tool-applied",a)},LineBreak}(n.Tool),n.Tools.Image=function(t){function Image(){return Image.__super__.constructor.apply(this,arguments)}return a(Image,t),n.ToolShelf.stow(Image,"image"),Image.label="Image",Image.icon="image",Image.canApply=function(t,e){return!t.isFixed()||"ImageFixture"===t.type()},Image.apply=function(t,e,i){var o,r,s,a;if(a={tool:this,element:t,selection:e},this.dispatchEditorEvent("tool-apply",a))return t.storeState&&t.storeState(),o=n.EditorApp.get(),s=new n.ModalUI,r=new n.ImageDialog,r.addEventListener("cancel",function(e){return function(){return s.hide(),r.hide(),t.restoreState&&t.restoreState(),i(!1)}}()),r.addEventListener("save",function(e){return function(n){var o,l,u,h,c,d,p,_;return o=n.detail(),c=o.imageURL,h=o.imageSize,u=o.imageAttrs,u||(u={}),u.height=h[1],u.src=c,u.width=h[0],"ImageFixture"===t.type()?t.src(c):(l=new ContentEdit.Image(u),_=e._insertAt(t),p=_[0],d=_[1],p.parent().attach(l,d),l.focus()),s.hide(),r.hide(),i(!0),e.dispatchEditorEvent("tool-applied",a)}}(this)),o.attach(s),o.attach(r),s.show(),r.show()},Image}(n.Tool),n.Tools.Video=function(t){function Video(){return Video.__super__.constructor.apply(this,arguments)}return a(Video,t),n.ToolShelf.stow(Video,"video"),Video.label="Video",Video.icon="video",Video.canApply=function(t,e){return!t.isFixed()},Video.apply=function(t,e,i){var o,r,s,a;if(a={tool:this,element:t,selection:e},this.dispatchEditorEvent("tool-apply",a))return t.storeState&&t.storeState(),o=n.EditorApp.get(),s=new n.ModalUI,r=new n.VideoDialog,r.addEventListener("cancel",function(e){return function(){return s.hide(),r.hide(),t.restoreState&&t.restoreState(),i(!1)}}()),r.addEventListener("save",function(e){return function(o){var l,u,h,c,d,p;if(c=o.detail().url,c?(d=new ContentEdit.Video("iframe",{frameborder:0,height:n.DEFAULT_VIDEO_HEIGHT,src:c,width:n.DEFAULT_VIDEO_WIDTH}),p=e._insertAt(t),h=p[0],u=p[1],h.parent().attach(d,u),d.focus()):t.restoreState&&t.restoreState(),s.hide(),r.hide(),l=""!==c,i(l),l)return e.dispatchEditorEvent("tool-applied",a)}}(this)),o.attach(s),o.attach(r),s.show(),r.show()},Video}(n.Tool),n.Tools.Undo=function(t){function Undo(){return Undo.__super__.constructor.apply(this,arguments)}return a(Undo,t),n.ToolShelf.stow(Undo,"undo"),Undo.label="Undo",Undo.icon="undo",Undo.requiresElement=!1,Undo.canApply=function(t,e){var i;return i=n.EditorApp.get(),i.history&&i.history.canUndo()},Undo.apply=function(t,e,n){var i,o,r;if(r={tool:this,element:t,selection:e},this.dispatchEditorEvent("tool-apply",r))return i=this.editor(),i.history.stopWatching(),o=i.history.undo(),i.revertToSnapshot(o),i.history.watch(),this.dispatchEditorEvent("tool-applied",r)},Undo}(n.Tool),n.Tools.Redo=function(t){function Redo(){return Redo.__super__.constructor.apply(this,arguments)}return a(Redo,t),n.ToolShelf.stow(Redo,"redo"),Redo.label="Redo",Redo.icon="redo",Redo.requiresElement=!1,Redo.canApply=function(t,e){var i;return i=n.EditorApp.get(),i.history&&i.history.canRedo()},Redo.apply=function(t,e,i){var o,r,s;if(s={tool:this,element:t,selection:e},this.dispatchEditorEvent("tool-apply",s))return o=n.EditorApp.get(),o.history.stopWatching(),r=o.history.redo(),o.revertToSnapshot(r),o.history.watch(),this.dispatchEditorEvent("tool-applied",s)},Redo}(n.Tool),n.Tools.Remove=function(t){function Remove(){return Remove.__super__.constructor.apply(this,arguments)}return a(Remove,t),n.ToolShelf.stow(Remove,"remove"),Remove.label="Remove",Remove.icon="remove",Remove.canApply=function(t,e){return!t.isFixed()},Remove.apply=function(t,e,n){var i,o,r,s,a;if(a={tool:this,element:t,selection:e},this.dispatchEditorEvent("tool-apply",a)){if(i=this.editor(),t.blur(),t.nextContent()?t.nextContent().focus():t.previousContent()&&t.previousContent().focus(),!t.isMounted())return n(!0),void this.dispatchEditorEvent("tool-applied",a);switch(t.type()){case"ListItemText":i.ctrlDown()?(o=t.closest(function(t){return"Region"===t.parent().type()}),o.parent().detach(o)):t.parent().parent().detach(t.parent());break;case"TableCellText":i.ctrlDown()?(s=t.closest(function(t){return"Table"===t.type()}),s.parent().detach(s)):(r=t.parent().parent(),r.parent().detach(r));break;default:t.parent().detach(t)}return n(!0),this.dispatchEditorEvent("tool-applied",a)}},Remove}(n.Tool)}.call(this)},function(t,e){(function(){var e,n,i={}.hasOwnProperty,o=function(t,e){function ctor(){this.constructor=t}for(var n in e)i.call(e,n)&&(t[n]=e[n]);return ctor.prototype=e.prototype,t.prototype=new ctor,t.__super__=e.prototype,t},r=[].slice,s=function(t,e){return function(){return t.apply(e,arguments)}};e={dimSnippetDOMElement:function(t,n){var i;if(i=e.getSnippetDOMElement(t,n))return i.classList.remove("cf--highlight-snippet")},dimAllSnippetDOMElements:function(){var t,e,n,i,o;for(i=document.querySelectorAll(".cf--highlight-snippet"),o=[],e=0,n=i.length;e<n;e++)t=i[e],o.push(t.classList.remove("cf--highlight-snippet"));return o},getFlowCls:function(){return e.FlowModel},getFlowDOMelement:function(t){return document.querySelector("[data-cf-flow='"+(t.id||t)+"']")},getFlowIdFromDOMElement:function(t){return t.getAttribute("data-cf-flow")},getSnippetCls:function(t){return e.SnippetModel},getSnippetDOMElement:function(t,e){return document.querySelector("[data-cf-snippet='"+e.id+"']")},getSnippetIdFromDOMElement:function(t){return t.getAttribute("data-cf-snippet")},getSnippetTypeCls:function(t){return e.SnippetTypeModel},highlightSnippetDOMElement:function(t,n){var i;if(i=e.getSnippetDOMElement(t,n))return i.classList.add("cf--highlight-snippet")}},"undefined"!=typeof window&&(window.ContentFlow=e),void 0!==t&&t.exports&&(t.exports=e),n=function(t){function _FlowMgr(){_FlowMgr.__super__.constructor.call(this),this._api=null,this._flow=null,this._open=!1,this._draw=new e.DrawUI,this.attach(this._draw),this._flows=new e.FlowsUI,this._draw.attach(this._flows),this._toggle=new e.ToggleUI,this.attach(this._toggle),this._flows.addEventListener("select",function(t){return function(e){return t.flow(e.detail().flow)}}(this))}return o(_FlowMgr,t),_FlowMgr._uiInterfaces={},_FlowMgr.prototype.init=function(t,n,i){var o,r,s,a,l,u;for(null==t&&(t="[data-cf-flow]"),null==n&&(n="data-cf-flow"),null==i&&(i=null),r=ContentTools.EditorApp.get(),this._api=i||new e.BaseAPI,this._domFlows=t,("string"==typeof t||t instanceof String)&&(this._domFlows=document.querySelectorAll(this._domFlows)),s=[],u=this._domFlows,a=0,l=u.length;a<l;a++)o=u[a],s.push(new e.FlowModel(o.getAttribute(n)));if(this._flows.flows(s),this._toggle.addEventListener("on",function(t){return function(e){return t.open()}}(this)),this._toggle.addEventListener("off",function(t){return function(e){return t.close()}}(this)),r.addEventListener("start",function(t){return function(e){return t._toggle.hide()}}(this)),r.addEventListener("stop",function(t){return function(e){return t._toggle.show()}}(this)),this._domFlows.length>0)return this.mount(),this._toggle.show(),this.flow(s[0])},_FlowMgr.prototype.api=function(){return this._api},_FlowMgr.prototype.isOpen=function(){return this._open},_FlowMgr.prototype.close=function(){var t;if(this.dispatchEvent(this.createEvent("close")))return document.body.classList.remove("cf--flow-mgr-open"),this._draw.close(),t=ContentTools.EditorApp.get(),t.syncRegions(),t.domRegions().length?t.ignition().show():void 0},_FlowMgr.prototype.flow=function(t){if(void 0===t)return this._flow;if(this._flow!==t)return this._flow=t,e.FlowMgr.get().loadInterface("list-snippets")},_FlowMgr.prototype.loadInterface=function(){var t,e,n,i;if(n=arguments[0],t=2<=arguments.length?r.call(arguments,1):[],i=new this.constructor._uiInterfaces[n])return i.safeToClose()?this._toggle.enable():this._toggle.disable(),this._draw.children().length>1&&(e=this._draw.children()[1],e.unmount(),this._draw.detach(e)),this._draw.attach(i),i.mount(),i.init.apply(i,t)},_FlowMgr.prototype.mount=function(){var t,e,n,i,o;for(this._domElement=this.constructor.createDiv(["cf-flow-mgr"]),document.body.insertBefore(this._domElement,null),this._addDOMEventListeners(),i=this.children(),o=[],e=0,n=i.length;e<n;e++)t=i[e],o.push(t.mount());return o},_FlowMgr.prototype.open=function(){if(this.dispatchEvent(this.createEvent("open")))return document.body.classList.add("cf--flow-mgr-open"),ContentTools.EditorApp.get().ignition().hide(),this._draw.open()},_FlowMgr.prototype.unmount=function(){if(this.isMounted())return this._domElement.parentNode.removeChild(this._domElement),this._removeDOMEventListeners(),this._draw=null,this._flowSelect=null,this._toggle=null},_FlowMgr.registerInterface=function(t,e){return this._uiInterfaces[t]=e},_FlowMgr}(ContentTools.ComponentUI),e.FlowMgr=function(){function FlowMgr(){}var t;return t=null,FlowMgr.get=function(){var n;return n=e.FlowMgr.getCls(),null!=t?t:t=new n},FlowMgr.getCls=function(){return n},FlowMgr}(),e.BaseAPI=function(){function BaseAPI(t,e){null==t&&(t="/"),null==e&&(e={}),this.baseURL=t,this.baseParams=e}return BaseAPI.prototype.getGlobalSnippets=function(t){return this._callEndpoint("GET","global-snippets",{flow:t.id})},BaseAPI.prototype.getSnippets=function(t){return this._callEndpoint("GET","snippets",{flow:t.id})},BaseAPI.prototype.getSnippetTypes=function(t){return this._callEndpoint("GET","snippet-types",{flow:t.id})},BaseAPI.prototype.getSnippetSettingsForm=function(t,e){return this._callEndpoint("GET","update-snippet-settings",{flow:t.id,snippet:e.id})},BaseAPI.prototype.addSnippet=function(t,e){return this._callEndpoint("POST","add-snippet",{flow:t.id,snippet_type:e.id})},BaseAPI.prototype.addGlobalSnippet=function(t,e){return this._callEndpoint("POST","add-global-snippet",{flow:t.id,global_snippet:e.globalId})},BaseAPI.prototype.changeSnippetScope=function(t,e,n,i){return null==i&&(i=null),this._callEndpoint("POST","change-snippet-scope",{flow:t.id,snippet:e.id,scope:n,label:i})},BaseAPI.prototype.updateSnippetSettings=function(t,e,n){var i,o,r;o={flow:t.id,snippet:e.id};for(i in n)r=n[i],o[i]=r;return this._callEndpoint("POST","update-snippet-settings",o)},BaseAPI.prototype.deleteSnippet=function(t,e){return this._callEndpoint("POST","delete-snippet",{flow:t.id,snippet:e.id})},BaseAPI.prototype.orderSnippets=function(t,e){var n;return this._callEndpoint("POST","order-snippets",{flow:t.id,snippets:function(){var t,i,o;for(o=[],t=0,i=e.length;t<i;t++)n=e[t],o.push(n.id);return o}()})},BaseAPI.prototype._callEndpoint=function(t,e,n){var i,o,r,s,a,l,u;null==n&&(n={}),l=new XMLHttpRequest,i=null,s="",u=this.baseParams;for(o in u)a=u[o],void 0===n[o]&&(n[o]=a);switch(t.toLowerCase()){case"get":r=Object.keys(n).map(function(t){return Array.isArray(n[t])&&(n[t]=JSON.stringify(n[t])),[t,n[t]].map(encodeURIComponent).join("=")}),s="?"+r.join("&")+"&_="+Date.now();break;case"delete":case"post":case"post":i=new FormData;for(o in n)a=n[o],Array.isArray(a)&&(a=JSON.stringify(a)),i.append(o,a)}return l.open(t,""+this.baseURL+e+s),l.send(i),l},BaseAPI}(),e.FlowModel=function(){function FlowModel(t,e){null==e&&(e=[]),this.id=t,this.snippetTypes=e}return FlowModel.prototype.getSnippetTypeById=function(t){var e,n,i,o;for(o=this.snippetTypes,n=0,i=o.length;n<i;n++)if(e=o[n],t===e.id)return e},FlowModel}(),e.SnippetModel=function(){function SnippetModel(t,e,n,i,o,r){null==n&&(n="local"),null==i&&(i={}),null==o&&(o=null),null==r&&(r=null),this.id=t,this.type=e,this.scope=n,this.settings=i,this.globalId=o,this.globalLabel=r}return SnippetModel.fromJSONType=function(t,n){var i;return i=e.getSnippetTypeCls(t),new e.SnippetModel(n.id,i.fromJSONType(t,n.type),n.scope,n.settings,n.global_id,n.global_label)},SnippetModel}(),e.SnippetTypeModel=function(){function SnippetTypeModel(t,e,n){null==n&&(n=null),this.id=t,this.label=e,this.imageURL=n}return SnippetTypeModel.prototype.toSnippet=function(){return new e.SnippetModel("",this)},SnippetTypeModel.fromJSONType=function(t,n){return new e.SnippetTypeModel(n.id,n.label,n.image_url)},SnippetTypeModel}(),e.DrawUI=function(t){function DrawUI(){DrawUI.__super__.constructor.call(this),this._state="closed"}return o(DrawUI,t),DrawUI.prototype.open=function(){if(this.dispatchEvent(this.createEvent("open")))return this.state("open")},DrawUI.prototype.close=function(){if(this.dispatchEvent(this.createEvent("close")))return this.state("closed")},DrawUI.prototype.mount=function(){var t,e,n,i,o;for(DrawUI.__super__.mount.call(this),this._domElement=this.constructor.createDiv(["ct-widget","ct-draw","ct-draw--closed"]),this.parent().domElement().appendChild(this._domElement),this._addDOMEventListeners(),i=this.children(),o=[],e=0,n=i.length;e<n;e++)t=i[e],o.push(t.mount());return o},DrawUI.prototype.state=function(t){if(void 0===t)return t;if(this.state!==t&&this.dispatchEvent(this.createEvent("statechange",{state:t})))return this._state=t,this.isMounted()?(this.removeCSSClass("ct-draw--open"),this.removeCSSClass("ct-draw--closed"),"open"===this._state?this.addCSSClass("ct-draw--open"):this.addCSSClass("ct-draw--closed")):void 0},DrawUI}(ContentTools.ComponentUI),e.FieldUI=function(t){function FieldUI(t,e,n,i){FieldUI.__super__.constructor.call(this),this._name=t,this._label=e,this._required=n,this._initialValue=i}return o(FieldUI,t),FieldUI.prototype.name=function(){return this._name},FieldUI.prototype.label=function(){return this._label},FieldUI.prototype.required=function(){return this._required},FieldUI.prototype.initialValue=function(){return this._initialValue},FieldUI.prototype.errors=function(t){var e,n,i,o,r,s,a;if(!this.isMounted())throw Error("Cannot set error for unmounted field");if(void 0===t){for(t=[],a=this._domErrors.querySelector(".ct-field__error"),i=0,r=a.length;i<r;i++)e=a[i],t.push(e.textContent);return t}if(this._domErrors.innerHTML="",this._domErrors.classList.add("ct-field-errors__empty"),t){for(o=0,s=t.length;o<s;o++)n=t[o],e=this.constructor.createDiv(["ct-field__error"]),e.textContent=ContentEdit._(n),this._domErrors.appendChild(e);return this._domErrors.classList.remove("ct-field-errors__empty")}},FieldUI.prototype.mount=function(){return FieldUI.__super__.mount.call(this),this._domElement=this.constructor.createDiv(["ct-field",this._required?"ct-field--required":"ct-field--optional"]),this._domLabel=document.createElement("label"),this._domLabel.classList.add("ct-field__label"),this._domLabel.setAttribute("for",this._name),this._domLabel.textContent=ContentEdit._(this._label),this._domElement.appendChild(this._domLabel),this.mount_input(),this._domErrors=this.constructor.createDiv(["ct-field_errors","ct-field_errors__empty"]),this._domElement.appendChild(this._domErrors),this.parent().domElement().appendChild(this._domElement),this._addDOMEventListeners()},FieldUI.prototype.mount_input=function(){},FieldUI.prototype.value=function(t){if(!this.isMounted())throw Error("Cannot set value for unmounted field");return void 0===t?this._domInput.value:this._domInput.value=t},FieldUI.prototype.unmount=function(){return FieldUI.__super__.unmount.call(this),this._domErrors=null,this._domInput=null,this._domLabel=null},FieldUI.fromJSONType=function(t){switch(t.type){case"boolean":return new e.BooleanFieldUI(t.name,t.label,t.required,t.value);case"select":return new e.SelectFieldUI(t.name,t.label,t.required,t.value,t.choices)}return new e.TextFieldUI(t.name,t.label,t.required,t.value)},FieldUI}(ContentTools.ComponentUI),e.BooleanFieldUI=function(t){function BooleanFieldUI(){return BooleanFieldUI.__super__.constructor.apply(this,arguments)}return o(BooleanFieldUI,t),BooleanFieldUI.prototype.mount_input=function(){return this._domInput=document.createElement("input"),this._domInput.classList.add("ct-field__input"),this._domInput.classList.add("ct-field__input--boolean"),this._domInput.setAttribute("id",this._name),this._domInput.setAttribute("name",this._name),this._domInput.setAttribute("type","checkbox"),this._initialValue&&this._domInput.setAttribute("checked",!0),this._domElement.appendChild(this._domInput)},BooleanFieldUI.prototype.value=function(t){if(!this.isMounted())throw Error("Cannot set value for unmounted field");return void 0===t?this._domInput.checked?this.name:"":(this._domInput.removeAttribute("checked"),t?this._domInput.setAttribute("checked",!0):void 0)},BooleanFieldUI}(e.FieldUI),e.SelectFieldUI=function(t){function SelectFieldUI(t,e,n,i,o){SelectFieldUI.__super__.constructor.call(this,t,e,n,i),this._choices=o}return o(SelectFieldUI,t),SelectFieldUI.prototype.choices=function(){return this.choices},SelectFieldUI.prototype.mount_input=function(){var t,e,n,i,o;for(this._domInput=document.createElement("select"),this._domInput.classList.add("ct-field__input"),this._domInput.classList.add("ct-field__input--select"),this._domInput.setAttribute("id",this._name),this._domInput.setAttribute("name",this._name),o=this._choices,n=0,i=o.length;n<i;n++)t=o[n],e=document.createElement("option"),e.setAttribute("value",t[0]),e.textContent=ContentEdit._(t[1]),this._initialValue===t[0]&&e.setAttribute("selected",!0),this._domInput.appendChild(e);return this._domElement.appendChild(this._domInput)},SelectFieldUI}(e.FieldUI),e.TextFieldUI=function(t){function TextFieldUI(){return TextFieldUI.__super__.constructor.apply(this,arguments)}return o(TextFieldUI,t),TextFieldUI.prototype.mount_input=function(){return this._domInput=document.createElement("input"),this._domInput.classList.add("ct-field__input"),this._domInput.classList.add("ct-field__input--text"),this._domInput.setAttribute("id",this._name),this._domInput.setAttribute("name",this._name),this._domInput.setAttribute("type","text"),this._domInput.setAttribute("value",this._initialValue?this._initialValue:""),this._domElement.appendChild(this._domInput)},TextFieldUI}(e.FieldUI),e.FlowsUI=function(t){function FlowsUI(t){null==t&&(t=[]),FlowsUI.__super__.constructor.call(this),this._flows=t}return o(FlowsUI,t),FlowsUI.prototype.domSelect=function(){return this._domSelect},FlowsUI.prototype.flows=function(t){var e,n,i,o,r,s;if(void 0===t)return n;if(JSON.stringify(this._flows)!==JSON.stringify(t)&&(this._flows=t,this.isMounted())){for(;this._domSelect.options.length>0;)this._domSelect.remove(0);for(r=this._flows,s=[],i=0,o=r.length;i<o;i++)n=r[i],e=document.createElement("option"),e.setAttribute("value",n.id),e.textContent=n.id,s.push(this._domSelect.appendChild(e));return s}},FlowsUI.prototype.mount=function(){var t,e,n,i,o;for(FlowsUI.__super__.mount.call(this),this._domElement=this.constructor.createDiv(["ct-flows"]),this._domSelect=document.createElement("select"),this._domSelect.classList.add("ct-flows__select"),this._domSelect.setAttribute("name","flows"),o=this._flows,n=0,i=o.length;n<i;n++)e=o[n],t=document.createElement("option"),t.setAttribute("value",e.id),t.textContent=e.id,this._domSelect.appendChild(t);return this._domElement.appendChild(this._domSelect),this.parent().domElement().appendChild(this._domElement),this._addDOMEventListeners()},FlowsUI.prototype.unmount=function(){return FlowsUI.__super__.unmount.call(this),this._domSelect=null},FlowsUI.prototype._addDOMEventListeners=function(){return this._domSelect.addEventListener("change",function(t){return function(e){var n,i,o,r,s,a;for(i=t._domSelect.value,s=t._flows,a=[],o=0,r=s.length;o<r;o++)n=s[o],n.id===i?a.push(t.dispatchEvent(t.createEvent("select",{flow:n}))):a.push(void 0);return a}}(this))},FlowsUI}(ContentTools.ComponentUI),e.InlayUI=function(t){function InlayUI(t){InlayUI.__super__.constructor.call(this),this._header=new e.InlayHeaderUI(t),this.attach(this._header),this._body=new e.InlayBodyUI,this.attach(this._body)}return o(InlayUI,t),InlayUI.prototype.body=function(){return this._body},InlayUI.prototype.header=function(){return this._header},InlayUI.prototype.mount=function(){return InlayUI.__super__.mount.call(this),this._domElement=this.constructor.createDiv(["ct-inlay"]),this.parent().domElement().appendChild(this._domElement),this._addDOMEventListeners(),this._header.mount(),this._body.mount()},InlayUI}(ContentTools.ComponentUI),e.InlayBodyUI=function(t){function InlayBodyUI(){return InlayBodyUI.__super__.constructor.apply(this,arguments)}return o(InlayBodyUI,t),InlayBodyUI.prototype.mount=function(){var t,e,n,i,o;for(InlayBodyUI.__super__.mount.call(this),this._domElement=this.constructor.createDiv(["ct-inlay__body"]),this.parent().domElement().appendChild(this._domElement),this._addDOMEventListeners(),i=this.children(),o=[],e=0,n=i.length;e<n;e++)t=i[e],o.push(t.mount());return o},InlayBodyUI}(ContentTools.ComponentUI),e.InlayHeaderToolsUI=function(t){function InlayHeaderToolsUI(){return InlayHeaderToolsUI.__super__.constructor.apply(this,arguments)}return o(InlayHeaderToolsUI,t),InlayHeaderToolsUI.prototype.mount=function(){var t,e,n,i,o;for(InlayHeaderToolsUI.__super__.mount.call(this),this._domElement=this.constructor.createDiv(["ct-inlay__tools"]),this.parent().domElement().appendChild(this._domElement),this._addDOMEventListeners(),i=this.children(),o=[],e=0,n=i.length;e<n;e++)t=i[e],o.push(t.mount());return o},InlayHeaderToolsUI}(ContentTools.ComponentUI),e.InlayHeaderUI=function(t){function InlayHeaderUI(t){InlayHeaderUI.__super__.constructor.call(this),this._heading=t,this._tools=new e.InlayHeaderToolsUI,this.attach(this._tools)}return o(InlayHeaderUI,t),InlayHeaderUI.prototype.tools=function(){return this._tools},InlayHeaderUI.prototype.heading=function(t){return void 0===t?this._heading:(this._heading=t,this.isMounted()?this._domHeading.textContent=ContentEdit._(t):void 0)},InlayHeaderUI.prototype.mount=function(){return InlayHeaderUI.__super__.mount.call(this),this._domElement=this.constructor.createDiv(["ct-inlay__header"]),this._domHeading=this.constructor.createDiv(["ct-inlay__heading"]),this._domHeading.textContent=ContentEdit._(this._heading),this._domElement.appendChild(this._domHeading),this.parent().domElement().appendChild(this._domElement),this._addDOMEventListeners(),this._tools.mount()},InlayHeaderUI.prototype.unmount=function(){return InlayHeaderUI.__super__.unmount.call(this),this._domHeading=null},InlayHeaderUI}(ContentTools.ComponentUI),e.InlayNoteUI=function(t){function InlayNoteUI(t){InlayNoteUI.__super__.constructor.call(this),this._content=t}return o(InlayNoteUI,t),InlayNoteUI.prototype.content=function(t){return void 0===t?this._content:(this._content=t,this.isMounted()?this._domElement.innerHTML=t:void 0)},InlayNoteUI.prototype.mount=function(){return InlayNoteUI.__super__.mount.call(this),this._domElement=this.constructor.createDiv(["ct-inlay-note"]),this._domElement.innerHTML=this._content,this.parent().domElement().appendChild(this._domElement),this._addDOMEventListeners()},InlayNoteUI}(ContentTools.ComponentUI),e.InlaySectionUI=function(t){function InlaySectionUI(t){InlaySectionUI.__super__.constructor.call(this),this._heading=t}return o(InlaySectionUI,t),InlaySectionUI.prototype.heading=function(t){return void 0===t?this._heading:(this._heading=t,this.isMounted()?this._domHeading.textContent=ContentEdit._(t):void 0)},InlaySectionUI.prototype.mount=function(){var t,e,n,i,o;for(InlaySectionUI.__super__.mount.call(this),this._domElement=this.constructor.createDiv(["ct-inlay-section"]),this._domHeading=this.constructor.createDiv(["ct-inlay-section__heading"]),this._domHeading.textContent=ContentEdit._(this._heading),this._domElement.appendChild(this._domHeading),this.parent().domElement().appendChild(this._domElement),this._addDOMEventListeners(),i=this.children(),o=[],e=0,n=i.length;e<n;e++)t=i[e],o.push(t.mount());return o},InlaySectionUI.prototype.unmount=function(){return InlaySectionUI.__super__.unmount.call(this),this._domHeading=null},InlaySectionUI}(ContentTools.ComponentUI),e.InlayToolUI=function(t){function InlayToolUI(t,e){InlayToolUI.__super__.constructor.call(this),this._toolName=t,this._tooltip=e}return o(InlayToolUI,t),InlayToolUI.prototype.toolName=function(){return this._toolName},InlayToolUI.prototype.tooltip=function(){return this._tooltip},InlayToolUI.prototype.mount=function(){return InlayToolUI.__super__.mount.call(this),this._domElement=this.constructor.createDiv(["ct-inlay__tool","ct-inlay-tool","ct-inlay-tool--"+this._toolName]),this._domElement.setAttribute("data-ct-tooltip",ContentEdit._(this._tooltip)),this.parent().domElement().appendChild(this._domElement),this._addDOMEventListeners()},InlayToolUI.prototype._addDOMEventListeners=function(){return InlayToolUI.__super__._addDOMEventListeners.call(this),this._domElement.addEventListener("click",function(t){return function(e){return t.dispatchEvent(t.createEvent("click"))}}(this))},InlayToolUI}(ContentTools.ComponentUI),e.SnippetUI=function(t){function SnippetUI(t,e){SnippetUI.__super__.constructor.call(this),this._snippet=t,this._behaviour=e}return o(SnippetUI,t),SnippetUI.prototype.mount=function(){var t;return SnippetUI.__super__.mount.call(this),this._domElement=this.constructor.createDiv(["ct-snippet","ct-snippet--behaviour-"+this._behaviour,"ct-snippet--scope-"+this._snippet.scope]),this._domElement.setAttribute("data-snippet-id",this._snippet.id),this._domPreview=this.constructor.createDiv(["ct-snippet__preview"]),this._snippet.type.imageURL&&(t="url("+this._snippet.type.imageURL+")",this._domPreview.style.backgroundImage=t),this._domElement.appendChild(this._domPreview),this._domLabel=this.constructor.createDiv(["ct-snippet__label"]),this._snippet.globalLabel?this._domLabel.textContent=this._snippet.globalLabel:this._domLabel.textContent=this._snippet.type.label,this._domElement.appendChild(this._domLabel),"manage"===this._behaviour&&(this._domTools=this.constructor.createDiv(["ct-snippet__tools"]),this._domSettingsTool=this.constructor.createDiv(["ct-snippet__tool","ct-snippet__tool--settings"]),this._domSettingsTool.setAttribute("data-ct-tooltip",ContentEdit._("Settings")),this._domTools.appendChild(this._domSettingsTool),this._domScopeTool=this.constructor.createDiv(["ct-snippet__tool","ct-snippet__tool--scope"]),this._domScopeTool.setAttribute("data-ct-tooltip",ContentEdit._("Scope")),this._domTools.appendChild(this._domScopeTool),this._domDeleteTool=this.constructor.createDiv(["ct-snippet__tool","ct-snippet__tool--delete"]),this._domDeleteTool.setAttribute("data-ct-tooltip",ContentEdit._("Delete")),this._domTools.appendChild(this._domDeleteTool),this._domElement.appendChild(this._domTools)),this.parent().domElement().appendChild(this._domElement),this._addDOMEventListeners()},SnippetUI.prototype._addDOMEventListeners=function(){return SnippetUI.__super__._addDOMEventListeners.call(this),this._domElement.addEventListener("mouseover",function(t){return function(e){return t.dispatchEvent(t.createEvent("over",{snippet:t._snippet}))}}(this)),this._domElement.addEventListener("mouseout",function(t){return function(e){return t.dispatchEvent(t.createEvent("out",{snippet:t._snippet}))}}(this)),"manage"===this._behaviour?(this._domSettingsTool.addEventListener("click",function(t){return function(e){return t.dispatchEvent(t.createEvent("settings",{snippet:t._snippet}))}}(this)),this._domScopeTool.addEventListener("click",function(t){return function(e){return t.dispatchEvent(t.createEvent("scope",{snippet:t._snippet}))}}(this)),this._domDeleteTool.addEventListener("click",function(t){return function(e){return t.dispatchEvent(t.createEvent("delete",{snippet:t._snippet}))}}(this))):"pick"===this._behaviour?this._domElement.addEventListener("click",function(t){return function(e){return t.dispatchEvent(t.createEvent("pick",{snippet:t._snippet}))}}(this)):void 0},SnippetUI}(ContentTools.ComponentUI),e.ToggleUI=function(t){function ToggleUI(){ToggleUI.__super__.constructor.call(this),this._state="off",this._enabled=!0}return o(ToggleUI,t),ToggleUI.prototype.enabled=function(){return this._enabled},ToggleUI.prototype.disable=function(){if(this.dispatchEvent(this.createEvent("disable"))&&(this._enabled=!1,this.isMounted()))return this.addCSSClass("ct-toggle--disabled")},ToggleUI.prototype.enable=function(){if(this.dispatchEvent(this.createEvent("enable"))&&(this._enabled=!0,this.isMounted()))return this.removeCSSClass("ct-toggle--disabled")},ToggleUI.prototype.mount=function(){return ToggleUI.__super__.mount.call(this),this._domElement=this.constructor.createDiv(["ct-widget","ct-toggle","ct-toggle--off"]),this._domOff=this.constructor.createDiv(["ct-toggle__button","ct-toggle__button--off"]),this._domElement.appendChild(this._domOff),this._domOn=this.constructor.createDiv(["ct-toggle__button","ct-toggle__button--on"]),this._domElement.appendChild(this._domOn),this.parent().domElement().appendChild(this._domElement),this._addDOMEventListeners()},ToggleUI.prototype.off=function(){if(this.dispatchEvent(this.createEvent("off")))return this.state("off")},ToggleUI.prototype.on=function(){if(this.dispatchEvent(this.createEvent("on")))return this.state("on")},ToggleUI.prototype.state=function(t){if(void 0===t)return t;if(this.state!==t&&this.dispatchEvent(this.createEvent("statechange",{state:t})))return this._state=t,this.isMounted()?(this.removeCSSClass("ct-toggle--off"),this.removeCSSClass("ct-toggle--on"),"on"===this._state?this.addCSSClass("ct-toggle--on"):this.addCSSClass("ct-toggle--off")):void 0},ToggleUI.prototype.toggle=function(){return"on"===this._state?this.off():this.on()},ToggleUI.prototype.unmount=function(){return ToggleUI.__super__.unmount.call(this),this._domOn=null,this._domOff=null},ToggleUI.prototype._addDOMEventListeners=function(){return ToggleUI.__super__._addDOMEventListeners.call(this),this._domOff.addEventListener("click",function(t){return function(e){if(e.preventDefault(),t._enabled)return t.off()}}(this)),this._domOn.addEventListener("click",function(t){return function(e){if(e.preventDefault(),t._enabled)return t.on()}}(this))},ToggleUI}(ContentTools.WidgetUI),e.InterfaceUI=function(t){function InterfaceUI(t){InterfaceUI.__super__.constructor.call(this,t)}return o(InterfaceUI,t),InterfaceUI.prototype.init=function(){},InterfaceUI.prototype.safeToClose=function(){return!1},InterfaceUI}(e.InlayUI),e.AddSnippetUI=function(t){function AddSnippetUI(){AddSnippetUI.__super__.constructor.call(this,"Add"),this._tools={cancel:new e.InlayToolUI("cancel","Cancel",!0)},this._header.tools().attach(this._tools.cancel),this._tools.cancel.addEventListener("click",function(t){return function(t){return e.FlowMgr.get().loadInterface("list-snippets")}}())}return o(AddSnippetUI,t),AddSnippetUI.prototype.init=function(){var t,n;return AddSnippetUI.__super__.init.call(this),t=e.FlowMgr.get(),n=t.api().getSnippetTypes(t.flow()),n.addEventListener("load",function(i){return function(o){var r,s,a,l,u,h,c,d,p,_,m,g;for(s=e.FlowMgr.get().flow(),a=JSON.parse(o.target.responseText).payload,m=i._body.children,c=0,p=m.length;c<p;c++)r=m[c],i._body.detach(r);for(i._local=new e.InlaySectionUI("Local scope"),g=a.snippet_types,d=0,_=g.length;d<_;d++)u=g[d],l=e.SnippetTypeModel.fromJSONType(s,u),h=new e.SnippetUI(l.toSnippet(),"pick"),i._local.attach(h),h.addEventListener("pick",function(i){return t=e.FlowMgr.get(),n=t.api().addSnippet(t.flow(),i.detail().snippet.type),n.addEventListener("load",function(t){return function(t){var n,i;return s=e.FlowMgr.get().flow(),a=JSON.parse(t.target.responseText).payload,i=document.createElement("div"),i.innerHTML=a.html,i=i.children[0],n=e.getFlowDOMelement(s),n.appendChild(i),e.FlowMgr.get().loadInterface("list-snippets")}}())});return i._body.attach(i._local),n=t.api().getGlobalSnippets(t.flow()),n.addEventListener("load",function(o){var r,l,u,c,d,p;for(a=JSON.parse(o.target.responseText).payload,s=e.FlowMgr.get().flow(),l=e.getSnippetCls(s),i._global=new e.InlaySectionUI("Global scope"),p=a.snippets,c=0,d=p.length;c<d;c++)u=p[c],r=l.fromJSONType(s,u),h=new e.SnippetUI(r,"pick"),i._global.attach(h),h.addEventListener("pick",function(i){return t=e.FlowMgr.get(),n=t.api().addGlobalSnippet(t.flow(),i.detail().snippet),n.addEventListener("load",function(t){return function(t){var n,i;return s=e.FlowMgr.get().flow(),a=JSON.parse(t.target.responseText).payload,i=document.createElement("div"),i.innerHTML=a.html,i=i.children[0],n=e.getFlowDOMelement(s),n.appendChild(i),e.FlowMgr.get().loadInterface("list-snippets")}}())});return i._global.children().length>0&&i._body.attach(i._global),i._body.unmount(),i._body.mount()})}}(this))},AddSnippetUI}(e.InterfaceUI),e.FlowMgr.getCls().registerInterface("add-snippet",e.AddSnippetUI),e.ListSnippetsUI=function(t){function ListSnippetsUI(){ListSnippetsUI.__super__.constructor.call(this,"Snippets"),this._tools={order:new e.InlayToolUI("order","Order",!0),add:new e.InlayToolUI("add","Add",!0)},this._header.tools().attach(this._tools.order),this._header.tools().attach(this._tools.add),this._tools.order.addEventListener("click",function(t){return function(t){return e.FlowMgr.get().loadInterface("order-snippets")}}()),this._tools.add.addEventListener("click",function(t){return function(t){return e.FlowMgr.get().loadInterface("add-snippet")}}())}return o(ListSnippetsUI,t),ListSnippetsUI.prototype.init=function(){var t,n;return ListSnippetsUI.__super__.init.call(this),e.dimAllSnippetDOMElements(),t=e.FlowMgr.get(),n=t.api().getSnippets(t.flow()),n.addEventListener("load",function(i){return function(o){var r,s,a,l,u,h,c,d,p,_,m,g,f;for(a=JSON.parse(o.target.responseText).payload,g=i._body.children,d=0,_=g.length;d<_;d++)r=g[d],i._body.detach(r);for(s=e.FlowMgr.get().flow(),u=e.getSnippetCls(s),f=a.snippets,p=0,m=f.length;p<m;p++)h=f[p],l=u.fromJSONType(s,h),c=new e.SnippetUI(l,"manage"),i._body.attach(c),c.addEventListener("over",function(t){return e.highlightSnippetDOMElement(e.FlowMgr.get().flow(),t.detail().snippet)}),c.addEventListener("out",function(t){return e.dimSnippetDOMElement(e.FlowMgr.get().flow(),t.detail().snippet)}),c.addEventListener("settings",function(t){return e.FlowMgr.get().loadInterface("snippet-settings",t.detail().snippet)}),c.addEventListener("scope",function(t){var n;return n="local","local"===t.detail().snippet.scope&&(n="global"),e.FlowMgr.get().loadInterface("make-snippet-"+n,t.detail().snippet)}),c.addEventListener("delete",function(i){var o,r;if(o=ContentEdit._("Are you sure you want to delete this snippet?"),confirm(o))return t=e.FlowMgr.get(),n=t.api().deleteSnippet(t.flow(),i.detail().snippet),r=function(t,n){return function(i){var o;return o=e.getSnippetDOMElement(t,n),o.remove(),e.FlowMgr.get().loadInterface("list-snippets")}},n.addEventListener("load",r(t.flow(),i.detail().snippet))});return i._body.unmount(),i._body.mount()}}(this))},ListSnippetsUI.prototype.safeToClose=function(){return!0},ListSnippetsUI}(e.InterfaceUI),e.FlowMgr.getCls().registerInterface("list-snippets",e.ListSnippetsUI),e.MakeSnippetGlobalUI=function(t){function MakeSnippetGlobalUI(){MakeSnippetGlobalUI.__super__.constructor.call(this,"Make global"),this._tools={confirm:new e.InlayToolUI("confirm","Confirm",!0),cancel:new e.InlayToolUI("cancel","Cancel",!0)},this._header.tools().attach(this._tools.confirm),this._header.tools().attach(this._tools.cancel),this._tools.confirm.addEventListener("click",function(t){return function(n){var i,o;return i=e.FlowMgr.get(),o=i.api().changeSnippetScope(i.flow(),t._snippet,"global",t._labelField.value()),o.addEventListener("load",function(n){var i;return i=JSON.parse(n.target.responseText),"success"===i.status?e.FlowMgr.get().loadInterface("list-snippets"):t._labelField.errors([i.payload.errors.label])})}}(this)),this._tools.cancel.addEventListener("click",function(t){return function(t){return e.FlowMgr.get().loadInterface("list-snippets")}}())}return o(MakeSnippetGlobalUI,t),MakeSnippetGlobalUI.prototype.init=function(t){var n;return MakeSnippetGlobalUI.__super__.init.call(this),this._snippet=t,this._labelField=new e.TextFieldUI("label","Label",!0),this._body.attach(this._labelField),n=new e.InlayNoteUI(ContentEdit._("Once you make a snippet global it can be inserted into other pages\nand changes made to the snippet&apos;s content or settings will be\napplied to all instances of the snippet.")),this._body.attach(n),this._body.unmount(),this._body.mount()},MakeSnippetGlobalUI}(e.InterfaceUI),e.FlowMgr.getCls().registerInterface("make-snippet-global",e.MakeSnippetGlobalUI),e.MakeSnippetLocaUI=function(t){function MakeSnippetLocaUI(){MakeSnippetLocaUI.__super__.constructor.call(this,"Make local"),this._tools={confirm:new e.InlayToolUI("confirm","Confirm",!0),cancel:new e.InlayToolUI("cancel","Cancel",!0)},this._header.tools().attach(this._tools.confirm),this._header.tools().attach(this._tools.cancel),this._tools.confirm.addEventListener("click",function(t){return function(n){var i,o;return i=e.FlowMgr.get(),o=i.api().changeSnippetScope(i.flow(),t._snippet,"local"),o.addEventListener("load",function(t){return e.FlowMgr.get().loadInterface("list-snippets")})}}(this)),this._tools.cancel.addEventListener("click",function(t){return function(t){return e.FlowMgr.get().loadInterface("list-snippets")}}())}return o(MakeSnippetLocaUI,t),MakeSnippetLocaUI.prototype.init=function(t){var n;return MakeSnippetLocaUI.__super__.init.call(this),this._snippet=t,n=new e.InlayNoteUI(ContentEdit._("This action replaces the global snippet within the page with a\nlocal version of the snippet. Changes to local snippets are only\napplied to that instance of the snippet.")),this._body.attach(n),this._body.unmount(),this._body.mount()},MakeSnippetLocaUI}(e.InterfaceUI),e.FlowMgr.getCls().registerInterface("make-snippet-local",e.MakeSnippetLocaUI),e.OrderSnippetsUI=function(t){function OrderSnippetsUI(){this._grab=s(this._grab,this),this._drop=s(this._drop,this),this._drag=s(this._drag,this),OrderSnippetsUI.__super__.constructor.call(this,"Order"),this._tools={confirm:new e.InlayToolUI("confirm","Confirm",!0),cancel:new e.InlayToolUI("cancel","Cancel",!0)},this._header.tools().attach(this._tools.confirm),this._header.tools().attach(this._tools.cancel),this._grabbed=null,this._grabbedHelper=null,this._grabbedOffset=null,document.addEventListener("mousedown",this._grab),document.addEventListener("mousemove",this._drag),document.addEventListener("mouseup",this._drop),this._tools.confirm.addEventListener("click",function(t){return function(n){var i,o;return i=e.FlowMgr.get(),o=i.api().orderSnippets(i.flow(),t._newSnippetOrder),o.addEventListener("load",function(t){return e.FlowMgr.get().loadInterface("list-snippets")})}}(this)),this._tools.cancel.addEventListener("click",function(t){return function(n){return t._orderSnippetsOnPage(t._originalSnippetOrder),e.FlowMgr.get().loadInterface("list-snippets")}}(this))}return o(OrderSnippetsUI,t),OrderSnippetsUI.prototype.init=function(){var t,n;return OrderSnippetsUI.__super__.init.call(this),t=e.FlowMgr.get(),n=t.api().getSnippets(t.flow()),n.addEventListener("load",function(t){return function(n){var i,o,r,s,a,l,u,h,c,d,p,_;for(t._snippets={},t._originalSnippetOrder=[],t._newSnippetOrder=[],r=JSON.parse(n.target.responseText).payload,p=t._body.children,u=0,c=p.length;u<c;u++)i=p[u],t._body.detach(i);for(o=e.FlowMgr.get().flow(),a=e.getSnippetCls(o),_=r.snippets,h=0,d=_.length;h<d;h++)l=_[h],s=a.fromJSONType(o,l),t._snippets[s.id]=s,t._originalSnippetOrder.push(s),t._newSnippetOrder.push(s),t._body.attach(new e.SnippetUI(s,"order"));return t._body.unmount(),t._body.mount()}}(this))},OrderSnippetsUI.prototype.unmount=function(){return OrderSnippetsUI.__super__.unmount.call(this),document.removeEventListener("mousedown",this._grab),document.removeEventListener("mousemove",this._drag),document.removeEventListener("mouseup",this._drop)},OrderSnippetsUI.prototype._drag=function(t){var e,n,i,o,r,s,a,l,u,h,c,d,p;if(this._grabbed){for(a=this._getEventPos(t),r=[window.pageXOffset,window.pageYOffset],o=r[0]+a[0]-this._grabbedOffset[0]+"px",this._grabbedHelper.style.left=o,h=r[1]+a[1]-this._grabbedOffset[1]+"px",this._grabbedHelper.style.top=h,u=document.elementFromPoint(a[0],a[1]),i=null,p=this._body.children(),c=0,d=p.length;c<d;c++)if(e=p[c],(n=e.domElement())!==this._grabbed&&n.contains(u)){i=n;break}if(i)return l=i.getBoundingClientRect(),s=[a[0]-l.left,a[1]-l.top],this._body.domElement().removeChild(this._grabbed),s[1]>=l.height/2&&(i=i.nextElementSibling),this._body.domElement().insertBefore(this._grabbed,i)}},OrderSnippetsUI.prototype._drop=function(t){var e,n,i,o,r;if(this._grabbed){for(this._grabbed.classList.remove("ct-snippet--ghost"),this._grabbed=null,this._grabbedOffset=null,document.body.removeChild(this._grabbedHelper),this._grabbedHelper=null,this._body.domElement().classList.remove("ct-inlay__body--sorting"),this._newSnippetOrder=[],r=this._body.domElement().childNodes,i=0,o=r.length;i<o;i++)e=r[i],1===e.nodeType&&(n=e.dataset.snippetId,this._newSnippetOrder.push(this._snippets[n]));return this._orderSnippetsOnPage(this._newSnippetOrder)}},OrderSnippetsUI.prototype._getEventPos=function(t){return[t.pageX-window.pageXOffset,t.pageY-window.pageYOffset]},OrderSnippetsUI.prototype._grab=function(t){var e,n,i,o,r,s,a,l,u;if("mousedown"!==t.type.toLowerCase()||1===t.which){for(o=null,u=this._body.children(),a=0,l=u.length;a<l;a++)if(e=u[a],i=e.domElement(),i.contains(t.target)){o=i;break}if(o)return this._grabbed=o,r=this._getEventPos(t),s=this._grabbed.getBoundingClientRect(),this._grabbedOffset=[r[0]-s.left,r[1]-s.top],this._grabbedHelper=o.cloneNode(!0),n=document.defaultView.getComputedStyle(o,"").cssText,this._grabbedHelper.style.cssText=n,this._grabbedHelper.style.position="absolute",this._grabbedHelper.style["pointer-events"]="none",this._grabbedHelper.style.left=r[0]-this._grabbedOffset[0]+"px",this._grabbedHelper.style.top=r[1]-this._grabbedOffset[1]+"px",this._grabbedHelper.classList.add("ct-snippet--helper"),document.body.appendChild(this._grabbedHelper),this._grabbed.classList.add("ct-snippet--ghost"),this._body.domElement().classList.add("ct-inlay__body--sorting")}},OrderSnippetsUI.prototype._orderSnippetsOnPage=function(t){var n,i,o,r,s,a,l,u;for(o=e.FlowMgr.get().flow(),u=[],r=a=0,l=t.length;a<l;r=++a)s=t[r],0!==r&&(n=e.getSnippetDOMElement(o,t[r-1]),i=e.getSnippetDOMElement(o,s),n.nextSibling!==i&&(i.parentNode.removeChild(i),u.push(n.parentNode.insertBefore(i,n.nextSibling))));return u},OrderSnippetsUI}(e.InterfaceUI),e.FlowMgr.getCls().registerInterface("order-snippets",e.OrderSnippetsUI),e.SnippetSettingsUI=function(t){function SnippetSettingsUI(){SnippetSettingsUI.__super__.constructor.call(this,"Settings"),this._tools={confirm:new e.InlayToolUI("confirm","Confirm",!0),cancel:new e.InlayToolUI("cancel","Cancel",!0)},this._header.tools().attach(this._tools.confirm),this._header.tools().attach(this._tools.cancel),this._tools.confirm.addEventListener("click",function(t){return function(n){var i,o,r,s,a,l;if(!t._fields)return void e.FlowMgr.get().loadInterface("list-snippets");s={},l=t._fields;for(a in l)i=l[a],s[i.name()]=i.value();return o=e.FlowMgr.get(),r=o.api().updateSnippetSettings(o.flow(),t._snippet,s),r.addEventListener("load",function(n){var i,o,r,s,a,l,u,h;if(l=JSON.parse(n.target.responseText),"success"===l.status)return r=e.FlowMgr.get().flow(),a=e.getSnippetDOMElement(r,t._snippet),s=document.createElement("div"),s.innerHTML=l.payload.html,s=s.children[0],a.parentNode.replaceChild(s,a),e.FlowMgr.get().loadInterface("list-snippets");u=l.payload.errors,h=[];for(o in u)i=u[o],t._fields[o]?h.push(t._fields[o].errors(i)):h.push(void 0);return h})}}(this)),this._tools.cancel.addEventListener("click",function(t){return function(t){return e.FlowMgr.get().loadInterface("list-snippets")}}())}return o(SnippetSettingsUI,t),SnippetSettingsUI.prototype.init=function(t){var n,i;return this._snippet=t,n=e.FlowMgr.get(),i=n.api().getSnippetSettingsForm(n.flow(),t),i.addEventListener("load",function(t){return function(n){var i,o,r,s,a,l,u,h,c,d,p,_;if(s=JSON.parse(n.target.responseText).payload,!s.fields)return t._fields=null,e.InlayNoteUI("There are no settings defined for this snippet."),t._body.unmount(),void t._body.mount();for(t._fields={},d=s.fields,l=0,h=d.length;l<h;l++)o=d[l],i=e.FieldUI.fromJSONType(o),t._fields[i.name()]=i,t._body.attach(i);for(t._body.unmount(),t._body.mount(),p=t._snippet.settings,_=[],a=u=0,c=p.length;u<c;a=++u)r=p[a],t._fields[r]?_.push(t._fields[r].value(a)):_.push(void 0);return _}}(this))},SnippetSettingsUI}(e.InterfaceUI),e.FlowMgr.getCls().registerInterface("snippet-settings",e.SnippetSettingsUI)}).call(this)},function(t,e,n){var i,o,r,s,a,l,u;n(5),o=n(0),i=n(1),r=n(3).FlowAPI,s=n(4).ImageUploader,a=function(){function SaveSemaphore(){}return SaveSemaphore._saving=0,SaveSemaphore.dec=function(){return this._saving=Math.max(0,this._saving-1)},SaveSemaphore.inc=function(){return this._saving+=1},SaveSemaphore.saving=function(){return this._saving>0},SaveSemaphore}(),l=function(t,e,n){var i;return i=o.EditorApp.get(),i.addEventListener("saved",function(r){var s,l,u,h,c,d,p;if(c=r.detail().regions,Object.keys(c).length>0&&(s=n(c),Object.keys(s).length>0)){a.inc(),i.busy(!0),p=new XMLHttpRequest,p.open("POST",t),l=new FormData,h=e||{};for(u in h)d=h[u],l.append(u,d);return l.append("contents",JSON.stringify(s)),p.send(l),p.addEventListener("load",function(t){return a.dec(),a.saving()||i.busy(!1),200===parseInt(t.target.status)?new o.FlashUI("ok"):new o.FlashUI("no")})}})},u=function(t,e,n){var a,u,h,c,d;return null==t&&(t="/"),null==e&&(e="/"),null==n&&(n={}),u=o.EditorApp.get(),h=i.FlowMgr.get(),ContentEdit.INDENT="",ContentEdit.LINE_ENDINGS="",o.RESTRICTED_ATTRIBUTES["*"].push("data-ce-tag"),o.RESTRICTED_ATTRIBUTES["*"].push("data-fixture"),o.RESTRICTED_ATTRIBUTES["*"].push("data-transforms"),o.RESTRICTED_ATTRIBUTES["*"].push("data-mh-asset-key"),o.RESTRICTED_ATTRIBUTES["*"].push("data-name"),o.IMAGE_UPLOADER=function(t){return new s(t,n)},u.init("[data-allow-edits] [data-editable], [data-allow-edits] [data-fixture]","data-name"),a=new r(e,n),h.init("[data-cf-flow]","data-cf-flow",a),c=e+"update-flow-contents",l(c,n,function(t){var e,n,i,o,r,s;e={};for(n in t)s=t[n],n.startsWith("snippet:")&&(i=n.split(":"),i[0],r=i[1],o=i[2],e[r]||(e[r]={}),e[r][o]=s);return e}),d=t+"update-global-contents",l(d,n,function(t){var e,n,i,o,r;e={};for(n in t)r=t[n],n.startsWith("global:")&&(i=n.split(":"),i[0],o=i[1],e[o]=r);return e})},t.exports={init:u,addSaveProcess:l,FlowAPI:r,ImageUploader:s,SaveSemaphore:a}},function(t,e,n){var i,o,r=function(t,e){function ctor(){this.constructor=t}for(var n in e)s.call(e,n)&&(t[n]=e[n]);return ctor.prototype=e.prototype,t.prototype=new ctor,t.__super__=e.prototype,t},s={}.hasOwnProperty;i=n(1),o=function(t){function FlowAPI(t,e){null==t&&(t="/"),null==e&&(e={}),FlowAPI.__super__.constructor.call(this,t,e)}return r(FlowAPI,t),FlowAPI}(i.BaseAPI),t.exports={FlowAPI:o}},function(t,e,n){var i,o;i=n(0),o=function(){function ImageUploader(t,e){null==e&&(e={}),this.dialog=t,this.baseParams=e,this.postTransforms=[],this.element=ContentEdit.Root.get().focused(),"ImageFixture"===this.element.type()&&(this.postTransforms=JSON.parse(this.element.domElement().getAttribute("data-transforms")||"[]")),t.addEventListener("imageuploader.cancelupload",function(t){return function(){return t.onCancelUpload()}}(this)),t.addEventListener("imageuploader.clear",function(t){return function(){return t.onClear()}}(this)),t.addEventListener("imageuploader.clear",function(t){return function(){return t.onClear()}}(this)),t.addEventListener("imageuploader.fileready",function(t){return function(e){if(e.detail().file)return t.onFileReady(e.detail().file)}}(this)),t.addEventListener("imageuploader.rotateccw",function(t){return function(e){return t.onRotate(-90)}}(this)),t.addEventListener("imageuploader.rotatecw",function(t){return function(e){return t.onRotate(90)}}(this)),t.addEventListener("imageuploader.save",function(t){return function(){return t.onSave()}}(this))}return ImageUploader.prototype.getTransformURL=function(){return"/manage/transform-asset"},ImageUploader.prototype.getUploadURL=function(){return"/manage/upload-asset"},ImageUploader.prototype.transform=function(t,e){var n,o,r,s,a;n=new FormData,r=this.baseParams;for(o in r)s=r[o],n.append(o,s);return n.append("key",this.image.key),n.append("transforms",JSON.stringify(t)),a=new XMLHttpRequest,a.open("POST",this.getTransformURL(),!0),a.addEventListener("load",function(t){return function(n){var o;return 200===parseInt(n.target.status)?(o=JSON.parse(n.target.responseText),e(o.payload.asset)):new i.FlashUI("no"),t.xhr=null}}(this)),a.send(n)},ImageUploader.prototype.onCancelUpload=function(){return this.xhr&&(this.xhr.upload.removeEventListener("progress",this.xhrProgress),this.xhr.upload.removeEventListener("load",this.xhrComplete),this.xhr.abort()),this.dialog.state("empty")},ImageUploader.prototype.onClear=function(){return this.dialog.clear(),this.image=null},ImageUploader.prototype.onFileReady=function(t){var e,n,o,r;this.dialog.progress(0),this.dialog.state("uploading"),e=new FormData,o=this.baseParams;for(n in o)r=o[n],e.append(n,r);return e.append("file",t),this.xhr=new XMLHttpRequest,this.xhr.open("POST",this.getUploadURL(),!0),this.xhrProgress=function(t){return function(e){return t.dialog.progress(e.loaded/e.total*100)}}(this),this.xhr.upload.addEventListener("progress",this.xhrProgress),this.xhrComplete=function(t){return function(e){var n,o;return 200===parseInt(e.target.status)?(o=JSON.parse(e.target.responseText),n=o.payload.asset,n.type?(t.image={angle:0,height:n.core_meta.image.size[1],key:n.key,maxWidth:n.core_meta.image.size[0],url:n.variations["--draft--"].url,width:n.core_meta.image.size[0]},t.dialog.populate(t.image.url,[t.image.width,t.image.height])):new i.FlashUI("no")):new i.FlashUI("no"),t.xhr=null}}(this),this.xhr.addEventListener("load",this.xhrComplete),this.xhr.send(e)},ImageUploader.prototype.onRotate=function(t){var e;return this.image.angle+=t,this.image.angle<0?this.image.angle+=360:this.image.angle>270&&(this.image.angle-=360),e=[{id:"image.rotate",settings:{angle:this.image.angle}}],this.transform(e,function(t){return function(e){return t.image.url=e.variations["--draft--"].url,90===t.image.angle||(t.image.angle=270)?(t.image.height=e.core_meta.image.size[0],t.image.maxWidth=e.core_meta.image.size[1],t.image.width=e.core_meta.image.size[1]):(t.image.height=e.core_meta.image.size[1],t.image.maxWidth=e.core_meta.image.size[0],t.image.width=e.core_meta.image.size[0]),t.dialog.populate(t.image.url,[t.image.width,t.image.height])}}(this))},ImageUploader.prototype.onSave=function(){var t,e,n;return n=[],0!==this.image.angle&&n.push({id:"image.rotate",settings:{angle:this.image.angle}}),e=this.dialog.cropRegion(),t=this.image.maxWidth,e.toString()!==[0,0,1,1].toString()&&(n.push({id:"image.crop",settings:{top:Math.max(0,e[0]),left:Math.max(0,e[1]),bottom:Math.min(1,e[2]),right:Math.min(1,e[3])}}),t=parseInt(t*(e[3]-e[1]))),n=n.concat(this.postTransforms),this.transform(n,function(e){return function(n){var i;if(i=n.variations["--draft--"],e.dialog.save(i.url,[i.core_meta.image.size[0],i.core_meta.image.size[1]],{alt:"","data-ce-max-width":t,"data-mh-asset-key":n.key}),"ImageFixture"===e.element.type()&&(e.element.attr("data-mh-asset-key",n.key),!e.element.attr("alt")))return e.element.attr("alt","")}}(this))},ImageUploader}(),t.exports={ImageUploader:o}},function(t,e,n){!function(e,n){t.exports=n()}(0,function(){return function(t){function __webpack_require__(n){if(e[n])return e[n].exports;var i=e[n]={exports:{},id:n,loaded:!1};return t[n].call(i.exports,i,i.exports,__webpack_require__),i.loaded=!0,i.exports}var e={};return __webpack_require__.m=t,__webpack_require__.c=e,__webpack_require__.p="",__webpack_require__(0)}([function(t,e,n){t.exports=n(1)},function(t,e){var n,i,o,r,s,a,l,u,h,c,d=[].indexOf||function(t){for(var e=0,n=this.length;e<n;e++)if(e in this&&this[e]===t)return e;return-1};n=function(t,e){var n;if(t.closest)return t.closest(e);for(n=t.matches||t.webkitMatchesSelector||t.mozMatchesSelector||t.msMatchesSelector;t&&!n.call(t,e);)t=t.parentElement;return t},o=function(t,e){var n,i,o;null==e&&(e={}),n=document.createElement(t);for(i in e)o=e[i],d.call(n,i)>=0?n[i]=o:n.setAttribute(i,o);return n},h=function(t,e){return null==e&&(e=document),Array.prototype.slice.call(e.querySelectorAll(t))},c=function(t,e){return null==e&&(e=document),e.querySelector(t)},s=function(t,e,n){var i,o,r;null==n&&(n={}),i=document.createEvent("Event"),i.initEvent(e,!0,!0);for(o in n)r=n[o],i[o]=r;return t.dispatchEvent(i)},l=function(t,e){var n,i,o,r;r=[];for(i in e)o=e[i],r.push(function(){var e,r,s,a;for(s=i.split(/\s+/),a=[],e=0,r=s.length;e<r;e++)n=s[e],a.push(t.removeEventListener(n,o));return a}());return r},u=function(t,e){var n,i,o,r;r=[];for(i in e)o=e[i],r.push(function(){var e,r,s,a;for(s=i.split(/\s+/),a=[],e=0,r=s.length;e<r;e++)n=s[e],a.push(t.addEventListener(n,o));return a}());return r},i=function(t,e,n,i,o){var r,s,a,l;null==o&&(o="data-"),a=[];for(s in e)l=e[s],t[s]=l,n.hasOwnProperty(s)&&(t[s]=n[s]),i&&(r=o+s.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase(),i.hasAttribute(r)?"number"==typeof l?a.push(t[s]=parseInt(i.getAttribute(r))):!1===l?a.push(t[s]=!0):a.push(t[s]=i.getAttribute(r)):a.push(void 0));return a},a=function(t){return t.replace(/[\^\$\\\.\*\+\?\(\)\[\]\{\}\|]/g,"\\$&")},r=function(t){try{document.querySelector(t)}catch(t){return t,!1}return!0},t.exports={closest:n,create:o,one:c,many:h,dispatch:s,ignore:l,listen:u,config:i,escapeRegExp:a,cssSelectorSupported:r}}])})},function(t,e,n){t.exports=n(2)}])});